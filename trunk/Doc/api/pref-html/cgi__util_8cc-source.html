<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libdap++: cgi_util.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>cgi_util.cc</h1><a href="cgi__util_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2002,2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//         Reza Nekovei &lt;rnekovei@intcomm.net&gt; </span>
00010 <span class="comment">//</span>
00011 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00012 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00013 <span class="comment">// License as published by the Free Software Foundation; either</span>
00014 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00015 <span class="comment">// </span>
00016 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00017 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00018 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00019 <span class="comment">// Lesser General Public License for more details.</span>
00020 <span class="comment">// </span>
00021 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00022 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00023 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00024 <span class="comment">//</span>
00025 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00026 
00027 <span class="comment">// (c) COPYRIGHT URI/MIT 1994-2001</span>
00028 <span class="comment">// Please read the full copyright statement in the file COPYRIGHT_URI.</span>
00029 <span class="comment">//</span>
00030 <span class="comment">// Authors:</span>
00031 <span class="comment">//      jhrg,jimg       James Gallagher &lt;jgallagher@gso.uri.edu&gt;</span>
00032 <span class="comment">//      reza            Reza Nekovei &lt;rnekovei@intcomm.net&gt;</span>
00033 
00034 <span class="comment">// A few useful routines which are used in CGI programs.</span>
00035 <span class="comment">//</span>
00036 <span class="comment">// ReZa 9/30/94 </span>
00037 
00038 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00039 
00040 <span class="keyword">static</span> <span class="keywordtype">char</span> rcsid[] <a class="code" href="config__dap_8h.html#a49">not_used</a> = {<span class="stringliteral">"$Id$"</span>};
00041 
00042 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00043 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00044 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00045 
00046 <span class="preprocessor">#ifndef TM_IN_SYS_TIME</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#include &lt;time.h&gt;</span>
00048 <span class="preprocessor">#else</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00050 <span class="preprocessor">#endif</span>
00051 <span class="preprocessor"></span>
00052 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00053 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00054 
00055 <span class="preprocessor">#ifndef WIN32</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
00057 <span class="preprocessor">#include &lt;sys/wait.h&gt;</span>
00058 <span class="preprocessor">#else</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#include &lt;io.h&gt;</span>
00060 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00061 <span class="preprocessor">#include &lt;process.h&gt;</span>
00062 <span class="comment">// Win32 does not define this. 08/21/02 jhrg</span>
00063 <span class="preprocessor">#define F_OK 0</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00065 <span class="preprocessor"></span>
00066 <span class="preprocessor">#include &lt;iostream&gt;</span>
00067 <span class="preprocessor">#include &lt;sstream&gt;</span>
00068 <span class="preprocessor">#include &lt;fstream&gt;</span>
00069 <span class="preprocessor">#include &lt;string&gt;</span>
00070 
00071 <span class="preprocessor">#include "<a class="code" href="cgi__util_8h.html">cgi_util.h</a>"</span>
00072 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>       <span class="comment">// This supplies flush_stream for WIN32.</span>
00073 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00074 
00075 <span class="preprocessor">#ifdef TRACE_NEW</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="trace__new_8h.html">trace_new.h</a>"</span>
00077 <span class="preprocessor">#endif</span>
00078 <span class="preprocessor"></span>
00079 <span class="preprocessor">#ifdef WIN32</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define FILE_DELIMITER  '\\'</span>
00081 <span class="preprocessor"></span><span class="preprocessor">#else  //  default to unix</span>
<a name="l00082"></a><a class="code" href="cgi__util_8cc.html#a0">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define FILE_DELIMITER '/'</span>
00083 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00084 <span class="preprocessor"></span>
00085 <span class="keyword">using</span> std::cerr;
00086 <span class="keyword">using</span> std::endl;
00087 <span class="keyword">using</span> std::ostringstream;
00088 <span class="keyword">using</span> std::ofstream;
00089 <span class="keyword">using</span> std::ifstream;
00090 
00091 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> TimLen = 26;   <span class="comment">// length of string from asctime()</span>
00092 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> CLUMP_SIZE = 1024; <span class="comment">// size of clumps to new in fmakeword()</span>
00093 
00107 <span class="keywordtype">bool</span>
<a name="l00108"></a><a class="code" href="cgi__util_8cc.html#a8">00108</a> <a class="code" href="cgi__util_8cc.html#a8">do_version</a>(<span class="keyword">const</span> string &amp;script_ver, <span class="keyword">const</span> string &amp;dataset_ver)
00109 {
00110     fprintf( stdout, <span class="stringliteral">"HTTP/1.0 200 OK\n"</span> ) ;
00111     fprintf( stdout, <span class="stringliteral">"XDODS-Server: %s\n"</span>, <a class="code" href="config__dap_8h.html#a11">DVR</a> ) ;
00112     fprintf( stdout, <span class="stringliteral">"Content-Type: text/plain\n"</span> ) ;
00113     fprintf( stdout, <span class="stringliteral">"\n"</span> ) ;
00114     
00115     fprintf( stdout, <span class="stringliteral">"Core software version: %s\n"</span>, <a class="code" href="config__dap_8h.html#a11">DVR</a> ) ;
00116 
00117     <span class="keywordflow">if</span> (script_ver != <span class="stringliteral">""</span>)
00118     fprintf( stdout, <span class="stringliteral">"Server Script Revision: %s\n"</span>, script_ver.c_str() ) ;
00119 
00120     <span class="keywordflow">if</span> (dataset_ver != <span class="stringliteral">""</span>)
00121     fprintf( stdout,  <span class="stringliteral">"Dataset version: %s\n"</span>, dataset_ver.c_str() ) ;
00122 
00123     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00124 }
00125 
00126 <span class="preprocessor">#ifndef WIN32</span>
00127 <span class="preprocessor"></span><span class="comment">// // 02/13/98 jhrg</span>
00149 <span class="comment"></span><span class="keywordtype">bool</span>
<a name="l00150"></a><a class="code" href="cgi__util_8cc.html#a9">00150</a> <a class="code" href="cgi__util_8cc.html#a9">do_data_transfer</a>(<span class="keywordtype">bool</span> compression, FILE *data_stream, <a class="code" href="classDDS.html">DDS</a> &amp;dds,
00151          <span class="keyword">const</span> string &amp;dataset, <span class="keyword">const</span> string &amp;constraint)
00152 {
00153     <span class="keywordflow">if</span> (compression) {
00154     <span class="keywordtype">int</span> childpid;
00155     FILE *data_sink = <a class="code" href="util_8cc.html#a10">compressor</a>(data_stream, childpid);
00156     <span class="keywordflow">if</span> (!dds.<a class="code" href="classDDS.html#DDSa47">send</a>(dataset, constraint, data_sink, <span class="keyword">true</span>)) {
00157         <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(<span class="stringliteral">"Could not send compressed data"</span>);
00158         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00159     }
00160     fclose(data_sink);
00161     <span class="keywordtype">int</span> pid;
00162     <span class="keywordflow">while</span> ((pid = waitpid(childpid, 0, 0)) &gt; 0) {
00163         <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"pid: "</span> &lt;&lt; pid &lt;&lt; endl);
00164     }
00165     }
00166     <span class="keywordflow">else</span> {
00167     <span class="keywordflow">if</span> (!dds.<a class="code" href="classDDS.html#DDSa47">send</a>(dataset, constraint, data_stream, <span class="keyword">false</span>)) {
00168         <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(<span class="stringliteral">"Could not send data"</span>);
00169         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00170     }
00171     }
00172 
00173     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00174 }
00175 <span class="preprocessor">#endif</span>
00176 <span class="preprocessor"></span>
00177 
00222 string
<a name="l00223"></a><a class="code" href="cgi__util_8cc.html#a10">00223</a> <a class="code" href="cgi__util_8cc.html#a10">find_ancillary_file</a>(string pathname, string ext, string dir, string file)
00224 {
00225     string::size_type slash = pathname.rfind(<span class="charliteral">'/'</span>) + 1;
00226     string directory = pathname.substr(0, slash);
00227     string filename = pathname.substr(slash);
00228     string basename = pathname.substr(slash, pathname.rfind(<span class="charliteral">'.'</span>)-slash);
00229 
00230     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"find ancillary file params: "</span> &lt;&lt; pathname &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; ext 
00231     &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; dir &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; file &lt;&lt; endl);
00232     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"find ancillary file comp: "</span> &lt;&lt; directory &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; filename
00233     &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; basename &lt;&lt; endl);
00234 
00235     string dot_ext = <span class="stringliteral">"."</span> + ext;
00236 
00237     string name = directory + basename + dot_ext;
00238     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00239     <span class="keywordflow">return</span> name;
00240 
00241     name = pathname + dot_ext;
00242     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00243     <span class="keywordflow">return</span> name;
00244 
00245     name = directory + ext;
00246     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00247     <span class="keywordflow">return</span> name;
00248 
00249     name = dir + basename + dot_ext;
00250     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00251     <span class="keywordflow">return</span> name;
00252 
00253     name = directory + file + dot_ext;
00254     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00255     <span class="keywordflow">return</span> name;
00256 
00257     name = dir + file + dot_ext;
00258     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00259     <span class="keywordflow">return</span> name;
00260 
00261     name = dir + ext;
00262     <span class="keywordflow">if</span> (access(name.c_str(), F_OK) == 0)
00263     <span class="keywordflow">return</span> name;
00264 
00265     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00266 }
00267 
00268 <span class="comment">// Given a pathname to a datafile, take that pathname apart and look for an</span>
00269 <span class="comment">// ancillary file that describes a group of datafiles of which this datafile</span>
00270 <span class="comment">// is a member. Assume that groups follow a simple naming convention where</span>
00271 <span class="comment">// files use either leading or trailing digits and a common basename to name</span>
00272 <span class="comment">// group memebrs. For example, 00stuff.hdf, 01stuff.hdf, 02stuff.hdf, ..., is</span>
00273 <span class="comment">// a group and is has `stuff' as its basename. </span>
00274 
00288 string
<a name="l00289"></a><a class="code" href="cgi__util_8cc.html#a11">00289</a> <a class="code" href="cgi__util_8cc.html#a11">find_group_ancillary_file</a>(string name, string ext)
00290 {
00291     <span class="comment">// Given /usr/local/data/stuff.01.nc</span>
00292     <span class="comment">// pathname = /usr/local/data, filename = stuff.01.nc and</span>
00293     <span class="comment">// rootname = stuff.01</span>
00294     string::size_type slash = name.find_last_of(<span class="charliteral">'/'</span>);
00295     string dirname = name.substr(0, slash);
00296     string filename = name.substr(slash+1);
00297     string rootname = filename.substr(0, filename.find_last_of(<span class="charliteral">'.'</span>));
00298 
00299     <span class="comment">// Instead of using regexs, scan the filename for leading and then</span>
00300     <span class="comment">// trailing digits.</span>
00301     string::iterator rootname_iter = rootname.begin();
00302     string::iterator rootname_end_iter = rootname.end();
00303     <span class="keywordflow">if</span> (isdigit(*rootname_iter)) {
00304     <span class="keywordflow">while</span>(rootname_iter != rootname_end_iter 
00305           &amp;&amp; isdigit(*++rootname_iter))
00306         ;
00307 
00308     <span class="comment">// We want: new_name = dirname + "/" + &lt;base&gt; + ext but without</span>
00309     <span class="comment">// creating a bunch of temp objects.</span>
00310     string new_name = dirname;
00311     new_name.append(<span class="stringliteral">"/"</span>);
00312     new_name.append(rootname_iter, rootname_end_iter);
00313     new_name.append(ext);
00314     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"New Name (iter): "</span> &lt;&lt; new_name &lt;&lt; endl);
00315     <span class="keywordflow">if</span> (access(new_name.c_str(), F_OK) == 0) {
00316         <span class="keywordflow">return</span> new_name;
00317     }
00318     }
00319 
00320     string::reverse_iterator rootname_riter = rootname.rbegin();
00321     string::reverse_iterator rootname_end_riter = rootname.rend();
00322     <span class="keywordflow">if</span> (isdigit(*rootname_riter)) {
00323     <span class="keywordflow">while</span>(rootname_riter != rootname_end_riter 
00324           &amp;&amp; isdigit(*++rootname_riter))
00325         ;
00326     string new_name = dirname;
00327     new_name.append(<span class="stringliteral">"/"</span>);
00328     <span class="comment">// I used reverse iters to scan rootname backwards. To avoid</span>
00329     <span class="comment">// reversing the fragement between end_riter and riter, pass append</span>
00330     <span class="comment">// regular iters obtained using reverse_iterator::base(). See Meyers</span>
00331     <span class="comment">// p. 123. 1/22/2002 jhrg</span>
00332     new_name.append(rootname_end_riter.base(), rootname_riter.base());
00333     new_name.append(ext);
00334     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"New Name (riter): "</span> &lt;&lt; new_name &lt;&lt; endl);
00335     <span class="keywordflow">if</span> (access(new_name.c_str(), F_OK) == 0) {
00336         <span class="keywordflow">return</span> new_name;
00337     }
00338     }
00339 
00340     <span class="comment">// If we're here either the file does not begin with leading digits or a</span>
00341     <span class="comment">// template made by removing those digits was not found.</span>
00342 
00343     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00344 }
00345 
00355 <span class="keywordtype">void</span> 
<a name="l00356"></a><a class="code" href="cgi__util_8cc.html#a12">00356</a> <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(<span class="keyword">const</span> string &amp;Msgt)
00357 {
00358     time_t TimBin;
00359     <span class="keywordtype">char</span> TimStr[TimLen];
00360 
00361     <span class="keywordflow">if</span> (time(&amp;TimBin) == (time_t)-1)
00362     strcpy(TimStr, <span class="stringliteral">"time() error           "</span>);
00363     <span class="keywordflow">else</span> {
00364     strcpy(TimStr, ctime(&amp;TimBin));
00365     TimStr[TimLen - 2] = <span class="charliteral">'\0'</span>; <span class="comment">// overwrite the \n </span>
00366     }
00367 
00368     <span class="keyword">const</span> <span class="keywordtype">char</span> *host_or_addr = getenv(<span class="stringliteral">"REMOTE_HOST"</span>) ? getenv(<span class="stringliteral">"REMOTE_HOST"</span>) :
00369     getenv(<span class="stringliteral">"REMOTE_ADDR"</span>) ? getenv(<span class="stringliteral">"REMOTE_ADDR"</span>) : <span class="stringliteral">"local (a non-CGI run)"</span>; 
00370     <span class="keyword">const</span> <span class="keywordtype">char</span> *script = getenv(<span class="stringliteral">"SCRIPT_NAME"</span>) ? getenv(<span class="stringliteral">"SCRIPT_NAME"</span>) : 
00371     <span class="stringliteral">"DODS server"</span>; 
00372 
00373     cerr &lt;&lt; <span class="stringliteral">"["</span> &lt;&lt; TimStr &lt;&lt; <span class="stringliteral">"] CGI: "</span> &lt;&lt; script &lt;&lt; <span class="stringliteral">" failed for "</span> 
00374      &lt;&lt; host_or_addr &lt;&lt; <span class="stringliteral">": "</span>&lt;&lt; Msgt &lt;&lt; endl;
00375 }
00376 
00377 <span class="comment">// Given a pathname, return just the filename component with any extension</span>
00378 <span class="comment">// removed. The new string resides in newly allocated memory; the caller must</span>
00379 <span class="comment">// delete it when done using the filename.</span>
00380 <span class="comment">// Originally from the netcdf distribution (ver 2.3.2).</span>
00381 <span class="comment">// </span>
00382 <span class="comment">// *** Change to string class argument and return type. jhrg</span>
00383 <span class="comment">// *** Changed so it also removes the#path#of#the#file# from decompressed</span>
00384 <span class="comment">//     files.  rph.</span>
00385 <span class="comment">// Returns: A filename, with path and extension information removed. If</span>
00386 <span class="comment">// memory for the new name cannot be allocated, does not return!</span>
00387 
00398 string
<a name="l00399"></a><a class="code" href="cgi__util_8cc.html#a13">00399</a> <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(<span class="keyword">const</span> string &amp;path)
00400 {
00401     <span class="keywordflow">if</span> (path == <span class="stringliteral">""</span>)
00402     <span class="keywordflow">return</span> string(<span class="stringliteral">""</span>);
00403 
00404     string::size_type delim = path.find_last_of(<a class="code" href="cgi__util_8cc.html#a0">FILE_DELIMITER</a>);
00405     string::size_type pound = path.find_last_of(<span class="stringliteral">"#"</span>);
00406     string new_path;
00407     
00408     <span class="keywordflow">if</span>(pound != string::npos)
00409         new_path = path.substr(pound + 1);
00410     <span class="keywordflow">else</span>
00411         new_path = path.substr(delim + 1);
00412 
00413     <span class="keywordflow">return</span> new_path;
00414 }
00415 
00416 <span class="comment">// Return a MIME rfc-822 date. The grammar for this is:</span>
00417 <span class="comment">//       date-time   =  [ day "," ] date time        ; dd mm yy</span>
00418 <span class="comment">//                                                   ;  hh:mm:ss zzz</span>
00419 <span class="comment">//</span>
00420 <span class="comment">//       day         =  "Mon"  / "Tue" /  "Wed"  / "Thu"</span>
00421 <span class="comment">//                   /  "Fri"  / "Sat" /  "Sun"</span>
00422 <span class="comment">//</span>
00423 <span class="comment">//       date        =  1*2DIGIT month 2DIGIT        ; day month year</span>
00424 <span class="comment">//                                                   ;  e.g. 20 Jun 82</span>
00425 <span class="comment">//                   NB: year is 4 digit; see RFC 1123. 11/30/99 jhrg</span>
00426 <span class="comment">//</span>
00427 <span class="comment">//       month       =  "Jan"  /  "Feb" /  "Mar"  /  "Apr"</span>
00428 <span class="comment">//                   /  "May"  /  "Jun" /  "Jul"  /  "Aug"</span>
00429 <span class="comment">//                   /  "Sep"  /  "Oct" /  "Nov"  /  "Dec"</span>
00430 <span class="comment">//</span>
00431 <span class="comment">//       time        =  hour zone                    ; ANSI and Military</span>
00432 <span class="comment">//</span>
00433 <span class="comment">//       hour        =  2DIGIT ":" 2DIGIT [":" 2DIGIT]</span>
00434 <span class="comment">//                                                   ; 00:00:00 - 23:59:59</span>
00435 <span class="comment">//</span>
00436 <span class="comment">//       zone        =  "UT"  / "GMT"                ; Universal Time</span>
00437 <span class="comment">//                                                   ; North American : UT</span>
00438 <span class="comment">//                   /  "EST" / "EDT"                ;  Eastern:  - 5/ - 4</span>
00439 <span class="comment">//                   /  "CST" / "CDT"                ;  Central:  - 6/ - 5</span>
00440 <span class="comment">//                   /  "MST" / "MDT"                ;  Mountain: - 7/ - 6</span>
00441 <span class="comment">//                   /  "PST" / "PDT"                ;  Pacific:  - 8/ - 7</span>
00442 <span class="comment">//                   /  1ALPHA                       ; Military: Z = UT;</span>
00443 <span class="comment">//                                                   ;  A:-1; (J not used)</span>
00444 <span class="comment">//                                                   ;  M:-12; N:+1; Y:+12</span>
00445 <span class="comment">//                   / ( ("+" / "-") 4DIGIT )        ; Local differential</span>
00446 <span class="comment">//                                                   ;  hours+min. (HHMM)</span>
00447 
00448 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *days[]={<span class="stringliteral">"Sun"</span>, <span class="stringliteral">"Mon"</span>, <span class="stringliteral">"Tue"</span>, <span class="stringliteral">"Wed"</span>, <span class="stringliteral">"Thu"</span>, <span class="stringliteral">"Fri"</span>, <span class="stringliteral">"Sat"</span>};
00449 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *months[]={<span class="stringliteral">"Jan"</span>, <span class="stringliteral">"Feb"</span>, <span class="stringliteral">"Mar"</span>, <span class="stringliteral">"Apr"</span>, <span class="stringliteral">"May"</span>, <span class="stringliteral">"Jun"</span>, <span class="stringliteral">"Jul"</span>, 
00450             <span class="stringliteral">"Aug"</span>, <span class="stringliteral">"Sep"</span>, <span class="stringliteral">"Oct"</span>, <span class="stringliteral">"Nov"</span>, <span class="stringliteral">"Dec"</span>};
00451 
00460 string
<a name="l00461"></a><a class="code" href="cgi__util_8cc.html#a14">00461</a> <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(<span class="keyword">const</span> time_t t)
00462 {
00463     <span class="keyword">struct </span>tm *stm = gmtime(&amp;t);
00464     <span class="keywordtype">char</span> d[256];
00465 
00466     sprintf(d, <span class="stringliteral">"%s, %02d %s %4d %02d:%02d:%02d GMT"</span>, days[stm-&gt;tm_wday], 
00467         stm-&gt;tm_mday, months[stm-&gt;tm_mon], 
00468 #<span class="keywordflow">if</span> 0
00469         <span class="comment">// On Solaris 2.7 this tm_year is years since 1900. 3/17/2000</span>
00470         <span class="comment">// jhrg</span>
00471         stm-&gt;tm_year &lt; 100 ? 1900 + stm-&gt;tm_year : stm-&gt;tm_year, 
00472 #endif
00473         1900 + stm-&gt;tm_year,
00474         stm-&gt;tm_hour, stm-&gt;tm_min, stm-&gt;tm_sec);
00475     <span class="keywordflow">return</span> string(d);
00476 }
00477 
00483 time_t
<a name="l00484"></a><a class="code" href="cgi__util_8cc.html#a15">00484</a> <a class="code" href="cgi__util_8cc.html#a15">last_modified_time</a>(string name)
00485 {
00486     <span class="keyword">struct </span>stat m;
00487 
00488     <span class="keywordflow">if</span> (stat(name.c_str(), &amp;m) == 0 &amp;&amp; (S_IFREG &amp; m.st_mode))
00489 
00490     <span class="keywordflow">return</span> m.st_mtime;
00491     <span class="keywordflow">else</span>
00492     <span class="keywordflow">return</span> time(0);
00493 }
00494 
00495 <span class="comment">// Send string to set the transfer (mime) type and server version</span>
00496 <span class="comment">// Note that the content description filed is used to indicate whether valid</span>
00497 <span class="comment">// information of an error message is contained in the document and the</span>
00498 <span class="comment">// content-encoding field is used to indicate whether the data is compressed.</span>
00499 <span class="comment">// If the data stream is to be compressed, arrange for a compression output</span>
00500 <span class="comment">// filter so that all information sent after the header will be compressed.</span>
00501 <span class="comment">//</span>
00502 <span class="comment">// Returns: false if the compression output filter was to be used but could</span>
00503 <span class="comment">// not be started, true otherwise.</span>
00504 
00505 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *descrip[]={<span class="stringliteral">"unknown"</span>, <span class="stringliteral">"dods_das"</span>, <span class="stringliteral">"dods_dds"</span>, <span class="stringliteral">"dods_data"</span>,
00506             <span class="stringliteral">"dods_error"</span>, <span class="stringliteral">"web_error"</span>};
00507 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *encoding[]={<span class="stringliteral">"unknown"</span>, <span class="stringliteral">"deflate"</span>, <span class="stringliteral">"x-plain"</span>};
00508 
00521 <span class="keywordtype">void</span>
<a name="l00522"></a><a class="code" href="cgi__util_8cc.html#a16">00522</a> <a class="code" href="cgi__util_8cc.html#a16">set_mime_text</a>(FILE *out, ObjectType type, <span class="keyword">const</span> string &amp;ver, 
00523           EncodingType enc, <span class="keyword">const</span> time_t last_modified)
00524 {
00525     fprintf( out, <span class="stringliteral">"HTTP/1.0 200 OK\n"</span> ) ;
00526     fprintf( out, <span class="stringliteral">"XDODS-Server: %s\n"</span>, ver.c_str() ) ;
00527 
00528     <span class="keyword">const</span> time_t t = time(0);
00529     fprintf( out, <span class="stringliteral">"Date: %s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t).c_str() ) ;
00530 
00531     fprintf( out, <span class="stringliteral">"Last-Modified: "</span> ) ;
00532     <span class="keywordflow">if</span> (last_modified &gt; 0)
00533     fprintf( out, <span class="stringliteral">"%s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(last_modified).c_str() ) ;
00534     <span class="keywordflow">else</span> 
00535     fprintf( out, <span class="stringliteral">"%s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t).c_str() ) ;
00536 
00537     fprintf( out, <span class="stringliteral">"Content-type: text/plain\n"</span> ) ;
00538     fprintf( out, <span class="stringliteral">"Content-Description: %s\n"</span>, descrip[type] ) ;
00539     <span class="keywordflow">if</span> (type == <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>) <span class="comment">// don't cache our error responses.</span>
00540     fprintf( out, <span class="stringliteral">"Cache-Control: no-cache\n"</span> ) ;
00541     <span class="comment">// Don't write a Content-Encoding header for x-plain since that breaks</span>
00542     <span class="comment">// Netscape on NT. jhrg 3/23/97</span>
00543     <span class="keywordflow">if</span> (enc != <a class="code" href="EncodingType_8h.html#a3a2">x_plain</a>)
00544     fprintf( out, <span class="stringliteral">"Content-Encoding: %s\n"</span>, encoding[enc] ) ;
00545     fprintf( out, <span class="stringliteral">"\n"</span> ) ;
00546 }
00547 
00563 <span class="keywordtype">void</span>
<a name="l00564"></a><a class="code" href="cgi__util_8cc.html#a17">00564</a> <a class="code" href="cgi__util_8cc.html#a16">set_mime_text</a>(ostream &amp;os, ObjectType type, <span class="keyword">const</span> string &amp;ver, 
00565           EncodingType enc, <span class="keyword">const</span> time_t last_modified)
00566 {
00567     os &lt;&lt; <span class="stringliteral">"HTTP/1.0 200 OK"</span> &lt;&lt; endl;
00568     os &lt;&lt; <span class="stringliteral">"XDODS-Server: "</span> &lt;&lt; ver &lt;&lt; endl;
00569 
00570     <span class="keyword">const</span> time_t t = time(0);
00571     os &lt;&lt; <span class="stringliteral">"Date: "</span> &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t) &lt;&lt; endl;
00572 
00573     os &lt;&lt; <span class="stringliteral">"Last-Modified: "</span>;
00574     <span class="keywordflow">if</span> (last_modified &gt; 0)
00575     os &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(last_modified) &lt;&lt; endl;
00576     <span class="keywordflow">else</span> 
00577     os &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t) &lt;&lt; endl;
00578 
00579     os &lt;&lt; <span class="stringliteral">"Content-type: text/plain"</span> &lt;&lt; endl; 
00580     os &lt;&lt; <span class="stringliteral">"Content-Description: "</span> &lt;&lt; descrip[type] &lt;&lt; endl;
00581     <span class="keywordflow">if</span> (type == <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>) <span class="comment">// don't cache our error responses.</span>
00582     os &lt;&lt; <span class="stringliteral">"Cache-Control: no-cache"</span> &lt;&lt; endl;
00583     <span class="comment">// Don't write a Content-Encoding header for x-plain since that breaks</span>
00584     <span class="comment">// Netscape on NT. jhrg 3/23/97</span>
00585     <span class="keywordflow">if</span> (enc != <a class="code" href="EncodingType_8h.html#a3a2">x_plain</a>)
00586     os &lt;&lt; <span class="stringliteral">"Content-Encoding: "</span> &lt;&lt; encoding[enc] &lt;&lt; endl;
00587     os &lt;&lt; endl;
00588 }
00589 
00603 <span class="keywordtype">void</span>
<a name="l00604"></a><a class="code" href="cgi__util_8cc.html#a18">00604</a> <a class="code" href="cgi__util_8cc.html#a18">set_mime_binary</a>(FILE *out, ObjectType type, <span class="keyword">const</span> string &amp;ver, 
00605         EncodingType enc, <span class="keyword">const</span> time_t last_modified)
00606 {
00607     fprintf( out, <span class="stringliteral">"HTTP/1.0 200 OK\n"</span> ) ;
00608     fprintf( out, <span class="stringliteral">"XDODS-Server: %s\n"</span>, ver.c_str() ) ;
00609     <span class="keyword">const</span> time_t t = time(0);
00610     fprintf( out, <span class="stringliteral">"Date: %s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t).c_str() ) ;
00611 
00612     fprintf( out, <span class="stringliteral">"Last-Modified: "</span> ) ;
00613     <span class="keywordflow">if</span> (last_modified &gt; 0)
00614     fprintf( out, <span class="stringliteral">"%s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(last_modified).c_str() ) ;
00615     <span class="keywordflow">else</span> 
00616     fprintf( out, <span class="stringliteral">"%s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t).c_str() ) ;
00617 
00618     fprintf( out, <span class="stringliteral">"Content-Type: application/octet-stream\n"</span> ) ;
00619     fprintf( out, <span class="stringliteral">"Content-Description: %s\n"</span>, descrip[type] ) ;
00620     <span class="keywordflow">if</span> (enc != <a class="code" href="EncodingType_8h.html#a3a2">x_plain</a>)
00621     fprintf( out, <span class="stringliteral">"Content-Encoding: %s\n"</span>, encoding[enc] ) ;
00622 
00623     fprintf( out, <span class="stringliteral">"\n"</span> ) ;
00624 }
00625 
00641 <span class="keywordtype">void</span>
<a name="l00642"></a><a class="code" href="cgi__util_8cc.html#a19">00642</a> <a class="code" href="cgi__util_8cc.html#a18">set_mime_binary</a>(ostream &amp;os, ObjectType type, <span class="keyword">const</span> string &amp;ver, 
00643         EncodingType enc, <span class="keyword">const</span> time_t last_modified)
00644 {
00645     os &lt;&lt; <span class="stringliteral">"HTTP/1.0 200 OK"</span> &lt;&lt; endl;
00646     os &lt;&lt; <span class="stringliteral">"XDODS-Server: "</span> &lt;&lt; ver &lt;&lt; endl;
00647     <span class="keyword">const</span> time_t t = time(0);
00648     os &lt;&lt; <span class="stringliteral">"Date: "</span> &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t) &lt;&lt; endl;
00649 
00650     os &lt;&lt; <span class="stringliteral">"Last-Modified: "</span>;
00651     <span class="keywordflow">if</span> (last_modified &gt; 0)
00652     os &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(last_modified) &lt;&lt; endl;
00653     <span class="keywordflow">else</span> 
00654     os &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t) &lt;&lt; endl;
00655 
00656     os &lt;&lt; <span class="stringliteral">"Content-Type: application/octet-stream"</span> &lt;&lt; endl; 
00657     os &lt;&lt; <span class="stringliteral">"Content-Description: "</span> &lt;&lt; descrip[type] &lt;&lt; endl;
00658     <span class="keywordflow">if</span> (enc != <a class="code" href="EncodingType_8h.html#a3a2">x_plain</a>)
00659     os &lt;&lt; <span class="stringliteral">"Content-Encoding: "</span> &lt;&lt; encoding[enc] &lt;&lt; endl;
00660 
00661     os &lt;&lt; endl;
00662 }
00663 
00670 <span class="keywordtype">void</span> 
<a name="l00671"></a><a class="code" href="cgi__util_8cc.html#a20">00671</a> <a class="code" href="cgi__util_8cc.html#a20">set_mime_error</a>(FILE *out, <span class="keywordtype">int</span> code, <span class="keyword">const</span> string &amp;reason,
00672            <span class="keyword">const</span> string &amp;version)
00673 {
00674     fprintf( out, <span class="stringliteral">"HTTP/1.0 %d %s\n"</span>, code, reason.c_str() ) ;
00675     <span class="keywordflow">if</span> (<a class="code" href="das-test_8cc.html#a4">version</a> == <span class="stringliteral">""</span>)
00676       fprintf( out, <span class="stringliteral">"XDODS-Server: %s\n"</span>, <a class="code" href="config__dap_8h.html#a11">DVR</a> ) ;
00677     <span class="keywordflow">else</span>
00678       fprintf( out, <span class="stringliteral">"XDODS-Server: %s\n"</span>, <a class="code" href="das-test_8cc.html#a4">version</a>.c_str() ) ;
00679     <span class="keyword">const</span> time_t t = time(0);
00680     fprintf( out, <span class="stringliteral">"Date: %s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t).c_str() ) ;
00681     fprintf( out, <span class="stringliteral">"Cache-Control: no-cache\n"</span> ) ;
00682     fprintf( out, <span class="stringliteral">"\n"</span> ) ;
00683 }
00684 
00695 <span class="keywordtype">void</span>
<a name="l00696"></a><a class="code" href="cgi__util_8cc.html#a21">00696</a> <a class="code" href="cgi__util_8cc.html#a20">set_mime_error</a>(ostream &amp;os, <span class="keywordtype">int</span> code, <span class="keyword">const</span> string &amp;reason,
00697            <span class="keyword">const</span> string &amp;version)
00698 {
00699     os &lt;&lt; <span class="stringliteral">"HTTP/1.0 "</span> &lt;&lt; code &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; reason &lt;&lt; endl;
00700     <span class="keywordflow">if</span> (<a class="code" href="das-test_8cc.html#a4">version</a> == <span class="stringliteral">""</span>)
00701       os &lt;&lt; <span class="stringliteral">"XDODS-Server: "</span> &lt;&lt; <a class="code" href="config__dap_8h.html#a11">DVR</a> &lt;&lt; endl;
00702     <span class="keywordflow">else</span>
00703       os &lt;&lt; <span class="stringliteral">"XDODS-Server: "</span> &lt;&lt; <a class="code" href="das-test_8cc.html#a4">version</a> &lt;&lt; endl;
00704     <span class="keyword">const</span> time_t t = time(0);
00705     os &lt;&lt; <span class="stringliteral">"Date: "</span> &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t) &lt;&lt; endl;
00706     os &lt;&lt; <span class="stringliteral">"Cache-Control: no-cache"</span> &lt;&lt; endl;
00707     os &lt;&lt; endl;
00708 }
00709 
00717 <span class="keywordtype">void</span> 
<a name="l00718"></a><a class="code" href="cgi__util_8cc.html#a22">00718</a> <a class="code" href="cgi__util_8cc.html#a22">set_mime_not_modified</a>(FILE *out)
00719 {
00720     fprintf( out, <span class="stringliteral">"HTTP/1.0 304 NOT MODIFIED\n"</span> ) ;
00721     <span class="keyword">const</span> time_t t = time(0);
00722     fprintf( out, <span class="stringliteral">"Date: %s\n"</span>, <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t).c_str() ) ;
00723     fprintf( out, <span class="stringliteral">"\n"</span> ) ;
00724 }
00725 
00734 <span class="keywordtype">void</span>
<a name="l00735"></a><a class="code" href="cgi__util_8cc.html#a23">00735</a> <a class="code" href="cgi__util_8cc.html#a22">set_mime_not_modified</a>(ostream &amp;os)
00736 {
00737     os &lt;&lt; <span class="stringliteral">"HTTP/1.0 304 NOT MODIFIED"</span> &lt;&lt; endl;
00738     <span class="keyword">const</span> time_t t = time(0);
00739     os &lt;&lt; <span class="stringliteral">"Date: "</span> &lt;&lt; <a class="code" href="cgi__util_8cc.html#a14">rfc822_date</a>(t) &lt;&lt; endl;
00740     os &lt;&lt; endl;
00741 }
00742 
00751 <span class="keywordtype">bool</span>
<a name="l00752"></a><a class="code" href="cgi__util_8cc.html#a24">00752</a> <a class="code" href="cgi__util_8cc.html#a24">found_override</a>(string name, string &amp;doc)
00753 {
00754     ifstream ifs((name + <span class="stringliteral">".ovr"</span>).c_str());
00755     <span class="keywordflow">if</span> (!ifs)
00756     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00757 
00758     <span class="keywordtype">char</span> tmp[256];
00759     doc = <span class="stringliteral">""</span>;
00760     <span class="keywordflow">while</span> (!ifs.eof()) {
00761     ifs.getline(tmp, 255);
00762     strcat(tmp, <span class="stringliteral">"\n"</span>);
00763     doc += tmp;
00764     }
00765 
00766     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00767 }
00768 
00777 <span class="keywordtype">bool</span>
<a name="l00778"></a><a class="code" href="cgi__util_8cc.html#a25">00778</a> <a class="code" href="cgi__util_8cc.html#a25">remove_mime_header</a>(FILE *in)
00779 {
00780     <span class="keywordtype">char</span> tmp[256];
00781     <span class="keywordflow">while</span> (!feof(in)) {
00782     fgets(tmp, 255, in);
00783     <span class="keywordflow">if</span> (tmp[0] == <span class="charliteral">'\n'</span>)
00784         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00785     }
00786 
00787     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00788 }    
00789 
00790 
00818 string
<a name="l00819"></a><a class="code" href="cgi__util_8cc.html#a26">00819</a> <a class="code" href="cgi__util_8cc.html#a26">get_user_supplied_docs</a>(string name, string cgi)
00820 {
00821     <span class="keywordtype">char</span> tmp[256];
00822     ostringstream oss;
00823     ifstream ifs((cgi + <span class="stringliteral">".html"</span>).c_str());
00824 
00825     <span class="keywordflow">if</span> (ifs) {
00826     <span class="keywordflow">while</span> (!ifs.eof()) {
00827         ifs.getline(tmp, 255);
00828         oss &lt;&lt; tmp &lt;&lt; <span class="stringliteral">"\n"</span>;
00829     }
00830     ifs.close();
00831     
00832     oss &lt;&lt; <span class="stringliteral">"&lt;hr&gt;"</span>;
00833     }
00834 
00835     ifs.open((name + <span class="stringliteral">".html"</span>).c_str());
00836 
00837     <span class="comment">// If name.html cannot be opened, look for basename.html</span>
00838     <span class="keywordflow">if</span> (!ifs) {
00839     string new_name = <a class="code" href="cgi__util_8cc.html#a11">find_group_ancillary_file</a>(name, <span class="stringliteral">".html"</span>);
00840     <span class="keywordflow">if</span> (new_name != <span class="stringliteral">""</span>)
00841         ifs.open(new_name.c_str());
00842     }
00843 
00844     <span class="keywordflow">if</span> (ifs) {
00845     <span class="keywordflow">while</span> (!ifs.eof()) {
00846         ifs.getline(tmp, 255);
00847         oss &lt;&lt; tmp &lt;&lt; <span class="stringliteral">"\n"</span>;
00848     }
00849     ifs.close();
00850     }
00851 
00852     <span class="keywordflow">return</span> oss.str();
00853 }
00854 
00855 <span class="comment">// This test code is pretty much obsolete; look at cgiUtilTest.cc 4/17/2001</span>
00856 <span class="comment">// jhrg.</span>
00857 
00858 <span class="preprocessor">#ifdef TEST_CGI_UTIL</span>
00859 <span class="preprocessor"></span>
00860 <span class="keywordtype">int</span>
00861 <a class="code" href="usage_8cc.html#a17">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
00862 {
00863     <span class="comment">// test ErrMsgT</span>
00864     <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(<span class="stringliteral">"Error"</span>);
00865     string smsg = <span class="stringliteral">"String Error"</span>;
00866     <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(smsg);
00867     <span class="keywordtype">char</span> *cmsg = <span class="stringliteral">"char * error"</span>;
00868     <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(cmsg);
00869     <a class="code" href="cgi__util_8cc.html#a12">ErrMsgT</a>(<span class="stringliteral">""</span>);
00870 
00871     <span class="comment">// test name_path</span>
00872     string name_path_p;
00873     string name = <span class="stringliteral">"stuff"</span>;
00874     name_path_p = <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(name);
00875     fprintf( stdout, <span class="stringliteral">"%s: %s\n"</span>, name.c_str(), name_path_p.c_str() ) ;
00876 
00877     name = <span class="stringliteral">"stuff.Z"</span>;
00878     name_path_p = <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(name);
00879     fprintf( stdout, <span class="stringliteral">"%s: %s\n"</span>, name.c_str(), name_path_p.c_str() ) ;
00880 
00881     name = <span class="stringliteral">"/usr/local/src/stuff.Z"</span>;
00882     name_path_p = <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(name);
00883     fprintf( stdout, <span class="stringliteral">"%s: %s\n"</span>, name.c_str(), name_path_p.c_str() ) ;
00884 
00885     name = <span class="stringliteral">"/usr/local/src/stuff.tar.Z"</span>;
00886     name_path_p = <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(name);
00887     fprintf( stdout, <span class="stringliteral">"%s: %s\n"</span>, name.c_str(), name_path_p.c_str() ) ;
00888 
00889     name = <span class="stringliteral">"/usr/local/src/stuff"</span>;
00890     name_path_p = <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(name);
00891     fprintf( stdout, <span class="stringliteral">"%s: %s\n"</span>, name.c_str(), name_path_p.c_str() ) ;
00892 
00893     name = <span class="stringliteral">""</span>;
00894     name_path_p = <a class="code" href="cgi__util_8cc.html#a13">name_path</a>(name);
00895     fprintf( stdout, <span class="stringliteral">"%s: %s\n"</span>, name.c_str(), name_path_p.c_str() ) ;
00896 
00897     <span class="comment">// Test mime header generators and compressed output</span>
00898     fprintf( stdout, <span class="stringliteral">"MIME text header:\n"</span> ) ;
00899     <a class="code" href="cgi__util_8cc.html#a16">set_mime_text</a>(stdout, dods_das, <span class="stringliteral">"dods-test/0.00"</span>);
00900     fprintf( stdout, <span class="stringliteral">"MIME binary header:\n"</span> ) ;
00901     <a class="code" href="cgi__util_8cc.html#a18">set_mime_binary</a>(stdout, dods_data, <span class="stringliteral">"dods-test/0.00"</span>);
00902 
00903 <span class="preprocessor">#if 0</span>
00904 <span class="preprocessor"></span>    fprintf( stdout, <span class="stringliteral">"Some data...\n"</span> ) ;
00905 
00906     fprintf( stdout, <span class="stringliteral">"MIME binary header and compressed data:\n"</span> ) ;
00907     <a class="code" href="cgi__util_8cc.html#a18">set_mime_binary</a>(dods_data, x_gzip);
00908     FILE *out = compress_stdout();
00909     fprintf(out, <span class="stringliteral">"Compresses data...\n"</span>);
00910     fflush(out);
00911     pclose(out);
00912 <span class="preprocessor">#endif</span>
00913 <span class="preprocessor"></span>}
00914 
00915 <span class="preprocessor">#endif</span>
00916 <span class="preprocessor"></span>
00917 <span class="comment">// $Log: cgi__util_8cc-source.html,v $
00917 <span class="comment">// Revision 1.4  2004/02/05 06:51:17  jimg
00917 <span class="comment">// Added/update.
00917 <span class="comment">//</span>
00918 <span class="comment">// Revision 1.57.2.6  2004/02/04 00:05:11  jimg</span>
00919 <span class="comment">// Memory errors: I've fixed a number of memory errors (leaks, references)</span>
00920 <span class="comment">// found using valgrind. Many remain. I need to come up with a systematic</span>
00921 <span class="comment">// way of running the tests under valgrind.</span>
00922 <span class="comment">//</span>
00923 <span class="comment">// Revision 1.57.2.5  2003/11/25 18:19:30  jimg</span>
00924 <span class="comment">// Comments...</span>
00925 <span class="comment">//</span>
00926 <span class="comment">// Revision 1.57.2.4  2003/09/06 22:59:31  jimg</span>
00927 <span class="comment">// Updated the documentation.</span>
00928 <span class="comment">//</span>
00929 <span class="comment">// Revision 1.57.2.3  2003/08/21 18:23:26  edavis</span>
00930 <span class="comment">// Changed how remote host name is found so that it will never be null</span>
00931 <span class="comment">// (which happens when CGI tools are run locally). A null value caused</span>
00932 <span class="comment">// the error message to fail on some platforms which caused several</span>
00933 <span class="comment">// tests to fail on those platforms.</span>
00934 <span class="comment">//</span>
00935 <span class="comment">// Revision 1.57.2.2  2003/07/16 04:23:43  jimg</span>
00936 <span class="comment">// I removed some old code from the set_mime_binary() functions.</span>
00937 <span class="comment">//</span>
00938 <span class="comment">// Revision 1.57.2.1  2003/06/05 20:15:26  jimg</span>
00939 <span class="comment">// Removed many uses of strstream and replaced them with stringstream.</span>
00940 <span class="comment">//</span>
00941 <span class="comment">// Revision 1.57  2003/04/22 19:40:28  jimg</span>
00942 <span class="comment">// Merged with 3.3.1.</span>
00943 <span class="comment">//</span>
00944 <span class="comment">// Revision 1.56  2003/02/21 00:14:25  jimg</span>
00945 <span class="comment">// Repaired copyright.</span>
00946 <span class="comment">//</span>
00947 <span class="comment">// Revision 1.55.2.1  2003/02/21 00:10:07  jimg</span>
00948 <span class="comment">// Repaired copyright.</span>
00949 <span class="comment">//</span>
00950 <span class="comment">// Revision 1.55  2003/01/23 00:22:24  jimg</span>
00951 <span class="comment">// Updated the copyright notice; this implementation of the DAP is</span>
00952 <span class="comment">// copyrighted by OPeNDAP, Inc.</span>
00953 <span class="comment">//</span>
00954 <span class="comment">// Revision 1.54  2003/01/10 19:46:40  jimg</span>
00955 <span class="comment">// Merged with code tagged release-3-2-10 on the release-3-2 branch. In many</span>
00956 <span class="comment">// cases files were added on that branch (so they appear on the trunk for</span>
00957 <span class="comment">// the first time).</span>
00958 <span class="comment">//</span>
00959 <span class="comment">// Revision 1.47.4.22  2002/12/17 22:35:03  pwest</span>
00960 <span class="comment">// Added and updated methods using stdio. Deprecated methods using iostream.</span>
00961 <span class="comment">//</span>
00962 <span class="comment">// Revision 1.47.4.21  2002/10/23 17:40:38  jimg</span>
00963 <span class="comment">// Added compile-time switch for time.h versus sys/time.h.</span>
00964 <span class="comment">//</span>
00965 <span class="comment">// Revision 1.47.4.20  2002/08/22 21:23:23  jimg</span>
00966 <span class="comment">// Fixes for the Win32 Build made at ESRI by Vlad Plenchoy and myslef.</span>
00967 <span class="comment">//</span>
00968 <span class="comment">// Revision 1.47.4.19  2002/08/08 06:54:57  jimg</span>
00969 <span class="comment">// Changes for thread-safety. In many cases I found ugly places at the</span>
00970 <span class="comment">// tops of files while looking for globals, et c., and I fixed them up</span>
00971 <span class="comment">// (hopefully making them easier to read, ...). Only the files RCReader.cc</span>
00972 <span class="comment">// and usage.cc actually use pthreads synchronization functions. In other</span>
00973 <span class="comment">// cases I removed static objects where they were used for supposed</span>
00974 <span class="comment">// improvements in efficiency which had never actually been verifiied (and</span>
00975 <span class="comment">// which looked dubious).</span>
00976 <span class="comment">//</span>
00977 <span class="comment">// Revision 1.47.4.18  2002/06/18 22:52:19  jimg</span>
00978 <span class="comment">// Remove do_data_transfer(); use the corresponding DODSFilter method instead.</span>
00979 <span class="comment">//</span>
00980 <span class="comment">// Revision 1.53  2002/06/18 15:36:24  tom</span>
00981 <span class="comment">// Moved comments and edited to accommodate doxygen documentation-generator.</span>
00982 <span class="comment">//</span>
00983 <span class="comment">// Revision 1.52  2002/06/03 22:21:15  jimg</span>
00984 <span class="comment">// Merged with release-3-2-9</span>
00985 <span class="comment">//</span>
00986 <span class="comment">// Revision 1.47.4.17  2002/03/29 18:33:03  jimg</span>
00987 <span class="comment">// Some code that was meant to help with debuggin inadvertantly made it</span>
00988 <span class="comment">// into CVS wihout the DBG macros; I added them.</span>
00989 <span class="comment">//</span>
00990 <span class="comment">// Revision 1.47.4.16  2002/03/26 19:58:10  jimg</span>
00991 <span class="comment">// I changed the way name_path works so that the whole filename is now used as</span>
00992 <span class="comment">// the dataset name. This means that extensions to the filename are not stripped</span>
00993 <span class="comment">// off which also fixes bug 64; that filename that contained dots were chopped</span>
00994 <span class="comment">// up.</span>
00995 <span class="comment">//</span>
00996 <span class="comment">// Revision 1.47.4.15  2002/03/12 19:06:45  jimg</span>
00997 <span class="comment">// Fix for bug 400. Files which end in extensions that indicate they're</span>
00998 <span class="comment">// compressed were breaking the function find_ancillary_file().</span>
00999 <span class="comment">// Added searches for &lt;directory&gt;/&lt;ext&gt; to find_ancillary_file(). This means</span>
01000 <span class="comment">// that a DAS that should be applied to a group of files can be by simply</span>
01001 <span class="comment">// including the DAS in a file called `das' and putting that in the directory</span>
01002 <span class="comment">// that contains the files.</span>
01003 <span class="comment">//</span>
01004 <span class="comment">// Revision 1.47.4.14  2002/02/05 03:23:46  rmorris</span>
01005 <span class="comment">// Added some things VC++ needs in the std namespace after James moved</span>
01006 <span class="comment">// things around a little in this file (ends, ostrstream &amp; ifstream).</span>
01007 <span class="comment">//</span>
01008 <span class="comment">// Revision 1.47.4.13  2002/02/04 17:34:10  jimg</span>
01009 <span class="comment">// I removed a lot of code that was duplicated from src/dap/usage.cc into cgi_util.</span>
01010 <span class="comment">//</span>
01011 <span class="comment">// Revision 1.47.4.12  2002/01/23 20:33:18  jimg</span>
01012 <span class="comment">// The function read_ancillary_das and _dds are no longer here (i've</span>
01013 <span class="comment">// commented them out of the code). Use DODSFilter instead.</span>
01014 <span class="comment">//</span>
01015 <span class="comment">// Revision 1.47.4.11  2002/01/23 03:18:38  jimg</span>
01016 <span class="comment">// I added a new function to find group ancillary files based on simple</span>
01017 <span class="comment">// filename patterns (leading or trailing digits). See find_group_anc_file.</span>
01018 <span class="comment">//</span>
01019 <span class="comment">// Revision 1.47.4.10  2001/10/30 06:55:45  rmorris</span>
01020 <span class="comment">// Win32 porting changes.  Brings core win32 port up-to-date.</span>
01021 <span class="comment">//</span>
01022 <span class="comment">// Revision 1.51  2001/10/14 01:28:38  jimg</span>
01023 <span class="comment">// Merged with release-3-2-8.</span>
01024 <span class="comment">//</span>
01025 <span class="comment">// Revision 1.47.4.9  2001/10/08 17:01:30  jimg</span>
01026 <span class="comment">// Got paranoid about sprintf; increased the size of the buffer used by</span>
01027 <span class="comment">// rfc822_date() to 256. It's still not that good; should use an output string</span>
01028 <span class="comment">// stream, et c.</span>
01029 <span class="comment">//</span>
01030 <span class="comment">// Revision 1.50  2001/09/28 17:50:07  jimg</span>
01031 <span class="comment">// Merged with 3.2.7.</span>
01032 <span class="comment">//</span>
01033 <span class="comment">// Revision 1.47.4.8  2001/09/25 20:25:20  jimg</span>
01034 <span class="comment">// Added include of debug.h</span>
01035 <span class="comment">//</span>
01036 <span class="comment">// Revision 1.49  2001/08/24 17:46:22  jimg</span>
01037 <span class="comment">// Resolved conflicts from the merge of release 3.2.6</span>
01038 <span class="comment">//</span>
01039 <span class="comment">// Revision 1.47.4.7  2001/08/18 00:06:00  jimg</span>
01040 <span class="comment">// Removed WIN32 compile guards from using statements.</span>
01041 <span class="comment">//</span>
01042 <span class="comment">// Revision 1.47.4.6  2001/07/28 01:10:42  jimg</span>
01043 <span class="comment">// Some of the numeric type classes did not have copy ctors or operator=.</span>
01044 <span class="comment">// I added those where they were needed.</span>
01045 <span class="comment">// In every place where delete (or delete []) was called, I set the pointer</span>
01046 <span class="comment">// just deleted to zero. Thus if for some reason delete is called again</span>
01047 <span class="comment">// before new memory is allocated there won't be a mysterious crash. This is</span>
01048 <span class="comment">// just good form when using delete.</span>
01049 <span class="comment">// I added calls to www2id and id2www where appropriate. The DAP now handles</span>
01050 <span class="comment">// making sure that names are escaped and unescaped as needed. Connect is</span>
01051 <span class="comment">// set to handle CEs that contain names as they are in the dataset (see the</span>
01052 <span class="comment">// comments/Log there). Servers should not handle escaping or unescaping</span>
01053 <span class="comment">// characters on their own.</span>
01054 <span class="comment">//</span>
01055 <span class="comment">// Revision 1.48  2001/06/15 23:49:03  jimg</span>
01056 <span class="comment">// Merged with release-3-2-4.</span>
01057 <span class="comment">//</span>
01058 <span class="comment">// Revision 1.47.4.5  2001/06/14 17:33:38  rich</span>
01059 <span class="comment">// Modified name_path() so it also removes the path of the uncompressed file from</span>
01060 <span class="comment">// the beginning of decompressed files.</span>
01061 <span class="comment">//</span>
01062 <span class="comment">// Revision 1.47.4.4  2001/05/03 21:49:03  jimg</span>
01063 <span class="comment">// Added Cache-Control: no-cache header to the output of set_mime_text when that</span>
01064 <span class="comment">// function is used to generate a response for an Error object. This will</span>
01065 <span class="comment">// prevent the caches from caching out server's errors.</span>
01066 <span class="comment">//</span>
01067 <span class="comment">// Revision 1.47.4.3  2001/05/03 20:25:45  jimg</span>
01068 <span class="comment">// Added the set_mime_not_modified() functions. These send 304 (not modified)</span>
01069 <span class="comment">// responses.</span>
01070 <span class="comment">//</span>
01071 <span class="comment">// Revision 1.47.4.2  2001/04/23 22:34:46  jimg</span>
01072 <span class="comment">// Added support for the Last-Modified MIME header in server responses.`</span>
01073 <span class="comment">//</span>
01074 <span class="comment">// Revision 1.47.4.1  2001/04/17 21:43:38  jimg</span>
01075 <span class="comment">// Added Last-Modified support to set_mime_text and set_mime_binary. Added tests</span>
01076 <span class="comment">// for set_mime_text to cgiUtilTest (I didn't both with tests for</span>
01077 <span class="comment">// set_mime_binary since it is so similar to the text routine).</span>
01078 <span class="comment">//</span>
01079 <span class="comment">// Revision 1.47  2000/09/22 02:17:22  jimg</span>
01080 <span class="comment">// Rearranged source files so that the CVS logs appear at the end rather than</span>
01081 <span class="comment">// the start. Also made the ifdef guard symbols use the same naming scheme and</span>
01082 <span class="comment">// wrapped headers included in other headers in those guard symbols (to cut</span>
01083 <span class="comment">// down on extraneous file processing - See Lakos).</span>
01084 <span class="comment">//</span>
01085 <span class="comment">// Revision 1.46  2000/09/21 16:22:09  jimg</span>
01086 <span class="comment">// Merged changes from Jose Garcia that add exceptions to the software.</span>
01087 <span class="comment">// Many methods that returned error codes now throw exectptions. There are</span>
01088 <span class="comment">// two classes which are thrown by the software, Error and InternalErr.</span>
01089 <span class="comment">// InternalErr is used to report errors within the library or errors using</span>
01090 <span class="comment">// the library. Error is used to reprot all other errors. Since InternalErr</span>
01091 <span class="comment">// is a subclass of Error, programs need only to catch Error.</span>
01092 <span class="comment">//</span>
01093 <span class="comment">// Revision 1.45  2000/08/14 23:54:11  jimg</span>
01094 <span class="comment">// Removed the usage() functions. These should be supplied by cgis that</span>
01095 <span class="comment">// need them. See DODSFilter.</span>
01096 <span class="comment">//</span>
01097 <span class="comment">// Revision 1.44  2000/08/07 21:08:43  rmorris</span>
01098 <span class="comment">// Removed default argument definition.  Under MS VC++ one can't define a</span>
01099 <span class="comment">// default argument in both a method declaration and its's definition -</span>
01100 <span class="comment">// plus that's redundant anyway.  Just setup default args in the declaration</span>
01101 <span class="comment">// (in the .h) only or VC++ will choke.</span>
01102 <span class="comment">//</span>
01103 <span class="comment">// Revision 1.43  2000/08/02 22:46:49  jimg</span>
01104 <span class="comment">// Merged 3.1.8</span>
01105 <span class="comment">//</span>
01106 <span class="comment">// Revision 1.36.6.4  2000/08/02 20:54:08  jimg</span>
01107 <span class="comment">// Changed the definitions of some of the set_mime_*() functions so that they</span>
01108 <span class="comment">// match the changes in declaration in cgi_util.h. These changes removed the</span>
01109 <span class="comment">// symbol DVR from the header so that config_dap.h is no longer needed by</span>
01110 <span class="comment">// cgi_util.h.</span>
01111 <span class="comment">//</span>
01112 <span class="comment">// Revision 1.42  2000/07/09 22:05:36  rmorris</span>
01113 <span class="comment">// Changes to increase portability, minimize ifdef's for win32 and account</span>
01114 <span class="comment">// for differences in the iostreams implementations.</span>
01115 <span class="comment">//</span>
01116 <span class="comment">// Revision 1.41  2000/06/07 18:06:59  jimg</span>
01117 <span class="comment">// Merged the pc port branch</span>
01118 <span class="comment">//</span>
01119 <span class="comment">// Revision 1.40.4.1  2000/06/02 18:36:38  rmorris</span>
01120 <span class="comment">// Mod's for port to Win32.</span>
01121 <span class="comment">//</span>
01122 <span class="comment">// Revision 1.40  2000/03/28 16:36:08  jimg</span>
01123 <span class="comment">// Removed code that sent bad dates in the response header. Also removed code</span>
01124 <span class="comment">// that sent a Cache-Control: no-cache header.</span>
01125 <span class="comment">//</span>
01126 <span class="comment">// Revision 1.38.2.1  2000/02/17 05:03:16  jimg</span>
01127 <span class="comment">// Added file and line number information to calls to InternalErr.</span>
01128 <span class="comment">// Resolved compile-time problems with read due to a change in its</span>
01129 <span class="comment">// parameter list given that errors are now reported using exceptions.</span>
01130 <span class="comment">//</span>
01131 <span class="comment">// Revision 1.39  2000/01/27 06:29:58  jimg</span>
01132 <span class="comment">// Resolved conflicts from merge with release-3-1-4</span>
01133 <span class="comment">//</span>
01134 <span class="comment">// Revision 1.36.6.3  2000/01/26 23:58:51  jimg</span>
01135 <span class="comment">// Fixed the return type of string::find.</span>
01136 <span class="comment">// Removed the old name_path() function.</span>
01137 <span class="comment">//</span>
01138 <span class="comment">// Revision 1.38  1999/12/01 21:33:01  jimg</span>
01139 <span class="comment">// Added rfc822_date(...).</span>
01140 <span class="comment">// Added Date headers to all the mime header output functions.</span>
01141 <span class="comment">// Added Cache-Control: no-cache to the binary header with deflate is true.</span>
01142 <span class="comment">// Removed old code.</span>
01143 <span class="comment">//</span>
01144 <span class="comment">// Revision 1.36.6.2  1999/10/19 16:46:33  jimg</span>
01145 <span class="comment">// Removed the usage() function.</span>
01146 <span class="comment">//</span>
01147 <span class="comment">// Revision 1.37  1999/09/03 22:07:45  jimg</span>
01148 <span class="comment">// Merged changes from release-3-1-1</span>
01149 <span class="comment">//</span>
01150 <span class="comment">// Revision 1.36.6.1  1999/08/28 06:43:04  jimg</span>
01151 <span class="comment">// Fixed the implementation/interface pragmas and misc comments</span>
01152 <span class="comment">//</span>
01153 <span class="comment">// Revision 1.36  1999/05/05 00:49:21  jimg</span>
01154 <span class="comment">// Added version number optional argument. This provides a way for code that</span>
01155 <span class="comment">// uses these functions to pass version information in so that it can be</span>
01156 <span class="comment">// included in the response doc's MIME header.</span>
01157 <span class="comment">//</span>
01158 <span class="comment">// Revision 1.35  1999/05/04 19:47:23  jimg</span>
01159 <span class="comment">// Fixed copyright statements. Removed more of the GNU classes.</span>
01160 <span class="comment">//</span>
01161 <span class="comment">// Revision 1.34  1999/04/29 02:29:34  jimg</span>
01162 <span class="comment">// Merge of no-gnu branch</span>
01163 <span class="comment">//</span>
01164 <span class="comment">// Revision 1.33  1999/03/17 23:05:46  jimg</span>
01165 <span class="comment">// Added to find_ancillary_file() so that pathname.ext will also be checked.</span>
01166 <span class="comment">// This ensures that ancillary DAS files such as 1998-6-avhrr.dat.das will be</span>
01167 <span class="comment">// used properly.</span>
01168 <span class="comment">//</span>
01169 <span class="comment">// Revision 1.32  1998/12/16 19:10:53  jimg</span>
01170 <span class="comment">// Added support for XDODS-Server MIME header. This fixes a problem where our</span>
01171 <span class="comment">// use of Server clashed with Java </span>
01172 <span class="comment">//</span>
01173 <span class="comment">// Revision 1.31.6.3  1999/03/17 23:43:05  jimg</span>
01174 <span class="comment">// Added pathanme.ext patch from the GNU String version.</span>
01175 <span class="comment">//</span>
01176 <span class="comment">// Revision 1.31.6.2  1999/02/05 09:32:35  jimg</span>
01177 <span class="comment">// Fixed __unused__ so that it not longer clashes with Red Hat 5.2 inlined</span>
01178 <span class="comment">// math code.</span>
01179 <span class="comment">//</span>
01180 <span class="comment">// Revision 1.31.6.1  1999/02/02 21:57:05  jimg</span>
01181 <span class="comment">// String to string version</span>
01182 <span class="comment">//</span>
01183 <span class="comment">// Revision 1.31  1998/03/19 23:30:08  jimg</span>
01184 <span class="comment">// Removed old code (that was surrounded by #if 0 ... #endif).</span>
01185 <span class="comment">//</span>
01186 <span class="comment">// Revision 1.30  1998/02/19 19:42:34  jimg</span>
01187 <span class="comment">// Added do_data_transfer() back in since the jgofs servers use it.</span>
01188 <span class="comment">//</span>
01189 <span class="comment">// Revision 1.29  1998/02/11 22:12:45  jimg</span>
01190 <span class="comment">// Changed x_gzip to deflate. See Connect.cc/.h</span>
01191 <span class="comment">// Removed old code.</span>
01192 <span class="comment">//</span>
01193 <span class="comment">// Revision 1.28  1997/12/16 01:38:22  jimg</span>
01194 <span class="comment">// Merged release 2.14d changes.</span>
01195 <span class="comment">//</span>
01196 <span class="comment">// Revision 1.27  1997/09/22 22:36:02  jimg</span>
01197 <span class="comment">// Added new function to read ancillary DAS and DDS files.</span>
01198 <span class="comment">//</span>
01199 <span class="comment">// Revision 1.26  1997/06/05 17:24:39  jimg</span>
01200 <span class="comment">// Added four function that help with writing the *_dods filter programs:</span>
01201 <span class="comment">// usage(), do_version(), do_data_transfer() and read_ancillary_dds().</span>
01202 <span class="comment">//</span>
01203 <span class="comment">// Revision 1.25  1997/03/27 18:13:27  jimg</span>
01204 <span class="comment">// Fixed a problem in set_mime_*() where Content-Encoding was sent with the</span>
01205 <span class="comment">// value x-plain. This caused Netscape on Windows to barf. I'm not sure that it</span>
01206 <span class="comment">// is a real error, but sending C-E only when its value is x-gzip or</span>
01207 <span class="comment">// x-compressed apparently causes the message to go away.</span>
01208 <span class="comment">//</span>
01209 <span class="comment">// Revision 1.24  1997/03/12 01:07:23  jimg</span>
01210 <span class="comment">// Removed code that set the HTTP protocol version header based on the value</span>
01211 <span class="comment">// of the SERVER_PROTOCOL environment variable. In servers that support</span>
01212 <span class="comment">// HTTP/1.1, the value of this env var was "HTTP/1.1" which broke our clients</span>
01213 <span class="comment">// since the servers (which are `nph') do *not* support HTTP/1.1.</span>
01214 <span class="comment">//</span>
01215 <span class="comment">// Revision 1.23  1997/03/05 08:28:15  jimg</span>
01216 <span class="comment">// Now correctly gets the server protocol (HTTP 0.9, 1.0 or 1.1) from the</span>
01217 <span class="comment">// environment variables and sets the return doc header accordingly.</span>
01218 <span class="comment">//</span>
01219 <span class="comment">// Revision 1.22  1996/12/18 18:48:53  jimg</span>
01220 <span class="comment">// Fixed spelling in ErrMsgT()'s message.</span>
01221 <span class="comment">//</span>
01222 <span class="comment">// Revision 1.21  1996/12/03 17:51:58  jimg</span>
01223 <span class="comment">// Fixed a bug in the char * array DESCRIPT where "dods_error" was catenated</span>
01224 <span class="comment">// with "web_error" (due to a missing comma).</span>
01225 <span class="comment">//</span>
01226 <span class="comment">// Revision 1.20  1996/11/25 03:42:37  jimg</span>
01227 <span class="comment">// Removed compress/decompress functions. Better versions are in util.cc</span>
01228 <span class="comment">// Changed from static global version of dods_root to function version.</span>
01229 <span class="comment">//</span>
01230 <span class="comment">// Revision 1.19  1996/11/20 01:00:17  jimg</span>
01231 <span class="comment">// Fixed lingering bug in compress_stdout where the user's path was not</span>
01232 <span class="comment">// searched correctly.</span>
01233 <span class="comment">//</span>
01234 <span class="comment">// Revision 1.18  1996/11/13 19:10:03  jimg</span>
01235 <span class="comment">// Added set_mime_error() function. Use this to send MIME headers indicating</span>
01236 <span class="comment">// that an error has occurred. NB: Don't use this when sending back an Error</span>
01237 <span class="comment">// object - this is for those cases where an error object won't do and you must</span>
01238 <span class="comment">// signal an error to the WWW/HTTP software on the client side.</span>
01239 <span class="comment">//</span>
01240 <span class="comment">// Revision 1.17  1996/10/18 16:33:14  jimg</span>
01241 <span class="comment">// Changed set_mime_binary() and set_mime_text() so that they produce a full</span>
01242 <span class="comment">// HTTP/MIME header.</span>
01243 <span class="comment">//</span>
01244 <span class="comment">// Revision 1.16  1996/08/13 18:42:01  jimg</span>
01245 <span class="comment">// Added not_used to definition of char rcsid[].</span>
01246 <span class="comment">//</span>
01247 <span class="comment">// Revision 1.15  1996/06/18 23:48:46  jimg</span>
01248 <span class="comment">// Modified so that the compress/decompress functions use the DODS_ROOT</span>
01249 <span class="comment">// enviroment-variable/define or the user's PATH to find gzip.</span>
01250 <span class="comment">//</span>
01251 <span class="comment">// Revision 1.14  1996/06/08 00:16:42  jimg</span>
01252 <span class="comment">// Fixed a bug in name_path().</span>
01253 <span class="comment">// Added compression functions which create filter processes which</span>
01254 <span class="comment">// automatically compress stdio file streams.</span>
01255 <span class="comment">// Added to set_mime_text() and set_mime_binary() support for compression.</span>
01256 <span class="comment">// These now correctly set the content-encoding field of the mime header.</span>
01257 <span class="comment">// Fixed ErrMsgT so that it says `DODS server' when the name of the server is</span>
01258 <span class="comment">// not known.</span>
01259 <span class="comment">//</span>
01260 <span class="comment">// Revision 1.13  1996/06/04 21:33:53  jimg</span>
01261 <span class="comment">// Multiple connections are now possible. It is now possible to open several</span>
01262 <span class="comment">// URLs at the same time and read from them in a round-robin fashion. To do</span>
01263 <span class="comment">// this I added data source and sink parameters to the serialize and</span>
01264 <span class="comment">// deserialize mfuncs. Connect was also modified so that it manages the data</span>
01265 <span class="comment">// source `object' (which is just an XDR pointer).</span>
01266 <span class="comment">//</span>
01267 <span class="comment">// Revision 1.12  1996/05/31 23:30:46  jimg</span>
01268 <span class="comment">// Updated copyright notice.</span>
01269 <span class="comment">//</span>
01270 <span class="comment">// Revision 1.11  1996/05/21 23:52:42  jimg</span>
01271 <span class="comment">// Changed include netio.h to cgi_util.h.</span>
01272 <span class="comment">//</span>
01273 <span class="comment">// Revision 1.10  1996/03/05 23:22:06  jimg</span>
01274 <span class="comment">// Addedconst to the char * function definitions.</span>
01275 <span class="comment">//</span>
01276 <span class="comment">// Revision 1.9  1995/07/09  21:20:42  jimg</span>
01277 <span class="comment">// Fixed date in copyright (it now reads `Copyright 1995 ...').</span>
01278 <span class="comment">//</span>
01279 <span class="comment">// Revision 1.8  1995/07/09  21:14:43  jimg</span>
01280 <span class="comment">// Added copyright.</span>
01281 <span class="comment">//</span>
01282 <span class="comment">// Revision 1.7  1995/06/27  17:38:43  jimg</span>
01283 <span class="comment">// Modified the cgi-util-test code so that it correctly uses name_path(); the</span>
01284 <span class="comment">// pointer returned by that function must be delteted.</span>
01285 <span class="comment">//</span>
01286 <span class="comment">// Revision 1.6  1995/05/30  18:28:59  jimg</span>
01287 <span class="comment">// Added const to ErrMsgT prototype.</span>
01288 <span class="comment">//</span>
01289 <span class="comment">// Revision 1.5  1995/05/22  20:36:10  jimg</span>
01290 <span class="comment">// Added #include "config_netio.h"</span>
01291 <span class="comment">// Removed old code.</span>
01292 <span class="comment">//</span>
01293 <span class="comment">// Revision 1.4  1995/03/16  16:29:24  reza</span>
01294 <span class="comment">// Fixed bugs in ErrMsgT and mime type.</span>
01295 <span class="comment">//</span>
01296 <span class="comment">// Revision 1.3  1995/02/22  21:03:59  reza</span>
01297 <span class="comment">// Added version number capability using CGI status_line.</span>
01298 <span class="comment">//</span>
01299 <span class="comment">// Revision 1.2  1995/02/22  19:53:32  jimg</span>
01300 <span class="comment">// Fixed usage of time functions in ErrMsgT; use ctime instead of localtime</span>
01301 <span class="comment">// and asctime.</span>
01302 <span class="comment">// Fixed TimStr bug in ErrMsgT.</span>
01303 <span class="comment">// Fixed dynamic memory bugs in name_path and fmakeword.</span>
01304 <span class="comment">// Replaced malloc calls with calls to new char[]; C++ code will expect to</span>
01305 <span class="comment">// be able to use delete.</span>
01306 <span class="comment">// Fixed memory overrun error in fmakeword.</span>
01307 <span class="comment">// Fixed potential bug in name_path (when called with null argument).</span>
01308 <span class="comment">// Added assetions.</span>
01309 <span class="comment">//</span>
01310 <span class="comment">// Revision 1.1  1995/01/10  16:23:01  jimg</span>
01311 <span class="comment">// Created new `common code' library for the net I/O stuff.</span>
01312 <span class="comment">//</span>
01313 <span class="comment">// Revision 1.1  1994/10/28  14:34:01  reza</span>
01314 <span class="comment">// First version</span>
01315 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 4 23:42:57 2004 for libdap++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
