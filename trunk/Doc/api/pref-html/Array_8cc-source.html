<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libdap++: Array.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Array.cc</h1><a href="Array_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2002,2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//</span>
00010 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00011 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00012 <span class="comment">// License as published by the Free Software Foundation; either</span>
00013 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00014 <span class="comment">// </span>
00015 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00016 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00017 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00018 <span class="comment">// Lesser General Public License for more details.</span>
00019 <span class="comment">// </span>
00020 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00021 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00022 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00023 <span class="comment">//</span>
00024 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00025  
00026 <span class="comment">// (c) COPYRIGHT URI/MIT 1994-1999</span>
00027 <span class="comment">// Please read the full copyright statement in the file COPYRIGHT_URI.</span>
00028 <span class="comment">//</span>
00029 <span class="comment">// Authors:</span>
00030 <span class="comment">//      jhrg,jimg       James Gallagher &lt;jgallagher@gso.uri.edu&gt;</span>
00031 
00032 <span class="comment">// Implementation for Array.</span>
00033 <span class="comment">//</span>
00034 <span class="comment">// jhrg 9/13/94</span>
00035 
00036 <span class="preprocessor">#ifdef __GNUG__</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#pragma implementation</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00041 
00042 <span class="preprocessor">#include "<a class="code" href="Array_8h.html">Array.h</a>"</span>
00043 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00044 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00045 <span class="preprocessor">#include "<a class="code" href="InternalErr_8h.html">InternalErr.h</a>"</span>
00046 <span class="preprocessor">#include "<a class="code" href="escaping_8h.html">escaping.h</a>"</span>
00047 <span class="preprocessor">#include "<a class="code" href="ArrayIterAdapter_8h.html">ArrayIterAdapter.h</a>"</span>
00048 
00049 <span class="preprocessor">#ifdef TRACE_NEW</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="trace__new_8h.html">trace_new.h</a>"</span>
00051 <span class="preprocessor">#endif</span>
00052 <span class="preprocessor"></span>
00053 <span class="keyword">using</span> std::cerr;
00054 <span class="keyword">using</span> std::endl;
00055 
00056 <span class="keywordtype">void</span>
<a name="l00057"></a><a class="code" href="classArray.html#Arrayb0">00057</a> <a class="code" href="classArray.html#Arrayb0">Array::_duplicate</a>(<span class="keyword">const</span> <a class="code" href="classArray.html">Array</a> &amp;a)
00058 {
00059     _shape = a.<a class="code" href="classArray.html#Arrayr0">_shape</a>;
00060 }
00061 
00062 <span class="comment">// The first method of calculating length works when only one dimension is</span>
00063 <span class="comment">// constrained and you want the others to appear in total. This is important</span>
00064 <span class="comment">// when selecting from grids since users may not select from all dimensions</span>
00065 <span class="comment">// in which case that means they want the whole thing. Array projection</span>
00066 <span class="comment">// should probably work this way too, but it doesn't. 9/21/2001 jhrg</span>
00067     
00075 <span class="keywordtype">void</span>
<a name="l00076"></a><a class="code" href="classArray.html#Arraya5">00076</a> <a class="code" href="classArray.html#Arraya5">Array::update_length</a>(<span class="keywordtype">int</span> size)
00077 {
00078     <span class="keywordtype">int</span> <a class="code" href="classVector.html#Vectora9">length</a> = 1;
00079     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw0">Dim_citer</a> i = _shape.begin(); i != _shape.end(); i++)
00080     {
00081     length *= (*i).c_size &gt; 0 ? (*i).c_size : 1;
00082     }
00083 
00084     <a class="code" href="classVector.html#Vectora10">set_length</a>(length);
00085 }
00086 
00087 <span class="comment">// Construct an instance of Array. The (BaseType *) is assumed to be</span>
00088 <span class="comment">// allocated using new - The dtor for Vector will delete this object.</span>
00089 
<a name="l00104"></a><a class="code" href="classArray.html#Arraya0">00104</a> <a class="code" href="classArray.html#Arraya0">Array::Array</a>(<span class="keyword">const</span> string &amp;n, <a class="code" href="classBaseType.html">BaseType</a> *v) : <a class="code" href="classVector.html">Vector</a>(n, v, <a class="code" href="BaseType_8h.html#a21a15">dods_array_c</a>)
00105 {
00106 }
00107 
<a name="l00109"></a><a class="code" href="classArray.html#Arraya1">00109</a> <a class="code" href="classArray.html#Arraya0">Array::Array</a>(<span class="keyword">const</span> <a class="code" href="classArray.html">Array</a> &amp;rhs) : <a class="code" href="classVector.html">Vector</a>(rhs)
00110 {
00111     <a class="code" href="classArray.html#Arrayb0">_duplicate</a>(rhs);
00112 }
00113 
<a name="l00115"></a><a class="code" href="classArray.html#Arraya2">00115</a> <a class="code" href="classArray.html#Arraya2">Array::~Array</a>()
00116 {
00117     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Entering ~Array ("</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl);
00118     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Exiting ~Array"</span> &lt;&lt; endl);
00119 }
00120 
00121 <a class="code" href="classBaseType.html">BaseType</a> *
<a name="l00122"></a><a class="code" href="classArray.html#Arraya4">00122</a> <a class="code" href="classArray.html#Arraya4">Array::ptr_duplicate</a>()
00123 {
00124     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classArray.html#Arraya0">Array</a>(*<span class="keyword">this</span>);
00125 }
00126 
00127 <a class="code" href="classArray.html">Array</a> &amp;
<a name="l00128"></a><a class="code" href="classArray.html#Arraya3">00128</a> <a class="code" href="classArray.html#Arraya3">Array::operator=</a>(<span class="keyword">const</span> <a class="code" href="classArray.html">Array</a> &amp;rhs)
00129 {
00130     <span class="keywordflow">if</span> (<span class="keyword">this</span> == &amp;rhs)
00131     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00132 
00133     dynamic_cast&lt;Vector &amp;&gt;(*this) = rhs;
00134 
00135     <a class="code" href="classArray.html#Arrayb0">_duplicate</a>(rhs);
00136 
00137     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00138 }
00139 
00151 <span class="keywordtype">void</span> 
<a name="l00152"></a><a class="code" href="classArray.html#Arraya6">00152</a> <a class="code" href="classArray.html#Arraya6">Array::append_dim</a>(<span class="keywordtype">int</span> size, string name)
00153 { 
00154     <a class="code" href="structArray_1_1dimension.html">dimension</a> d;
00155 
00156     <span class="comment">// This is invariant</span>
00157     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono0">size</a> = size;
00158     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono1">name</a> = <a class="code" href="escaping_8cc.html#a7">www2id</a>(name);
00159 
00160     <span class="comment">// this information changes with each constraint expression</span>
00161     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono2">start</a> = 0; 
00162     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono3">stop</a> = size -1;
00163     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono4">stride</a> = 1;
00164     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono5">c_size</a> = size;
00165     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono6">selected</a> = <span class="keyword">true</span>;      <span class="comment">// assume all dims selected.</span>
00166 
00167     _shape.push_back(d); 
00168 
00169     <a class="code" href="classArray.html#Arraya5">update_length</a>(size);
00170 }
00171 
00178 <span class="keywordtype">void</span>
<a name="l00179"></a><a class="code" href="classArray.html#Arraya9">00179</a> <a class="code" href="classArray.html#Arraya9">Array::reset_constraint</a>()
00180 {
00181     <a class="code" href="classVector.html#Vectora10">set_length</a>(-1);
00182 
00183     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = _shape.begin(); i != _shape.end(); i++)
00184     {
00185     (*i).start = 0;
00186     (*i).stop = (*i).size - 1;
00187     (*i).stride = 1;
00188     (*i).c_size = (*i).size;
00189 
00190     (*i).selected = <span class="keyword">true</span>;
00191 
00192     <a class="code" href="classArray.html#Arraya5">update_length</a>((*i).size);
00193     }
00194 }
00195 
00196 
00206 <span class="keywordtype">void</span>
<a name="l00207"></a><a class="code" href="classArray.html#Arraya10">00207</a> <a class="code" href="classArray.html#Arraya10">Array::clear_constraint</a>()
00208 {
00209     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = _shape.begin(); i != _shape.end(); i++)
00210     {
00211     (*i).start = 0;
00212     (*i).stop = 0;
00213     (*i).stride = 0;
00214     (*i).c_size = 0;
00215     (*i).selected = <span class="keyword">false</span>;
00216     }
00217 
00218     <a class="code" href="classVector.html#Vectora10">set_length</a>(-1);
00219 }
00220 
00221 <span class="comment">// the start and stop indices are inclusive.</span>
00222 
00223 <span class="comment">// Note: MS VC++ won't tolerate embedded newlines in strings, hence the \n</span>
00224 <span class="comment">// is explicit.  </span>
00225 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *array_sss = \
00226 <span class="stringliteral">"Invalid constraint parameters: At least one of the start, stride or stop \n\</span>
00227 <span class="stringliteral">specified do not match the array variable."</span>;
00228 
00252 <span class="keywordtype">void</span>
<a name="l00253"></a><a class="code" href="classArray.html#Arraya8">00253</a> <a class="code" href="classArray.html#Arraya7">Array::add_constraint</a>(Pix p, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> stride, <span class="keywordtype">int</span> stop)
00254 {
00255     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *iter = (<a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *)p.getIterator() ;
00256     <a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i = iter-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz48_1">getIterator</a>() ;
00257     <a class="code" href="classArray.html#Arraya7">add_constraint</a>( i, start, stride, stop ) ;
00258     <span class="keywordflow">return</span> ;
00259 }
00260 
00280 <span class="keywordtype">void</span>
<a name="l00281"></a><a class="code" href="classArray.html#Arraya7">00281</a> <a class="code" href="classArray.html#Arraya7">Array::add_constraint</a>(<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i, <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> stride, <span class="keywordtype">int</span> stop)
00282 {
00283     <a class="code" href="structArray_1_1dimension.html">dimension</a> &amp;d = *i ;
00284 
00285     <span class="comment">// Check for bad constraints.</span>
00286     <span class="comment">// Jose Garcia</span>
00287     <span class="comment">// Usually invalid data for a constraint is the user's mistake</span>
00288     <span class="comment">// because they build a wrong URL in the client side.</span>
00289     <span class="keywordflow">if</span> (start &gt;= d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono0">size</a> || stop &gt;= d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono0">size</a> || stride &gt; d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono0">size</a> || stride &lt;= 0)
00290     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a5">malformed_expr</a>, array_sss);
00291 
00292     <span class="keywordflow">if</span> (((stop - start) / stride + 1) &gt; d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono0">size</a>)
00293     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a5">malformed_expr</a>, array_sss);
00294 
00295     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono2">start</a> = start;
00296     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono3">stop</a> = stop;
00297     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono4">stride</a> = stride;
00298 
00299     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono5">c_size</a> = (stop - start) / stride + 1;
00300     
00301     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"add_constraint: c_size = "</span> &lt;&lt; d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono5">c_size</a> &lt;&lt; endl);
00302 
00303     d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono6">selected</a> = <span class="keyword">true</span>;
00304 
00305     <a class="code" href="classArray.html#Arraya5">update_length</a>(d.<a class="code" href="structArray_1_1dimension.html#Array_1_1dimensiono5">c_size</a>);
00306 }
00307 
00317 Pix 
<a name="l00318"></a><a class="code" href="classArray.html#Arraya11">00318</a> <a class="code" href="classArray.html#Arraya11">Array::first_dim</a>() 
00319 { 
00320     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *i = <span class="keyword">new</span> <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a>( _shape ) ;
00321     i-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz46_0">first</a>() ;
00322     <span class="keywordflow">return</span> i ;
00323 }
00324 
00326 <a class="code" href="classArray.html#Arrayw1">Array::Dim_iter</a>
<a name="l00327"></a><a class="code" href="classArray.html#Arraya13">00327</a> <a class="code" href="classArray.html#Arraya13">Array::dim_begin</a>()
00328 {
00329     <span class="keywordflow">return</span> _shape.begin() ;
00330 }
00331 
00333 <a class="code" href="classArray.html#Arrayw1">Array::Dim_iter</a>
<a name="l00334"></a><a class="code" href="classArray.html#Arraya14">00334</a> <a class="code" href="classArray.html#Arraya14">Array::dim_end</a>()
00335 {
00336     <span class="keywordflow">return</span> _shape.end() ;
00337 }
00338 
00351 <span class="keywordtype">void</span> 
<a name="l00352"></a><a class="code" href="classArray.html#Arraya12">00352</a> <a class="code" href="classArray.html#Arraya12">Array::next_dim</a>(Pix p) 
00353 { 
00354     p.next() ;
00355 }
00356 
00366 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00367"></a><a class="code" href="classArray.html#Arraya25">00367</a> <a class="code" href="classArray.html#Arraya25">Array::dimensions</a>(<span class="keywordtype">bool</span> constrained)
00368 {
00369     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dim = 0;
00370     <span class="keywordflow">for</span>(<a class="code" href="classArray.html#Arrayw0">Dim_citer</a> i = _shape.begin(); i != _shape.end(); i++) 
00371     {
00372     <span class="keywordflow">if</span> (constrained) {
00373         <span class="keywordflow">if</span> ((*i).selected)
00374         dim++;
00375     }
00376     <span class="keywordflow">else</span>
00377     {
00378         dim++;
00379     }
00380     }
00381 
00382     <span class="keywordflow">return</span> dim;
00383 }
00384 
00402 <span class="keywordtype">int</span> 
<a name="l00403"></a><a class="code" href="classArray.html#Arraya15">00403</a> <a class="code" href="classArray.html#Arraya15">Array::dimension_size</a>(Pix p, <span class="keywordtype">bool</span> constrained) 
00404 { 
00405     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *iter = (<a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *)p.getIterator() ;
00406     <a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = iter-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz48_1">getIterator</a>() ;
00407     <span class="keywordflow">return</span> <a class="code" href="classArray.html#Arraya15">dimension_size</a>( i, constrained ) ;
00408 }
00409 
00427 <span class="keywordtype">int</span> 
<a name="l00428"></a><a class="code" href="classArray.html#Arraya16">00428</a> <a class="code" href="classArray.html#Arraya15">Array::dimension_size</a>(<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i, <span class="keywordtype">bool</span> constrained) 
00429 { 
00430     <span class="keywordtype">int</span> size = 0;
00431 
00432     <span class="keywordflow">if</span> (!_shape.empty())
00433     <span class="keywordflow">if</span> (constrained) {
00434         <span class="keywordflow">if</span> ((*i).selected)
00435         size = (*i).c_size;
00436         <span class="keywordflow">else</span>
00437         size = 0;
00438     }
00439     <span class="keywordflow">else</span>
00440         size = (*i).size; 
00441 
00442     <span class="keywordflow">return</span> size;
00443 }
00444 
00466 <span class="keywordtype">int</span> 
<a name="l00467"></a><a class="code" href="classArray.html#Arraya17">00467</a> <a class="code" href="classArray.html#Arraya17">Array::dimension_start</a>(Pix p, <span class="keywordtype">bool</span> constrained) 
00468 { 
00469     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *iter = (<a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *)p.getIterator() ;
00470     <a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = iter-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz48_1">getIterator</a>() ;
00471     <span class="keywordflow">return</span> <a class="code" href="classArray.html#Arraya17">dimension_start</a>( i, constrained ) ;
00472 }
00473 
00492 <span class="keywordtype">int</span> 
<a name="l00493"></a><a class="code" href="classArray.html#Arraya18">00493</a> <a class="code" href="classArray.html#Arraya17">Array::dimension_start</a>(<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i, <span class="keywordtype">bool</span> constrained) 
00494 { 
00495     <span class="keywordtype">int</span> start = 0;
00496 
00497     <span class="keywordflow">if</span> (!_shape.empty())
00498     <span class="keywordflow">if</span> (constrained) {
00499         <span class="keywordflow">if</span> ((*i).selected)
00500         start = (*i).start;
00501         <span class="keywordflow">else</span>
00502         start= 0;
00503     }
00504     <span class="keywordflow">else</span>
00505         start = (*i).start; 
00506 
00507     <span class="keywordflow">return</span> start;
00508 }
00509 
00530 <span class="keywordtype">int</span> 
<a name="l00531"></a><a class="code" href="classArray.html#Arraya19">00531</a> <a class="code" href="classArray.html#Arraya19">Array::dimension_stop</a>(Pix p, <span class="keywordtype">bool</span> constrained) 
00532 { 
00533     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *iter = (<a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *)p.getIterator() ;
00534     <a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = iter-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz48_1">getIterator</a>() ;
00535     <span class="keywordflow">return</span> <a class="code" href="classArray.html#Arraya19">dimension_stop</a>( i, constrained ) ;
00536 }
00537 
00556 <span class="keywordtype">int</span> 
<a name="l00557"></a><a class="code" href="classArray.html#Arraya20">00557</a> <a class="code" href="classArray.html#Arraya19">Array::dimension_stop</a>(<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i, <span class="keywordtype">bool</span> constrained) 
00558 { 
00559     <span class="keywordtype">int</span> stop = 0;
00560 
00561     <span class="keywordflow">if</span> (!_shape.empty())
00562     <span class="keywordflow">if</span> (constrained) {
00563         <span class="keywordflow">if</span> ((*i).selected)
00564         stop = (*i).stop;
00565         <span class="keywordflow">else</span>
00566         stop= 0;
00567     }
00568     <span class="keywordflow">else</span>
00569         stop = (*i).stop; 
00570 
00571     <span class="keywordflow">return</span> stop;
00572 }
00573 
00595 <span class="keywordtype">int</span> 
<a name="l00596"></a><a class="code" href="classArray.html#Arraya21">00596</a> <a class="code" href="classArray.html#Arraya21">Array::dimension_stride</a>(Pix p, <span class="keywordtype">bool</span> constrained) 
00597 { 
00598     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *iter = (<a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *)p.getIterator() ;
00599     <a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = iter-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz48_1">getIterator</a>() ;
00600     <span class="keywordflow">return</span> <a class="code" href="classArray.html#Arraya21">dimension_stride</a>( i, constrained ) ;
00601 }
00602 
00622 <span class="keywordtype">int</span> 
<a name="l00623"></a><a class="code" href="classArray.html#Arraya22">00623</a> <a class="code" href="classArray.html#Arraya21">Array::dimension_stride</a>(<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i, <span class="keywordtype">bool</span> constrained) 
00624 { 
00625     <span class="keywordtype">int</span> stride = 0;
00626 
00627     <span class="keywordflow">if</span> (!_shape.empty())
00628     <span class="keywordflow">if</span> (constrained) {
00629         <span class="keywordflow">if</span> ((*i).selected)
00630         stride = (*i).stride;
00631         <span class="keywordflow">else</span>
00632         stride= 0;
00633     }
00634     <span class="keywordflow">else</span>
00635         stride = (*i).stride; 
00636 
00637     <span class="keywordflow">return</span> stride;
00638 }
00639 
00652 string
<a name="l00653"></a><a class="code" href="classArray.html#Arraya23">00653</a> <a class="code" href="classArray.html#Arraya23">Array::dimension_name</a>(Pix p) 
00654 { 
00655     <a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *iter = (<a class="code" href="classArrayIterAdapter.html">ArrayIterAdapter</a> *)p.getIterator() ;
00656     <a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = iter-&gt;<a class="code" href="classArrayIterAdapter.html#ArrayIterAdapterz48_1">getIterator</a>() ;
00657     <span class="keywordflow">return</span> <a class="code" href="classArray.html#Arraya23">dimension_name</a>( i ) ;
00658 }
00659 
00670 string
<a name="l00671"></a><a class="code" href="classArray.html#Arraya24">00671</a> <a class="code" href="classArray.html#Arraya23">Array::dimension_name</a>(<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> &amp;i) 
00672 { 
00673   <span class="comment">// Jose Garcia</span>
00674   <span class="comment">// Since this method is public, it is possible for a user</span>
00675   <span class="comment">// to call it before the Array object has been properly set</span>
00676   <span class="comment">// this will cause an exception which is the user's fault.</span>
00677   <span class="comment">// (User in this context is the developer of the surrogate library.)</span>
00678   <span class="keywordflow">if</span> (_shape.empty())
00679       <span class="keywordflow">throw</span>  <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__, 
00680              <span class="stringliteral">"*This* array has no dimensions."</span>);
00681   <span class="keywordflow">return</span> (*i).name; 
00682 }
00683 
00702 <span class="keywordtype">void</span>
<a name="l00703"></a><a class="code" href="classArray.html#Arraya26">00703</a> <a class="code" href="classArray.html#Arraya26">Array::print_decl</a>(ostream &amp;os, string space, <span class="keywordtype">bool</span> print_semi,
00704           <span class="keywordtype">bool</span> constraint_info, <span class="keywordtype">bool</span> constrained)
00705 {
00706     <span class="keywordflow">if</span> (constrained &amp;&amp; !<a class="code" href="classBaseType.html#Vectora38">send_p</a>())
00707     <span class="keywordflow">return</span>;
00708 
00709     <span class="comment">// print it, but w/o semicolon</span>
00710     <a class="code" href="classVector.html#Vectora17">var</a>()-&gt;<a class="code" href="classBaseType.html#Urla38">print_decl</a>(os, space, <span class="keyword">false</span>, constraint_info, constrained); 
00711 
00712     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw0">Dim_citer</a> i = _shape.begin(); i != _shape.end(); i++) {
00713     <span class="keywordflow">if</span> (constrained &amp;&amp; !((*i).selected))
00714         <span class="keywordflow">continue</span>;
00715     os &lt;&lt; <span class="stringliteral">"["</span>;
00716     <span class="keywordflow">if</span> ((*i).name != <span class="stringliteral">""</span>)
00717         os &lt;&lt; <a class="code" href="escaping_8cc.html#a5">id2www</a>((*i).name) &lt;&lt; <span class="stringliteral">" = "</span>;
00718     <span class="keywordflow">if</span> (constrained)
00719         os &lt;&lt; (*i).c_size &lt;&lt; <span class="stringliteral">"]"</span>;
00720     <span class="keywordflow">else</span>
00721         os &lt;&lt; (*i).size &lt;&lt; <span class="stringliteral">"]"</span>;
00722     }
00723 
00724     <span class="keywordflow">if</span> (print_semi)
00725     os &lt;&lt; <span class="stringliteral">";"</span> &lt;&lt; endl;
00726 }
00727 
00745 <span class="keywordtype">void</span>
<a name="l00746"></a><a class="code" href="classArray.html#Arraya27">00746</a> <a class="code" href="classArray.html#Arraya26">Array::print_decl</a>(FILE *out, string space, <span class="keywordtype">bool</span> print_semi,
00747           <span class="keywordtype">bool</span> constraint_info, <span class="keywordtype">bool</span> constrained)
00748 {
00749     <span class="keywordflow">if</span> (constrained &amp;&amp; !<a class="code" href="classBaseType.html#Vectora38">send_p</a>())
00750     <span class="keywordflow">return</span>;
00751 
00752     <span class="comment">// print it, but w/o semicolon</span>
00753     <a class="code" href="classVector.html#Vectora17">var</a>()-&gt;<a class="code" href="classBaseType.html#Urla38">print_decl</a>(out, space, <span class="keyword">false</span>, constraint_info, constrained); 
00754 
00755     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw0">Dim_citer</a> i = _shape.begin(); i != _shape.end(); i++)
00756     {
00757     <span class="keywordflow">if</span> (constrained &amp;&amp; !((*i).selected))
00758         <span class="keywordflow">continue</span>;
00759     fprintf( out, <span class="stringliteral">"["</span> ) ;
00760     <span class="keywordflow">if</span> ((*i).name != <span class="stringliteral">""</span>)
00761     {
00762         fprintf( out, <span class="stringliteral">"%s = "</span>, <a class="code" href="escaping_8cc.html#a5">id2www</a>((*i).name).c_str() ) ;
00763     }
00764     <span class="keywordflow">if</span> (constrained)
00765     {
00766         fprintf( out, <span class="stringliteral">"%d]"</span>, (*i).c_size ) ;
00767     }
00768     <span class="keywordflow">else</span>
00769     {
00770         fprintf( out, <span class="stringliteral">"%d]"</span>, (*i).size ) ;
00771     }
00772     }
00773 
00774     <span class="keywordflow">if</span>( print_semi )
00775     {
00776     fprintf( out, <span class="stringliteral">";\n"</span> ) ;
00777     }
00778 }
00779 
00789 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
00790 Array::print_array(ostream &amp;os, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dims, 
00791            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shape[])
00792 {
00793     <span class="keywordflow">if</span> (dims == 1) {
00794     os &lt;&lt; <span class="stringliteral">"{"</span>;
00795     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; shape[0]-1; ++i) {
00796         <a class="code" href="classVector.html#Vectora17">var</a>(index++)-&gt;<a class="code" href="classBaseType.html#Constructora39">print_val</a>(os, <span class="stringliteral">""</span>, <span class="keyword">false</span>);
00797         os &lt;&lt; <span class="stringliteral">", "</span>;
00798     }
00799     <a class="code" href="classVector.html#Vectora17">var</a>(index++)-&gt;<a class="code" href="classBaseType.html#Constructora39">print_val</a>(os, <span class="stringliteral">""</span>, <span class="keyword">false</span>);
00800     os &lt;&lt; <span class="stringliteral">"}"</span>;
00801 
00802     <span class="keywordflow">return</span> index;
00803     }
00804     <span class="keywordflow">else</span> {
00805     os &lt;&lt; <span class="stringliteral">"{"</span>;
00806     <span class="comment">// Fixed an off-by-one error in the following loop. Since the array</span>
00807     <span class="comment">// length is shape[dims-1]-1 *and* since we want one less dimension</span>
00808     <span class="comment">// than that, the correct limit on this loop is shape[dims-2]-1. From</span>
00809     <span class="comment">// Todd Karakasian.</span>
00810     <span class="comment">// The saga continues; the loop test should be `i &lt; shape[0]-1'. jhrg</span>
00811     <span class="comment">// 9/12/96.</span>
00812     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; shape[0]-1; ++i) {
00813         index = print_array(os, index, dims - 1, shape + 1);
00814         os &lt;&lt; <span class="stringliteral">","</span>;      <span class="comment">// Removed the extra `}'. Also from Todd</span>
00815     }
00816     index = print_array(os, index, dims - 1, shape + 1);
00817     os &lt;&lt; <span class="stringliteral">"}"</span>;
00818 
00819     <span class="keywordflow">return</span> index;
00820     }
00821 }
00822 
00833 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
00834 Array::print_array(FILE *out, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dims, 
00835            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shape[])
00836 {
00837     <span class="keywordflow">if</span> (dims == 1) {
00838     fprintf( out, <span class="stringliteral">"{"</span> ) ;
00839     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; shape[0]-1; ++i) {
00840         <a class="code" href="classVector.html#Vectora17">var</a>(index++)-&gt;<a class="code" href="classBaseType.html#Constructora39">print_val</a>(out, <span class="stringliteral">""</span>, <span class="keyword">false</span>);
00841         fprintf( out, <span class="stringliteral">", "</span> ) ;
00842     }
00843     <a class="code" href="classVector.html#Vectora17">var</a>(index++)-&gt;<a class="code" href="classBaseType.html#Constructora39">print_val</a>(out, <span class="stringliteral">""</span>, <span class="keyword">false</span>);
00844     fprintf( out, <span class="stringliteral">"}"</span> ) ;
00845 
00846     <span class="keywordflow">return</span> index;
00847     }
00848     <span class="keywordflow">else</span> {
00849     fprintf( out, <span class="stringliteral">"{"</span> ) ;
00850     <span class="comment">// Fixed an off-by-one error in the following loop. Since the array</span>
00851     <span class="comment">// length is shape[dims-1]-1 *and* since we want one less dimension</span>
00852     <span class="comment">// than that, the correct limit on this loop is shape[dims-2]-1. From</span>
00853     <span class="comment">// Todd Karakasian.</span>
00854     <span class="comment">// The saga continues; the loop test should be `i &lt; shape[0]-1'. jhrg</span>
00855     <span class="comment">// 9/12/96.</span>
00856     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; shape[0]-1; ++i) {
00857         index = print_array(out, index, dims - 1, shape + 1);
00858         fprintf( out, <span class="stringliteral">","</span> ) ;   <span class="comment">// Removed the extra `}'. Also from Todd</span>
00859     }
00860     index = print_array(out, index, dims - 1, shape + 1);
00861     fprintf( out, <span class="stringliteral">"}"</span> ) ;
00862 
00863     <span class="keywordflow">return</span> index;
00864     }
00865 }
00866 
00867 <span class="comment">// print the value given the current constraint.</span>
00868 
00869 <span class="keywordtype">void</span> 
<a name="l00870"></a><a class="code" href="classArray.html#Arraya28">00870</a> <a class="code" href="classArray.html#Arraya28">Array::print_val</a>(ostream &amp;os, string space, <span class="keywordtype">bool</span> print_decl_p)
00871 {
00872     <span class="comment">// print the declaration if print decl is true.</span>
00873     <span class="comment">// for each dimension,</span>
00874     <span class="comment">//   for each element, </span>
00875     <span class="comment">//     print the array given its shape, number of dimensions.</span>
00876     <span class="comment">// Add the `;'</span>
00877     
00878     <span class="keywordflow">if</span> (print_decl_p) {
00879     <a class="code" href="classArray.html#Arraya26">print_decl</a>(os, space, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
00880     os &lt;&lt; <span class="stringliteral">" = "</span>;
00881     }
00882 
00883     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dims = <a class="code" href="classArray.html#Arraya25">dimensions</a>(<span class="keyword">true</span>);
00884     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *shape = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[dims];
00885     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
00886     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = _shape.begin(); i != _shape.end(); i++)
00887     shape[index++] = <a class="code" href="classArray.html#Arraya15">dimension_size</a>(i, <span class="keyword">true</span>);
00888 
00889     print_array(os, 0, dims, shape);
00890     <span class="keyword">delete</span> [] shape;
00891     shape = 0;
00892 
00893     <span class="keywordflow">if</span> (print_decl_p) {
00894     os &lt;&lt; <span class="stringliteral">";"</span> &lt;&lt; endl;
00895     }
00896 }
00897 
00898 <span class="keywordtype">void</span> 
<a name="l00899"></a><a class="code" href="classArray.html#Arraya29">00899</a> <a class="code" href="classArray.html#Arraya28">Array::print_val</a>(FILE *out, string space, <span class="keywordtype">bool</span> print_decl_p)
00900 {
00901     <span class="comment">// print the declaration if print decl is true.</span>
00902     <span class="comment">// for each dimension,</span>
00903     <span class="comment">//   for each element, </span>
00904     <span class="comment">//     print the array given its shape, number of dimensions.</span>
00905     <span class="comment">// Add the `;'</span>
00906     
00907     <span class="keywordflow">if</span> (print_decl_p) {
00908     <a class="code" href="classArray.html#Arraya26">print_decl</a>(out, space, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
00909     fprintf( out, <span class="stringliteral">" = "</span> ) ;
00910     }
00911 
00912     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dims = <a class="code" href="classArray.html#Arraya25">dimensions</a>(<span class="keyword">true</span>);
00913     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *shape = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>[dims];
00914     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
00915     <span class="keywordflow">for</span> (<a class="code" href="classArray.html#Arrayw1">Dim_iter</a> i = _shape.begin(); i != _shape.end(); i++)
00916     shape[index++] = <a class="code" href="classArray.html#Arraya15">dimension_size</a>(i, <span class="keyword">true</span>);
00917 
00918     print_array(out, 0, dims, shape);
00919     <span class="keyword">delete</span> [] shape;
00920     shape = 0;
00921 
00922     <span class="keywordflow">if</span> (print_decl_p) {
00923     fprintf( out, <span class="stringliteral">";\n"</span> ) ;
00924     }
00925 }
00926 
00936 <span class="keywordtype">bool</span>
<a name="l00937"></a><a class="code" href="classArray.html#Arraya30">00937</a> <a class="code" href="classArray.html#Arraya30">Array::check_semantics</a>(string &amp;msg, <span class="keywordtype">bool</span>)
00938 {
00939     <span class="keywordtype">bool</span> sem = <a class="code" href="classBaseType.html#Urla40">BaseType::check_semantics</a>(msg) &amp;&amp; !_shape.empty();
00940 
00941     <span class="keywordflow">if</span> (!sem)
00942     msg = <span class="stringliteral">"An array variable must have dimensions"</span>;
00943 
00944     <span class="keywordflow">return</span> sem;
00945 }
00946 
00947 <span class="comment">// $Log: Array_8cc-source.html,v $
00947 <span class="comment">// Revision 1.4  2004/02/05 06:51:15  jimg
00947 <span class="comment">// Added/update.
00947 <span class="comment">//</span>
00948 <span class="comment">// Revision 1.59.2.2  2004/01/29 06:51:49  jimg</span>
00949 <span class="comment">// Fixed up the doxygen comments.</span>
00950 <span class="comment">//</span>
00951 <span class="comment">// Revision 1.59.2.1  2003/09/06 22:37:50  jimg</span>
00952 <span class="comment">// Updated the documentation.</span>
00953 <span class="comment">//</span>
00954 <span class="comment">// Revision 1.59  2003/04/22 19:40:27  jimg</span>
00955 <span class="comment">// Merged with 3.3.1.</span>
00956 <span class="comment">//</span>
00957 <span class="comment">// Revision 1.58  2003/02/21 00:14:24  jimg</span>
00958 <span class="comment">// Repaired copyright.</span>
00959 <span class="comment">//</span>
00960 <span class="comment">// Revision 1.57.2.1  2003/02/21 00:10:06  jimg</span>
00961 <span class="comment">// Repaired copyright.</span>
00962 <span class="comment">//</span>
00963 <span class="comment">// Revision 1.57  2003/01/23 00:22:23  jimg</span>
00964 <span class="comment">// Updated the copyright notice; this implementation of the DAP is</span>
00965 <span class="comment">// copyrighted by OPeNDAP, Inc.</span>
00966 <span class="comment">//</span>
00967 <span class="comment">// Revision 1.56  2003/01/15 19:24:39  pwest</span>
00968 <span class="comment">// Removing IteratorAdapterT and replacing with non-templated versions.</span>
00969 <span class="comment">//</span>
00970 <span class="comment">// Revision 1.55  2003/01/10 19:46:39  jimg</span>
00971 <span class="comment">// Merged with code tagged release-3-2-10 on the release-3-2 branch. In many</span>
00972 <span class="comment">// cases files were added on that branch (so they appear on the trunk for</span>
00973 <span class="comment">// the first time).</span>
00974 <span class="comment">//</span>
00975 <span class="comment">// Revision 1.48.4.13  2002/12/31 16:43:20  rmorris</span>
00976 <span class="comment">// Patches to handle some of the fancier template code under VC++ 6.0.</span>
00977 <span class="comment">//</span>
00978 <span class="comment">// Revision 1.48.4.12  2002/12/17 22:35:02  pwest</span>
00979 <span class="comment">// Added and updated methods using stdio. Deprecated methods using iostream.</span>
00980 <span class="comment">//</span>
00981 <span class="comment">// Revision 1.48.4.11  2002/12/01 14:37:52  rmorris</span>
00982 <span class="comment">// Smalling changes for the win32 porting and maintenance work.</span>
00983 <span class="comment">//</span>
00984 <span class="comment">// Revision 1.48.4.10  2002/10/28 21:17:43  pwest</span>
00985 <span class="comment">// Converted all return values and method parameters to use non-const iterator.</span>
00986 <span class="comment">// Added operator== and operator!= methods to IteratorAdapter to handle Pix</span>
00987 <span class="comment">// problems.</span>
00988 <span class="comment">//</span>
00989 <span class="comment">// Revision 1.48.4.9  2002/09/22 14:24:58  rmorris</span>
00990 <span class="comment">// Changed the 1st arg in add_constraint(Dim_iter &amp;i,...).  The l-value</span>
00991 <span class="comment">// designation isn't used within and VC++ won't swallow passing a non-lvalue</span>
00992 <span class="comment">// in - so "&amp;" was removed and all is well.</span>
00993 <span class="comment">//</span>
00994 <span class="comment">// Revision 1.48.4.8  2002/09/12 22:49:57  pwest</span>
00995 <span class="comment">// Corrected signature changes made with Pix to IteratorAdapter changes. Rather</span>
00996 <span class="comment">// than taking a reference to a Pix, taking a Pix value.</span>
00997 <span class="comment">//</span>
00998 <span class="comment">// Revision 1.48.4.7  2002/09/05 22:52:54  pwest</span>
00999 <span class="comment">// Replaced the GNU data structures SLList and DLList with the STL container</span>
01000 <span class="comment">// class vector&lt;&gt;. To maintain use of Pix, changed the Pix.h header file to</span>
01001 <span class="comment">// redefine Pix to be an IteratorAdapter. Usage remains the same and all code</span>
01002 <span class="comment">// outside of the DAP should compile and link with no problems. Added methods</span>
01003 <span class="comment">// to the different classes where Pix is used to include methods to use STL</span>
01004 <span class="comment">// iterators. Replaced the use of Pix within the DAP to use iterators instead.</span>
01005 <span class="comment">// Updated comments for documentation, updated the test suites, and added some</span>
01006 <span class="comment">// unit tests. Updated the Makefile to remove GNU/SLList and GNU/DLList.</span>
01007 <span class="comment">//</span>
01008 <span class="comment">// Revision 1.48.4.6  2002/08/08 06:54:56  jimg</span>
01009 <span class="comment">// Changes for thread-safety. In many cases I found ugly places at the</span>
01010 <span class="comment">// tops of files while looking for globals, et c., and I fixed them up</span>
01011 <span class="comment">// (hopefully making them easier to read, ...). Only the files RCReader.cc</span>
01012 <span class="comment">// and usage.cc actually use pthreads synchronization functions. In other</span>
01013 <span class="comment">// cases I removed static objects where they were used for supposed</span>
01014 <span class="comment">// improvements in efficiency which had never actually been verified (and</span>
01015 <span class="comment">// which looked dubious).</span>
01016 <span class="comment">//</span>
01017 <span class="comment">// Revision 1.54  2002/06/18 15:36:24  tom</span>
01018 <span class="comment">// Moved comments and edited to accommodate doxygen documentation-generator.</span>
01019 <span class="comment">//</span>
01020 <span class="comment">// Revision 1.53  2002/06/03 22:21:15  jimg</span>
01021 <span class="comment">// Merged with release-3-2-9</span>
01022 <span class="comment">//</span>
01023 <span class="comment">// Revision 1.52  2002/05/23 15:22:39  tom</span>
01024 <span class="comment">// modified for doxygen</span>
01025 <span class="comment">//</span>
01026 <span class="comment">// Revision 1.48.4.5  2002/05/22 16:57:51  jimg</span>
01027 <span class="comment">// I modified the `data type classes' so that they do not need to be</span>
01028 <span class="comment">// subclassed for clients. It might be the case that, for a complex client,</span>
01029 <span class="comment">// subclassing is still the best way to go, but you're not required to do</span>
01030 <span class="comment">// it anymore.</span>
01031 <span class="comment">//</span>
01032 <span class="comment">// Revision 1.48.4.4  2001/10/30 06:51:32  rmorris</span>
01033 <span class="comment">// Omit use of unescaped newline in string constant.  MS VC++ won't tolerate.</span>
01034 <span class="comment">//</span>
01035 <span class="comment">// Revision 1.51  2001/09/28 17:50:07  jimg</span>
01036 <span class="comment">// Merged with 3.2.7.</span>
01037 <span class="comment">//</span>
01038 <span class="comment">// Revision 1.48.4.3  2001/09/25 20:39:15  jimg</span>
01039 <span class="comment">// Changed update_length() so that it's no longer necessary to call</span>
01040 <span class="comment">// clear_constraint before setting dimension constraints.</span>
01041 <span class="comment">//</span>
01042 <span class="comment">// Revision 1.50  2001/08/24 17:46:22  jimg</span>
01043 <span class="comment">// Resolved conflicts from the merge of release 3.2.6</span>
01044 <span class="comment">//</span>
01045 <span class="comment">// Revision 1.48.4.2  2001/07/28 01:10:41  jimg</span>
01046 <span class="comment">// Some of the numeric type classes did not have copy ctors or operator=.</span>
01047 <span class="comment">// I added those where they were needed.</span>
01048 <span class="comment">// In every place where delete (or delete []) was called, I set the pointer</span>
01049 <span class="comment">// just deleted to zero. Thus if for some reason delete is called again</span>
01050 <span class="comment">// before new memory is allocated there won't be a mysterious crash. This is</span>
01051 <span class="comment">// just good form when using delete.</span>
01052 <span class="comment">// I added calls to www2id and id2www where appropriate. The DAP now handles</span>
01053 <span class="comment">// making sure that names are escaped and unescaped as needed. Connect is</span>
01054 <span class="comment">// set to handle CEs that contain names as they are in the dataset (see the</span>
01055 <span class="comment">// comments/Log there). Servers should not handle escaping or unescaping</span>
01056 <span class="comment">// characters on their own.</span>
01057 <span class="comment">//</span>
01058 <span class="comment">// Revision 1.49  2001/06/15 23:49:01  jimg</span>
01059 <span class="comment">// Merged with release-3-2-4.</span>
01060 <span class="comment">//</span>
01061 <span class="comment">// Revision 1.48.4.1  2001/06/05 06:49:19  jimg</span>
01062 <span class="comment">// Added the Constructor class which is to Structures, Sequences and Grids</span>
01063 <span class="comment">// what Vector is to Arrays and Lists. This should be used in future</span>
01064 <span class="comment">// refactorings (I thought it was going to be used for the back pointers).</span>
01065 <span class="comment">// Introduced back pointers so children can refer to their parents in</span>
01066 <span class="comment">// hierarchies of variables.</span>
01067 <span class="comment">// Added to Sequence methods to tell if a child sequence is done</span>
01068 <span class="comment">// deserializing its data.</span>
01069 <span class="comment">// Fixed the operator=() and copy ctors; removed redundency from</span>
01070 <span class="comment">// _duplicate().</span>
01071 <span class="comment">// Changed the way serialize and deserialize work for sequences. Now SOI and</span>
01072 <span class="comment">// EOS markers are written for every `level' of a nested Sequence. This</span>
01073 <span class="comment">// should fixed nested Sequences. There is still considerable work to do</span>
01074 <span class="comment">// for these to work in all cases.</span>
01075 <span class="comment">//</span>
01076 <span class="comment">// Revision 1.48  2000/09/22 02:17:18  jimg</span>
01077 <span class="comment">// Rearranged source files so that the CVS logs appear at the end rather than</span>
01078 <span class="comment">// the start. Also made the ifdef guard symbols use the same naming scheme and</span>
01079 <span class="comment">// wrapped headers included in other headers in those guard symbols (to cut</span>
01080 <span class="comment">// down on extraneous file processing - See Lakos).</span>
01081 <span class="comment">//</span>
01082 <span class="comment">// Revision 1.47  2000/09/21 16:22:06  jimg</span>
01083 <span class="comment">// Merged changes from Jose Garcia that add exceptions to the software.</span>
01084 <span class="comment">// Many methods that returned error codes now throw exectptions. There are</span>
01085 <span class="comment">// two classes which are thrown by the software, Error and InternalErr.</span>
01086 <span class="comment">// InternalErr is used to report errors within the library or errors using</span>
01087 <span class="comment">// the library. Error is used to reprot all other errors. Since InternalErr</span>
01088 <span class="comment">// is a subclass of Error, programs need only to catch Error.</span>
01089 <span class="comment">//</span>
01090 <span class="comment">// Revision 1.46  2000/07/09 22:05:35  rmorris</span>
01091 <span class="comment">// Changes to increase portability, minimize ifdef's for win32 and account</span>
01092 <span class="comment">// for differences in the iostreams implementations.</span>
01093 <span class="comment">//</span>
01094 <span class="comment">// Revision 1.45  2000/06/16 18:14:59  jimg</span>
01095 <span class="comment">// Merged with 3.1.7</span>
01096 <span class="comment">//</span>
01097 <span class="comment">// Revision 1.43.6.1  2000/06/14 16:59:00  jimg</span>
01098 <span class="comment">// Added instrumentation for the dtor.</span>
01099 <span class="comment">//</span>
01100 <span class="comment">// Revision 1.44  2000/06/07 18:06:57  jimg</span>
01101 <span class="comment">// Merged the pc port branch</span>
01102 <span class="comment">//</span>
01103 <span class="comment">// Revision 1.43.20.1  2000/06/02 18:11:19  rmorris</span>
01104 <span class="comment">// Mod's for Port to Win32.</span>
01105 <span class="comment">//</span>
01106 <span class="comment">// Revision 1.43.14.2  2000/02/17 05:03:12  jimg</span>
01107 <span class="comment">// Added file and line number information to calls to InternalErr.</span>
01108 <span class="comment">// Resolved compile-time problems with read due to a change in its</span>
01109 <span class="comment">// parameter list given that errors are now reported using exceptions.</span>
01110 <span class="comment">//</span>
01111 <span class="comment">// Revision 1.43.14.1  2000/01/28 22:14:03  jgarcia</span>
01112 <span class="comment">// Added exception handling and modify add_var to get a copy of the object</span>
01113 <span class="comment">//</span>
01114 <span class="comment">// Revision 1.43  1999/04/29 02:29:26  jimg</span>
01115 <span class="comment">// Merge of no-gnu branch</span>
01116 <span class="comment">//</span>
01117 <span class="comment">// Revision 1.42  1998/12/15 20:50:23  jimg</span>
01118 <span class="comment">// Added fix for strides &lt;= 0 (which results in division by zero).</span>
01119 <span class="comment">//</span>
01120 <span class="comment">// Revision 1.41.4.1  1999/02/02 21:56:54  jimg</span>
01121 <span class="comment">// String to string version</span>
01122 <span class="comment">//</span>
01123 <span class="comment">// Revision 1.41  1997/12/15 18:10:19  jimg</span>
01124 <span class="comment">// Changed check_semantics() so that it returns an error message instead of</span>
01125 <span class="comment">// printing one (thus it now works like all the other implementations of</span>
01126 <span class="comment">// check_semantics().</span>
01127 <span class="comment">//</span>
01128 <span class="comment">// Revision 1.40  1997/03/08 19:01:52  jimg</span>
01129 <span class="comment">// Changed default param to check_semantics() from  to String()</span>
01130 <span class="comment">// and removed the default from the argument list in the mfunc definition</span>
01131 <span class="comment">//</span>
01132 <span class="comment">// Revision 1.39  1997/02/28 01:28:01  jimg</span>
01133 <span class="comment">// Changed check_semantics() so that it now returns error messages in a String</span>
01134 <span class="comment">// object (passed by reference).</span>
01135 <span class="comment">//</span>
01136 <span class="comment">// Revision 1.38  1996/09/12 21:02:35  jimg</span>
01137 <span class="comment">// Fixed a nasty bug in print_array (private member function) where recursive</span>
01138 <span class="comment">// calls were made in the wrong order causing 3+ dimension arrays to print many</span>
01139 <span class="comment">// more values than actually exist in the array.</span>
01140 <span class="comment">//</span>
01141 <span class="comment">// Revision 1.37  1996/08/26 21:12:48  jimg</span>
01142 <span class="comment">// Changes for version 2.07</span>
01143 <span class="comment">//</span>
01144 <span class="comment">// Revision 1.36  1996/08/13 16:46:14  jimg</span>
01145 <span class="comment">// Added bounds checking to the add_constraint member function.</span>
01146 <span class="comment">// add_constraint() now returns false when a bogus constraint is used.</span>
01147 <span class="comment">//</span>
01148 <span class="comment">// Revision 1.35  1996/06/11 17:21:31  jimg</span>
01149 <span class="comment">// Fixed a bug in clear_constraint(); the dimension variables in the list</span>
01150 <span class="comment">// _SHAPE were not correctly `cleared', now they are.</span>
01151 <span class="comment">//</span>
01152 <span class="comment">// Revision 1.34  1996/05/31 23:29:17  jimg</span>
01153 <span class="comment">// Updated copyright notice.</span>
01154 <span class="comment">//</span>
01155 <span class="comment">// Revision 1.33  1996/05/29 22:08:32  jimg</span>
01156 <span class="comment">// Made changes necessary to support CEs that return the value of a function</span>
01157 <span class="comment">// instead of the value of a variable. This was done so that it would be</span>
01158 <span class="comment">// possible to translate Sequences into Arrays without first reading the</span>
01159 <span class="comment">// entire sequence over the network.</span>
01160 <span class="comment">//</span>
01161 <span class="comment">// Revision 1.32  1996/05/14 06:41:17  jimg</span>
01162 <span class="comment">// Update for</span>
01163 <span class="comment">//</span>
01164 <span class="comment">// Revision 1.32  1996/05/10 21:18:16  jimg</span>
01165 <span class="comment">// Fixed off-by-one error in add_constraint().</span>
01166 <span class="comment">//</span>
01167 <span class="comment">// Revision 1.31  1996/05/06 21:15:58  jimg</span>
01168 <span class="comment">// Added the member functions dimension_start, _stop and _stride to this class.</span>
01169 <span class="comment">// Changed the first argument of add_constraint from Pix &amp;p to Pix p (the</span>
01170 <span class="comment">// member function does not change its argument).</span>
01171 <span class="comment">//</span>
01172 <span class="comment">// Revision 1.30  1996/04/05 00:21:17  jimg</span>
01173 <span class="comment">// Compiled with g++ -Wall and fixed various warnings.</span>
01174 <span class="comment">//</span>
01175 <span class="comment">// Revision 1.29  1996/03/05 18:48:24  jimg</span>
01176 <span class="comment">// Fixed bugs in the print_array software.</span>
01177 <span class="comment">// Fixed the ctor and related CE member functions (so that projections work).</span>
01178 <span class="comment">//</span>
01179 <span class="comment">// Revision 1.28  1996/02/01 22:22:42  jimg</span>
01180 <span class="comment">// Merged changes between DODS-1.1 and DODS 2.x.</span>
01181 <span class="comment">//</span>
01182 <span class="comment">// Revision 1.27  1995/12/09  01:06:29  jimg</span>
01183 <span class="comment">// Added changes so that relational operators will work properly for all the</span>
01184 <span class="comment">// datatypes (including Sequences). The relational ops are evaluated in</span>
01185 <span class="comment">// DDS::eval_constraint() after being parsed by DDS::parse_constraint().</span>
01186 <span class="comment">//</span>
01187 <span class="comment">// Revision 1.26  1995/12/06  21:40:58  jimg</span>
01188 <span class="comment">// Added reset_constraint(), clear_constraint() and add_constraint() to manage</span>
01189 <span class="comment">// the new constraint-related members (in struct dimension).</span>
01190 <span class="comment">// Fixed variour member functions to return information about sizes,</span>
01191 <span class="comment">// ... correctly both before and after constraints are set.</span>
01192 <span class="comment">//</span>
01193 <span class="comment">// Revision 1.25  1995/11/22  22:31:02  jimg</span>
01194 <span class="comment">// Modified so that the Vector class is now the parent class.</span>
01195 <span class="comment">//</span>
01196 <span class="comment">// Revision 1.24  1995/10/23  23:20:44  jimg</span>
01197 <span class="comment">// Added _send_p and _read_p fields (and their accessors) along with the</span>
01198 <span class="comment">// virtual mfuncs set_send_p() and set_read_p().</span>
01199 <span class="comment">//</span>
01200 <span class="comment">// Revision 1.23  1995/08/26  00:31:21  jimg</span>
01201 <span class="comment">// Removed code enclosed in #ifdef NEVER #endif.</span>
01202 <span class="comment">//</span>
01203 <span class="comment">// Revision 1.22  1995/08/22  23:45:33  jimg</span>
01204 <span class="comment">// Removed DBMALLOC code.</span>
01205 <span class="comment">// Added set_vec/vec mfuncs so that non-Array software can access the</span>
01206 <span class="comment">// BaseType * vector.</span>
01207 <span class="comment">// Changed names read_val and store_val to buf2val and val2buf. The old names</span>
01208 <span class="comment">// remain.</span>
01209 <span class="comment">// removed the card member function: used the new _type enum with a switch in</span>
01210 <span class="comment">// its place.</span>
01211 <span class="comment">//</span>
01212 <span class="comment">// Revision 1.21.2.4  1995/09/27 21:49:03  jimg</span>
01213 <span class="comment">// Fixed casts.</span>
01214 <span class="comment">//</span>
01215 <span class="comment">// Revision 1.21.2.3  1995/09/27  19:06:56  jimg</span>
01216 <span class="comment">// Add casts to `cast away' const and unsigned in places where we call various</span>
01217 <span class="comment">// xdr functions (which don't know about, or use, const or unsigned.</span>
01218 <span class="comment">//</span>
01219 <span class="comment">// Revision 1.21.2.2  1995/09/14  20:59:50  jimg</span>
01220 <span class="comment">// Fixed declaration of, and calls to, _duplicate() by changing the formal</span>
01221 <span class="comment">// param from a pointer to a reference.</span>
01222 <span class="comment">//</span>
01223 <span class="comment">// Revision 1.21.2.1  1995/07/11  18:17:09  jimg</span>
01224 <span class="comment">// Added cast of xdr_array (used in BaseType's constructor) to xdrproc_t.</span>
01225 <span class="comment">//</span>
01226 <span class="comment">// Revision 1.21  1995/07/09  21:28:48  jimg</span>
01227 <span class="comment">// Added copyright notice.</span>
01228 <span class="comment">//</span>
01229 <span class="comment">// Revision 1.20  1995/05/10  15:33:52  jimg</span>
01230 <span class="comment">// Failed to change `config.h' to `config_dap.h' in these files.</span>
01231 <span class="comment">//</span>
01232 <span class="comment">// Revision 1.19  1995/05/10  13:45:01  jimg</span>
01233 <span class="comment">// Changed the name of the configuration header file from `config.h' to</span>
01234 <span class="comment">// `config_dap.h' so that other libraries could have header files which were</span>
01235 <span class="comment">// installed in the DODS include directory without overwriting this one. Each</span>
01236 <span class="comment">// config header should follow the convention config_&lt;name&gt;.h.</span>
01237 <span class="comment">//</span>
01238 <span class="comment">// Revision 1.18  1995/04/28  19:53:46  reza</span>
01239 <span class="comment">// First try at adding constraints capability.</span>
01240 <span class="comment">// Enforce a new size calculated from constraint expression.</span>
01241 <span class="comment">//</span>
01242 <span class="comment">// Revision 1.17  1995/03/16  17:22:58  jimg</span>
01243 <span class="comment">// Added include of config_dap.h before all other includes.</span>
01244 <span class="comment">// Fixed deletes of buffers in read_val().</span>
01245 <span class="comment">// Added initialization of _buf in ctor.</span>
01246 <span class="comment">//</span>
01247 <span class="comment">// Revision 1.16  1995/03/04  14:34:40  jimg</span>
01248 <span class="comment">// Major modifications to the transmission and representation of values:</span>
01249 <span class="comment">// Added card() virtual function which is true for classes that</span>
01250 <span class="comment">// contain cardinal types (byte, int float, string).</span>
01251 <span class="comment">// Changed the representation of Str from the C rep to a C++</span>
01252 <span class="comment">// class represenation.</span>
01253 <span class="comment">// Chnaged read_val and store_val so that they take and return</span>
01254 <span class="comment">// types that are stored by the object (e.g., inthe case of Str</span>
01255 <span class="comment">// an URL, read_val returns a C++ String object).</span>
01256 <span class="comment">// Modified Array representations so that arrays of card()</span>
01257 <span class="comment">// objects are just that - no more storing strings, ... as</span>
01258 <span class="comment">// C would store them.</span>
01259 <span class="comment">// Arrays of non cardinal types are arrays of the DODS objects (e.g.,</span>
01260 <span class="comment">// an array of a structure is represented as an array of Structure</span>
01261 <span class="comment">// objects).</span>
01262 <span class="comment">//</span>
01263 <span class="comment">// Revision 1.15  1995/02/10  02:22:54  jimg</span>
01264 <span class="comment">// Added DBMALLOC includes and switch to code which uses malloc/free.</span>
01265 <span class="comment">// Private and protected symbols now start with `_'.</span>
01266 <span class="comment">// Added new accessors for name and type fields of BaseType; the old ones</span>
01267 <span class="comment">// will be removed in a future release.</span>
01268 <span class="comment">// Added the store_val() mfunc. It stores the given value in the object's</span>
01269 <span class="comment">// internal buffer.</span>
01270 <span class="comment">// Made both List and Str handle their values via pointers to memory.</span>
01271 <span class="comment">// Fixed read_val().</span>
01272 <span class="comment">// Made serialize/deserialize handle all malloc/free calls (even in those</span>
01273 <span class="comment">// cases where xdr initiates the allocation).</span>
01274 <span class="comment">// Fixed print_val().</span>
01275 <span class="comment">//</span>
01276 <span class="comment">// Revision 1.14  1995/01/19  20:05:21  jimg</span>
01277 <span class="comment">// ptr_duplicate() mfunc is now abstract virtual.</span>
01278 <span class="comment">// Array, ... Grid duplicate mfuncs were modified to take pointers, not</span>
01279 <span class="comment">// referenves.</span>
01280 <span class="comment">//</span>
01281 <span class="comment">// Revision 1.13  1995/01/11  15:54:39  jimg</span>
01282 <span class="comment">// Added modifications necessary for BaseType's static XDR pointers. This</span>
01283 <span class="comment">// was mostly a name change from xdrin/out to _xdrin/out.</span>
01284 <span class="comment">// Removed the two FILE pointers from ctors, since those are now set with</span>
01285 <span class="comment">// functions which are friends of BaseType.</span>
01286 <span class="comment">//</span>
01287 <span class="comment">// Revision 1.12  1994/12/19  20:52:45  jimg</span>
01288 <span class="comment">// Minor modifications to the print_val mfunc.</span>
01289 <span class="comment">//</span>
01290 <span class="comment">// Revision 1.11  1994/12/16  20:13:31  dan</span>
01291 <span class="comment">// Fixed serialize() and deserialize() for arrays of strings.</span>
01292 <span class="comment">//</span>
01293 <span class="comment">// Revision 1.10  1994/12/14  20:35:36  dan</span>
01294 <span class="comment">// Added dimensions() member function to return number of dimensions</span>
01295 <span class="comment">// contained in the array.</span>
01296 <span class="comment">// Removed alloc_buf() and free_buf() member functions and placed them</span>
01297 <span class="comment">// in util.cc.</span>
01298 <span class="comment">//</span>
01299 <span class="comment">// Revision 1.9  1994/12/14  17:50:34  dan</span>
01300 <span class="comment">// Modified serialize() and deserialize() member functions to special</span>
01301 <span class="comment">// case BaseTypes 'Str' and 'Url'.  These special cases do not call</span>
01302 <span class="comment">// xdr_array, but iterate through the arrays using calls to XDR_STR.</span>
01303 <span class="comment">// Modified print_val() member function to handle arrays of different</span>
01304 <span class="comment">// BaseTypes.</span>
01305 <span class="comment">// Modified append_dim() member function for initializing its dimension</span>
01306 <span class="comment">// components.</span>
01307 <span class="comment">// Removed dim() member function.</span>
01308 <span class="comment">//</span>
01309 <span class="comment">// Revision 1.7  1994/12/09  21:36:33  jimg</span>
01310 <span class="comment">// Added support for named array dimensions.</span>
01311 <span class="comment">//</span>
01312 <span class="comment">// Revision 1.6  1994/12/08  15:51:41  dan</span>
01313 <span class="comment">// Modified size() member to return cumulative size of all dimensions</span>
01314 <span class="comment">// given the variable basetype.</span>
01315 <span class="comment">// Modified serialize() and deserialize() member functions for data</span>
01316 <span class="comment">// transmission using XDR.</span>
01317 <span class="comment">//</span>
01318 <span class="comment">// Revision 1.5  1994/11/22  20:47:45  dan</span>
01319 <span class="comment">// Modified size() to return total number of elements.</span>
01320 <span class="comment">// Fixed errors in deserialize (multiple returns).</span>
01321 <span class="comment">//</span>
01322 <span class="comment">// Revision 1.4  1994/11/22  14:05:19  jimg</span>
01323 <span class="comment">// Added code for data transmission to parts of the type hierarchy. Not</span>
01324 <span class="comment">// complete yet.</span>
01325 <span class="comment">// Fixed erros in type hierarchy headers (typos, incorrect comments, ...).</span>
01326 <span class="comment">//</span>
01327 <span class="comment">// Revision 1.3  1994/10/17  23:34:42  jimg</span>
01328 <span class="comment">// Added code to print_decl so that variable declarations are pretty</span>
01329 <span class="comment">// printed.</span>
01330 <span class="comment">// Added private mfunc duplicate().</span>
01331 <span class="comment">// Added ptr_duplicate().</span>
01332 <span class="comment">// Added Copy ctor, dtor and operator=.</span>
01333 <span class="comment">//</span>
01334 <span class="comment">// Revision 1.2  1994/09/23  14:31:36  jimg</span>
01335 <span class="comment">// Added check_semantics mfunc.</span>
01336 <span class="comment">// Added sanity checking for access to shape list (is it empty?).</span>
01337 <span class="comment">// Added cvs log listing to Array.cc.</span>
01338 <span class="comment">//</span>
01339 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 4 23:42:54 2004 for libdap++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
