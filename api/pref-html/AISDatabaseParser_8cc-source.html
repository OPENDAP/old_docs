<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libdap++: AISDatabaseParser.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>AISDatabaseParser.cc</h1><a href="AISDatabaseParser_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//</span>
00010 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00011 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00012 <span class="comment">// License as published by the Free Software Foundation; either</span>
00013 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00014 <span class="comment">// </span>
00015 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00016 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00017 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00018 <span class="comment">// Lesser General Public License for more details.</span>
00019 <span class="comment">// </span>
00020 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00021 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00022 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00023 <span class="comment">//</span>
00024 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00027 
00028 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00030 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00031 
00032 <span class="preprocessor">#ifdef WIN32</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define vsnprintf _vsnprintf</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00035 <span class="preprocessor"></span>
00036 <span class="preprocessor">#include "<a class="code" href="AISDatabaseParser_8h.html">AISDatabaseParser.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00038 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00039 
00040 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00041 
00042 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="config__dap_8h.html#a49">not_used</a> <span class="keywordtype">char</span> *states[] = {
00043     <span class="stringliteral">"START"</span>,
00044     <span class="stringliteral">"FINISH"</span>,
00045     <span class="stringliteral">"AIS"</span>,
00046     <span class="stringliteral">"ENTRY"</span>,
00047     <span class="stringliteral">"PRIMARY"</span>,
00048     <span class="stringliteral">"ANCILLARY"</span>,
00049     <span class="stringliteral">"UNKNOWN"</span>,
00050     <span class="stringliteral">"ERROR"</span>
00051 };
00052 
00059 
00063 <span class="keywordtype">void</span> 
<a name="l00064"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_0">00064</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_0">AISDatabaseParser::aisStartDocument</a>(AISParserState *state) 
00065 {
00066     state-&gt;state = PARSER_START;
00067     state-&gt;unknown_depth = 0;
00068     state-&gt;prev_state = PARSER_UNKNOWN;
00069     state-&gt;error_msg = <span class="stringliteral">""</span>;
00070 
00071     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"Parser state: "</span> &lt;&lt; states[state-&gt;state] &lt;&lt; endl);
00072 }
00073 
00076 <span class="keywordtype">void</span> 
<a name="l00077"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_1">00077</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_1">AISDatabaseParser::aisEndDocument</a>(AISParserState *state) 
00078 {
00079     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"Ending state == "</span> &lt;&lt; states[state-&gt;state] &lt;&lt; endl);
00080 
00081     <span class="keywordflow">if</span> (state-&gt;unknown_depth != 0) {
00082     <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a>(state, <span class="stringliteral">"The document contained unbalanced tags."</span>);
00083 
00084         <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"unknown_depth != 0 ("</span> &lt;&lt; state-&gt;unknown_depth &lt;&lt; <span class="stringliteral">")"</span>
00085         &lt;&lt; endl);
00086     }
00087 }
00088 
00097 <span class="keywordtype">void</span> 
<a name="l00098"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_2">00098</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_2">AISDatabaseParser::aisStartElement</a>(AISParserState *state, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, 
00099                    <span class="keyword">const</span> <span class="keywordtype">char</span> **attrs)
00100 {
00101     <span class="keywordflow">switch</span> (state-&gt;state) {
00102       <span class="keywordflow">case</span> PARSER_START:
00103     <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"ais"</span>) != 0) {
00104             <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Expecting ais.  Got "</span> &lt;&lt; name &lt;&lt; endl);
00105     }
00106     state-&gt;state = AIS;
00107     <span class="keywordflow">break</span>;
00108 
00109       <span class="keywordflow">case</span> PARSER_FINISH:
00110     <span class="keywordflow">break</span>;
00111 
00112       <span class="keywordflow">case</span> AIS:
00113         <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"entry"</span>) == 0) {
00114         state-&gt;prev_state = state-&gt;state;
00115         state-&gt;state = ENTRY;
00116         } 
00117     <span class="keywordflow">else</span> {
00118             state-&gt;prev_state = state-&gt;state;
00119             state-&gt;state = PARSER_UNKNOWN;
00120             state-&gt;unknown_depth++;
00121         }
00122         <span class="keywordflow">break</span>;
00123 
00124       <span class="keywordflow">case</span> ENTRY:
00125     <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"primary"</span>) == 0) {
00126         state-&gt;prev_state = state-&gt;state;
00127         state-&gt;state = PRIMARY;
00128 
00129 <span class="preprocessor">#if 0</span>
00130 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (attrs &amp;&amp; (strcmp(attrs[0], <span class="stringliteral">"url"</span>) == 0))
00131         state-&gt;primary = attrs[1];
00132         <span class="keywordflow">else</span> {
00133         <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a>(state, <span class="stringliteral">"Required attribute 'url' missing from element 'primary'."</span>);
00134         <span class="keywordflow">break</span>;
00135         }
00136 <span class="preprocessor">#endif</span>
00137 <span class="preprocessor"></span>
00138         <span class="keywordflow">if</span> (attrs) {
00139         <span class="keywordflow">if</span> (strcmp(attrs[0], <span class="stringliteral">"url"</span>) == 0) {
00140             state-&gt;regexp = <span class="keyword">false</span>;
00141             state-&gt;primary = attrs[1];
00142         }
00143         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(attrs[0], <span class="stringliteral">"regexp"</span>) == 0) {
00144             state-&gt;regexp = <span class="keyword">true</span>;
00145             state-&gt;primary = attrs[1];
00146         }
00147         }
00148         <span class="keywordflow">else</span> {
00149         <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a>(state, <span class="stringliteral">"Required attribute 'url' or 'regexp' missing from element 'primary'."</span>);
00150         <span class="keywordflow">break</span>;
00151         }
00152     }
00153     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"ancillary"</span>) == 0) {
00154         state-&gt;prev_state = state-&gt;state;
00155         state-&gt;state = ANCILLARY;
00156 
00157         string url = <span class="stringliteral">""</span>;    <span class="comment">// set defaults, MUST have url</span>
00158         string rule = <span class="stringliteral">"overwrite"</span>;
00159         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; attrs &amp;&amp; attrs[i] != 0; i = i + 2) {
00160         <span class="keywordflow">if</span> (strcmp(attrs[i], <span class="stringliteral">"url"</span>) == 0)
00161             url = attrs[i+1];
00162         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(attrs[i], <span class="stringliteral">"rule"</span>) == 0)
00163             rule = attrs[i+1];
00164         }
00165 
00166         <span class="comment">// If this parser validated the XML, these tests would be</span>
00167         <span class="comment">// unnecessary. </span>
00168         <span class="keywordflow">if</span> (url == <span class="stringliteral">""</span>) {
00169         <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a>(state, <span class="stringliteral">"Required attribute 'url' missing from element 'ancillary'."</span>);
00170         <span class="keywordflow">break</span>;
00171         }
00172 
00173         <span class="keywordflow">if</span> (rule != <span class="stringliteral">"overwrite"</span> &amp;&amp; rule != <span class="stringliteral">"replace"</span> &amp;&amp; rule != <span class="stringliteral">"fallback"</span>) {
00174         string msg = string(<span class="stringliteral">"Optional attribute 'rule' in element 'ancillary' has a bad value: "</span>) + rule + <span class="stringliteral">"\nIt should be one of 'overwrite', 'replace' or 'fallback'."</span>;
00175         <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a>(state, msg.c_str());
00176         <span class="keywordflow">break</span>;
00177         }
00178 
00179         <a class="code" href="classResource.html">Resource</a> r(url, rule);
00180         state-&gt;rv.push_back(r);
00181     }
00182     <span class="keywordflow">else</span> {
00183             state-&gt;prev_state = state-&gt;state;
00184             state-&gt;state = PARSER_UNKNOWN;
00185             state-&gt;unknown_depth++;
00186         }
00187         <span class="keywordflow">break</span>;
00188 
00189       <span class="keywordflow">case</span> PRIMARY:
00190     <span class="keywordflow">break</span>;
00191 
00192       <span class="keywordflow">case</span> ANCILLARY:
00193     <span class="keywordflow">break</span>;
00194 
00195       <span class="keywordflow">case</span> PARSER_UNKNOWN:
00196     state-&gt;unknown_depth++;
00197     <span class="keywordflow">break</span>;
00198 
00199       <span class="keywordflow">case</span> PARSER_ERROR:
00200     <span class="keywordflow">break</span>;
00201     }
00202 
00203     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"Start element "</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">" (state "</span> 
00204      &lt;&lt; states[state-&gt;state] &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl);
00205 }
00206 
00211 <span class="keywordtype">void</span> 
<a name="l00212"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_3">00212</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_3">AISDatabaseParser::aisEndElement</a>(AISParserState *state, <span class="keyword">const</span> <span class="keywordtype">char</span> *name) 
00213 {
00214     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"End element "</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">" (state "</span> &lt;&lt; states[state-&gt;state] 
00215      &lt;&lt; <span class="stringliteral">")"</span> &lt;&lt; endl);
00216 
00217     <span class="keywordflow">switch</span> (state-&gt;state) {
00218       <span class="keywordflow">case</span> AIS:
00219     state-&gt;prev_state = state-&gt;state;
00220     state-&gt;state = PARSER_FINISH;
00221     <span class="keywordflow">break</span>;
00222 
00223       <span class="keywordflow">case</span> ENTRY:
00224     state-&gt;prev_state = state-&gt;state;
00225     state-&gt;state = AIS;
00226 
00227     <span class="comment">// record 'primary' and 'rv'</span>
00228     <span class="keywordflow">if</span> (state-&gt;regexp)
00229         state-&gt;ais-&gt;add_regexp_resource(state-&gt;primary, state-&gt;rv);
00230     <span class="keywordflow">else</span>
00231         state-&gt;ais-&gt;add_url_resource(state-&gt;primary, state-&gt;rv);
00232 
00233     <span class="comment">// empty rv for the next set of ancillary resources.</span>
00234     state-&gt;rv.erase(state-&gt;rv.begin(), state-&gt;rv.end());
00235     <span class="keywordflow">break</span>;
00236 
00237       <span class="keywordflow">case</span> PRIMARY:
00238     state-&gt;prev_state = state-&gt;state;
00239     state-&gt;state = ENTRY;
00240     <span class="keywordflow">break</span>;
00241 
00242       <span class="keywordflow">case</span> ANCILLARY:
00243     state-&gt;prev_state = state-&gt;state;
00244     state-&gt;state = ENTRY;
00245     <span class="keywordflow">break</span>;
00246 
00247       <span class="keywordflow">case</span> PARSER_UNKNOWN:
00248     <span class="comment">// Leave the state and prev_state alone.</span>
00249     state-&gt;unknown_depth--;
00250     <span class="keywordflow">break</span>;
00251 
00252       <span class="keywordflow">case</span> PARSER_ERROR:
00253     <span class="keywordflow">break</span>;
00254 
00255       <span class="keywordflow">default</span>:
00256     <span class="keywordflow">break</span>;
00257     }
00258 }
00259 
00263 xmlEntityPtr
<a name="l00264"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_4">00264</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_4">AISDatabaseParser::aisGetEntity</a>(AISParserState *state, <span class="keyword">const</span> xmlChar *name) 
00265 {
00266     <span class="keywordflow">return</span> xmlGetPredefinedEntity(name);
00267 }
00268 
00273 <span class="keywordtype">void</span> 
<a name="l00274"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_5">00274</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_5">AISDatabaseParser::aisWarning</a>(AISParserState *state, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ...) 
00275 {
00276     va_list args;
00277 
00278     state-&gt;state = PARSER_ERROR;
00279 
00280     va_start(args, msg);
00281     <span class="keywordtype">char</span> str[1024];
00282     vsnprintf(str, 1024, msg, args);
00283     va_end(args);
00284 
00285     <span class="keywordtype">int</span> line = getLineNumber(state-&gt;ctxt);
00286     state-&gt;error_msg += <span class="stringliteral">"At line: "</span> + <a class="code" href="util_8cc.html#a14">long_to_string</a>(line) + <span class="stringliteral">": "</span>;
00287     state-&gt;error_msg += string(str) + string(<span class="stringliteral">"\n"</span>);
00288 }
00289 
00294 <span class="keywordtype">void</span> 
<a name="l00295"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_6">00295</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_6">AISDatabaseParser::aisError</a>(AISParserState *state, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ...)
00296 {
00297     va_list args;
00298 
00299     state-&gt;state = PARSER_ERROR;
00300 
00301     va_start(args, msg);
00302     <span class="keywordtype">char</span> str[1024];
00303     vsnprintf(str, 1024, msg, args);
00304     va_end(args);
00305 
00306     <span class="keywordtype">int</span> line = getLineNumber(state-&gt;ctxt);
00307     state-&gt;error_msg += <span class="stringliteral">"At line: "</span> + <a class="code" href="util_8cc.html#a14">long_to_string</a>(line) + <span class="stringliteral">": "</span>;
00308     state-&gt;error_msg += string(str) + string(<span class="stringliteral">"\n"</span>);
00309 }
00310 
00314 <span class="keywordtype">void</span> 
<a name="l00315"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">00315</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a>(AISParserState *state, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ...)
00316 {
00317     va_list args;
00318 
00319     state-&gt;state = PARSER_ERROR;
00320 
00321     va_start(args, msg);
00322     <span class="keywordtype">char</span> str[1024];
00323     vsnprintf(str, 1024, msg, args);
00324     va_end(args);
00325 
00326     <span class="keywordtype">int</span> line = getLineNumber(state-&gt;ctxt);
00327     state-&gt;error_msg += <span class="stringliteral">"At line: "</span> + <a class="code" href="util_8cc.html#a14">long_to_string</a>(line) + <span class="stringliteral">": "</span>;
00328     state-&gt;error_msg += string(str) + string(<span class="stringliteral">"\n"</span>);
00329 }
00330 
00332 
00335 <span class="keyword">static</span> xmlSAXHandler aisSAXParser = {
00336     0, <span class="comment">// internalSubset </span>
00337     0, <span class="comment">// isStandalone </span>
00338     0, <span class="comment">// hasInternalSubset </span>
00339     0, <span class="comment">// hasExternalSubset </span>
00340     0, <span class="comment">// resolveEntity </span>
00341     (getEntitySAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_4">AISDatabaseParser::aisGetEntity</a>, <span class="comment">// getEntity </span>
00342     0, <span class="comment">// entityDecl </span>
00343     0, <span class="comment">// notationDecl </span>
00344     0, <span class="comment">// attributeDecl </span>
00345     0, <span class="comment">// elementDecl </span>
00346     0, <span class="comment">// unparsedEntityDecl </span>
00347     0, <span class="comment">// setDocumentLocator </span>
00348     (startDocumentSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_0">AISDatabaseParser::aisStartDocument</a>, <span class="comment">// startDocument</span>
00349     (endDocumentSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_1">AISDatabaseParser::aisEndDocument</a>,  <span class="comment">// endDocument </span>
00350     (startElementSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_2">AISDatabaseParser::aisStartElement</a>,  <span class="comment">// startElement </span>
00351     (endElementSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_3">AISDatabaseParser::aisEndElement</a>,  <span class="comment">// endElement </span>
00352     0, <span class="comment">// reference </span>
00353     0, <span class="comment">// (charactersSAXFunc)gladeCharacters,  characters </span>
00354     0, <span class="comment">// ignorableWhitespace </span>
00355     0, <span class="comment">// processingInstruction </span>
00356     0, <span class="comment">// (commentSAXFunc)gladeComment,  comment </span>
00357     (warningSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_5">AISDatabaseParser::aisWarning</a>, <span class="comment">// warning </span>
00358     (errorSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_6">AISDatabaseParser::aisError</a>, <span class="comment">// error </span>
00359     (fatalErrorSAXFunc)<a class="code" href="classAISDatabaseParser.html#AISDatabaseParserz1_7">AISDatabaseParser::aisFatalError</a> <span class="comment">// fatalError </span>
00360 };
00361 
00368 <span class="keywordtype">void</span>
<a name="l00369"></a><a class="code" href="classAISDatabaseParser.html#AISDatabaseParsera0">00369</a> <a class="code" href="classAISDatabaseParser.html#AISDatabaseParsera0">AISDatabaseParser::intern</a>(<span class="keyword">const</span> string &amp;database, <a class="code" href="classAISResources.html">AISResources</a> *ais)
00370     <span class="keywordflow">throw</span>(<a class="code" href="classAISDatabaseReadFailed.html">AISDatabaseReadFailed</a>)
00371 {
00372     xmlParserCtxtPtr ctxt;
00373     AISParserState state;
00374     
00375     ctxt = xmlCreateFileParserCtxt(database.c_str());
00376     <span class="keywordflow">if</span> (!ctxt) 
00377     <span class="keywordflow">return</span>;
00378 
00379     state.ais = ais;        <span class="comment">// dump values here</span>
00380     state.ctxt = ctxt;      <span class="comment">// need ctxt for error messages</span>
00381 
00382     ctxt-&gt;sax = &amp;aisSAXParser;
00383     ctxt-&gt;userData = &amp;state;
00384     ctxt-&gt;validate = <span class="keyword">true</span>;
00385 
00386     xmlParseDocument(ctxt);
00387     
00388     <span class="comment">// use getLineNumber and getColumnNumber to make the error messages better.</span>
00389     <span class="keywordflow">if</span> (!ctxt-&gt;wellFormed) {
00390     ctxt-&gt;sax = NULL;
00391     xmlFreeParserCtxt(ctxt);
00392     <span class="keywordflow">throw</span> <a class="code" href="classAISDatabaseReadFailed.html">AISDatabaseReadFailed</a>(string(<span class="stringliteral">"\nThe database is not a well formed XML document.\n"</span>) + state.error_msg);
00393     }
00394 
00395     <span class="keywordflow">if</span> (!ctxt-&gt;valid) {
00396     ctxt-&gt;sax = NULL;
00397     xmlFreeParserCtxt(ctxt);
00398     <span class="keywordflow">throw</span> <a class="code" href="classAISDatabaseReadFailed.html">AISDatabaseReadFailed</a>(string(<span class="stringliteral">"\nThe database is not a valid document.\n"</span>) + state.error_msg);
00399     }
00400 
00401     <span class="keywordflow">if</span> (state.state == PARSER_ERROR) {
00402     ctxt-&gt;sax = NULL;
00403     xmlFreeParserCtxt(ctxt);
00404     <span class="keywordflow">throw</span> <a class="code" href="classAISDatabaseReadFailed.html">AISDatabaseReadFailed</a>(string(<span class="stringliteral">"\nError parsing AIS resources.\n"</span>) + state.error_msg);
00405     }
00406 
00407     ctxt-&gt;sax = NULL;
00408     xmlFreeParserCtxt(ctxt);
00409 }
00410 
00411 <span class="comment">// $Log: AISDatabaseParser_8cc-source.html,v $
00411 <span class="comment">// Revision 1.4  2004/02/05 06:51:15  jimg
00411 <span class="comment">// Added/update.
00411 <span class="comment">//</span>
00412 <span class="comment">// Revision 1.6.2.3  2004/01/22 17:09:52  jimg</span>
00413 <span class="comment">// Added std namespace declarations since the DBG() macro uses cerr.</span>
00414 <span class="comment">//</span>
00415 <span class="comment">// Revision 1.6.2.2  2003/09/06 22:16:58  jimg</span>
00416 <span class="comment">// Updated the documentation.</span>
00417 <span class="comment">//</span>
00418 <span class="comment">// Revision 1.6.2.1  2003/06/15 06:54:31  rmorris</span>
00419 <span class="comment">// Initial port regarding AIS* to win32.</span>
00420 <span class="comment">//</span>
00421 <span class="comment">// Revision 1.6  2003/04/22 19:40:27  jimg</span>
00422 <span class="comment">// Merged with 3.3.1.</span>
00423 <span class="comment">//</span>
00424 <span class="comment">// Revision 1.5  2003/03/12 01:07:34  jimg</span>
00425 <span class="comment">// Added regular expressions to the AIS subsystem. In an AIS database (XML)</span>
00426 <span class="comment">// it is now possible to list a regular expression in place of an explicit</span>
00427 <span class="comment">// URL. The AIS will try to match this Regexp against candidate URLs and</span>
00428 <span class="comment">// return the ancillary resources for all those that succeed.</span>
00429 <span class="comment">//</span>
00430 <span class="comment">// Revision 1.4  2003/02/26 01:27:49  jimg</span>
00431 <span class="comment">// Changed the name of the parse() method to intern().</span>
00432 <span class="comment">//</span>
00433 <span class="comment">// Revision 1.3  2003/02/25 04:18:53  jimg</span>
00434 <span class="comment">// Added line numbers to error messages. Improved message formatting a little.</span>
00435 <span class="comment">//</span>
00436 <span class="comment">// Revision 1.2  2003/02/21 00:14:24  jimg</span>
00437 <span class="comment">// Repaired copyright.</span>
00438 <span class="comment">//</span>
00439 <span class="comment">// Revision 1.1  2003/02/20 22:16:04  jimg</span>
00440 <span class="comment">// Added.</span>
00441 <span class="comment">//</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 4 23:42:54 2004 for libdap++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
