<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libdap++: ce_functions.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ce_functions.cc</h1><a href="ce__functions_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2002,2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//</span>
00010 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00011 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00012 <span class="comment">// License as published by the Free Software Foundation; either</span>
00013 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00014 <span class="comment">// </span>
00015 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00016 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00017 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00018 <span class="comment">// Lesser General Public License for more details.</span>
00019 <span class="comment">// </span>
00020 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00021 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00022 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00023 <span class="comment">//</span>
00024 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00025  
00026 <span class="comment">// (c) COPYRIGHT URI/MIT 1999</span>
00027 <span class="comment">// Please read the full copyright statement in the file COPYRIGHT_URI.</span>
00028 <span class="comment">//</span>
00029 <span class="comment">// Authors:</span>
00030 <span class="comment">//      jhrg,jimg       James Gallagher &lt;jgallagher@gso.uri.edu&gt;</span>
00031 
00032 
00033 <span class="comment">// These functions are used by the CE evaluator</span>
00034 <span class="comment">//</span>
00035 <span class="comment">// 1/15/99 jhrg</span>
00036 
00037 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00038 
00039 <span class="keyword">static</span> <span class="keywordtype">char</span> rcsid[] <a class="code" href="config__dap_8h.html#a49">not_used</a> = {<span class="stringliteral">"$Id$"</span>};
00040 
00041 <span class="preprocessor">#include &lt;iostream&gt;</span>
00042 <span class="preprocessor">#include &lt;vector&gt;</span>
00043 
00044 <span class="preprocessor">#include "<a class="code" href="BaseType_8h.html">BaseType.h</a>"</span>
00045 <span class="preprocessor">#include "<a class="code" href="List_8h.html">List.h</a>"</span>
00046 <span class="preprocessor">#include "<a class="code" href="Array_8h.html">Array.h</a>"</span>
00047 <span class="preprocessor">#include "<a class="code" href="Sequence_8h.html">Sequence.h</a>"</span>
00048 <span class="preprocessor">#include "<a class="code" href="Grid_8h.html">Grid.h</a>"</span>
00049 <span class="preprocessor">#include "<a class="code" href="Error_8h.html">Error.h</a>"</span>
00050 <span class="preprocessor">#include "<a class="code" href="GSEClause_8h.html">GSEClause.h</a>"</span>
00051 
00052 <span class="preprocessor">#include "<a class="code" href="parser_8h.html">parser.h</a>"</span>
00053 <span class="preprocessor">#include "gse.tab.h"</span>
00054 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00055 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00056 
00057 <span class="preprocessor">#if defined(_MSC_VER) &amp;&amp; (_MSC_VER == 1200)  //  VC++ 6.0 only</span>
00058 <span class="preprocessor"></span><span class="keyword">using</span> std::vector&lt;GSEClause *&gt;;
00059 <span class="preprocessor">#else</span>
00060 <span class="preprocessor"></span><span class="keyword">using</span> std::vector;
00061 <span class="preprocessor">#endif</span>
00062 <span class="preprocessor"></span>
00063 <span class="keyword">using</span> std::cerr;
00064 <span class="keyword">using</span> std::endl;
00065 
00066 <span class="keywordtype">int</span> <a class="code" href="GSEClause_8cc.html#a1">gse_parse</a>(<span class="keywordtype">void</span> *arg);
00067 <span class="keywordtype">void</span> <a class="code" href="GSEClause_8cc.html#a2">gse_restart</a>(FILE *in);
00068 
00069 <span class="comment">// Glue routines declared in gse.lex</span>
00070 <span class="keywordtype">void</span> <a class="code" href="GSEClause_8cc.html#a3">gse_switch_to_buffer</a>(<span class="keywordtype">void</span> *new_buffer);
00071 <span class="keywordtype">void</span> <a class="code" href="GSEClause_8cc.html#a4">gse_delete_buffer</a>(<span class="keywordtype">void</span> * buffer);
00072 <span class="keywordtype">void</span> *<a class="code" href="GSEClause_8cc.html#a5">gse_string</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *yy_str);
00073 
00074 string
<a name="l00075"></a><a class="code" href="ce__functions_8cc.html#a6">00075</a> <a class="code" href="ce__functions_8cc.html#a6">extract_string_argument</a>(<a class="code" href="classBaseType.html">BaseType</a> *arg)
00076 {
00077     <span class="keywordflow">if</span> (arg-&gt;<a class="code" href="classBaseType.html#Vectora29">type</a>() != <a class="code" href="BaseType_8h.html#a21a13">dods_str_c</a>)
00078     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a5">malformed_expr</a>, 
00079             <span class="stringliteral">"The function requires a DODS string-type argument."</span>);
00080     
00081     string *sp = 0;
00082     arg-&gt;<a class="code" href="classBaseType.html#Constructora32">buf2val</a>((<span class="keywordtype">void</span> **)&amp;sp);
00083     string s = *sp;
00084     <span class="keyword">delete</span> sp; sp = 0;
00085 
00086     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"s: "</span> &lt;&lt; s &lt;&lt; endl);
00087 
00088     <span class="keywordflow">return</span> s;
00089 }
00090 
00091 <span class="keywordtype">bool</span>
<a name="l00092"></a><a class="code" href="ce__functions_8cc.html#a7">00092</a> <a class="code" href="ce__functions_8cc.html#a7">func_member</a>(<span class="keywordtype">int</span> argc, <a class="code" href="classBaseType.html">BaseType</a> *argv[], <a class="code" href="classDDS.html">DDS</a> &amp;dds)
00093 {
00094     <span class="keywordflow">if</span> (argc != 2) {
00095     cerr &lt;&lt; <span class="stringliteral">"Wrong number of arguments."</span> &lt;&lt; endl;
00096     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00097     }
00098     
00099     <span class="keywordflow">switch</span>(argv[0]-&gt;<a class="code" href="classBaseType.html#Vectora29">type</a>()) {
00100       <span class="keywordflow">case</span> <a class="code" href="BaseType_8h.html#a21a16">dods_list_c</a>: {
00101         <a class="code" href="classList.html">List</a> *var = (<a class="code" href="classList.html">List</a> *)argv[0];
00102         <a class="code" href="classBaseType.html">BaseType</a> *btp = (<a class="code" href="classBaseType.html">BaseType</a> *)argv[1];
00103         <span class="keywordtype">bool</span> result = var-&gt;<a class="code" href="classList.html#Lista5">member</a>(btp, dds);
00104     
00105         <span class="keywordflow">return</span> result;
00106       }
00107       
00108       <span class="keywordflow">default</span>:
00109         cerr &lt;&lt; <span class="stringliteral">"Wrong argument type."</span> &lt;&lt; endl;
00110         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00111     }
00112 
00113 }
00114 
00115 <span class="keywordtype">bool</span>
<a name="l00116"></a><a class="code" href="ce__functions_8cc.html#a8">00116</a> <a class="code" href="ce__functions_8cc.html#a8">func_null</a>(<span class="keywordtype">int</span> argc, <a class="code" href="classBaseType.html">BaseType</a> *argv[], <a class="code" href="classDDS.html">DDS</a> &amp;)
00117 {
00118     <span class="keywordflow">if</span> (argc != 1) {
00119         cerr &lt;&lt; <span class="stringliteral">"Wrong number of arguments."</span> &lt;&lt; endl;
00120         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00121     }
00122     
00123     <span class="keywordflow">switch</span>(argv[0]-&gt;<a class="code" href="classBaseType.html#Vectora29">type</a>()) {
00124       <span class="keywordflow">case</span>  <a class="code" href="BaseType_8h.html#a21a16">dods_list_c</a>: {
00125     <a class="code" href="classList.html">List</a> *var = (<a class="code" href="classList.html">List</a> *)argv[0];
00126     <span class="keywordtype">bool</span> result = var-&gt;<a class="code" href="classList.html#Lista6">null</a>();
00127     
00128     <span class="keywordflow">return</span> result;
00129       }
00130 
00131       <span class="keywordflow">default</span>:
00132         cerr &lt;&lt; <span class="stringliteral">"Wrong argument type."</span> &lt;&lt; endl;
00133     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00134     }
00135 
00136 }
00137 
00138 <a class="code" href="classBaseType.html">BaseType</a> *
<a name="l00139"></a><a class="code" href="ce__functions_8cc.html#a9">00139</a> <a class="code" href="ce__functions_8cc.html#a9">func_length</a>(<span class="keywordtype">int</span> argc, <a class="code" href="classBaseType.html">BaseType</a> *argv[], <a class="code" href="classDDS.html">DDS</a> &amp;dds)
00140 {
00141     <span class="keywordflow">if</span> (argc != 1) {
00142     cerr &lt;&lt; <span class="stringliteral">"Wrong number of arguments."</span> &lt;&lt; endl;
00143     <span class="keywordflow">return</span> 0;
00144     }
00145     
00146     <span class="keywordflow">switch</span> (argv[0]-&gt;<a class="code" href="classBaseType.html#Vectora29">type</a>()) {
00147       <span class="keywordflow">case</span> <a class="code" href="BaseType_8h.html#a21a16">dods_list_c</a>: {
00148       <a class="code" href="classList.html">List</a> *var = (<a class="code" href="classList.html">List</a> *)argv[0];
00149       <a class="code" href="dods-datatypes_8h.html#a13">dods_int32</a> result = var-&gt;<a class="code" href="classVector.html#Vectora9">length</a>();
00150     
00151       <a class="code" href="classBaseType.html">BaseType</a> *ret = (<a class="code" href="classBaseType.html">BaseType</a> *)<a class="code" href="VirtualCtorInt32_8cc.html#a1">NewInt32</a>(<span class="stringliteral">"constant"</span>);
00152       ret-&gt;<a class="code" href="classBaseType.html#Constructora33">val2buf</a>(&amp;result);
00153       ret-&gt;<a class="code" href="classBaseType.html#Urla25">set_read_p</a>(<span class="keyword">true</span>);
00154       ret-&gt;<a class="code" href="classBaseType.html#Urla27">set_send_p</a>(<span class="keyword">true</span>);
00155       dds.<a class="code" href="classDDS.html#DDSa39">append_constant</a>(ret); <span class="comment">// DDS deletes in its dtor</span>
00156 
00157       <span class="keywordflow">return</span> ret;
00158       }
00159 
00160       <span class="keywordflow">case</span> <a class="code" href="BaseType_8h.html#a21a18">dods_sequence_c</a>: {
00161       <a class="code" href="classSequence.html">Sequence</a> *var = dynamic_cast&lt;Sequence *&gt;(argv[0]);
00162       <span class="keywordflow">if</span> (!var)
00163           <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a1">unknown_error</a>, <span class="stringliteral">"Expected a Sequence variable"</span>);
00164       <a class="code" href="dods-datatypes_8h.html#a13">dods_int32</a> result = var-&gt;<a class="code" href="classSequence.html#Sequencea12">length</a>();
00165     
00166       <a class="code" href="classBaseType.html">BaseType</a> *ret = (<a class="code" href="classBaseType.html">BaseType</a> *)<a class="code" href="VirtualCtorInt32_8cc.html#a1">NewInt32</a>(<span class="stringliteral">"constant"</span>);
00167       ret-&gt;<a class="code" href="classBaseType.html#Constructora33">val2buf</a>(&amp;result);
00168       ret-&gt;<a class="code" href="classBaseType.html#Urla25">set_read_p</a>(<span class="keyword">true</span>);
00169       ret-&gt;<a class="code" href="classBaseType.html#Urla27">set_send_p</a>(<span class="keyword">true</span>);
00170       dds.<a class="code" href="classDDS.html#DDSa39">append_constant</a>(ret); 
00171     
00172       <span class="keywordflow">return</span> ret;
00173       }
00174 
00175       <span class="keywordflow">default</span>:
00176     cerr &lt;&lt; <span class="stringliteral">"Wrong type argument to list operator `length'"</span> &lt;&lt; endl;
00177     <span class="keywordflow">return</span> 0;
00178     }
00179 }
00180 
00181 <a class="code" href="classBaseType.html">BaseType</a> *
<a name="l00182"></a><a class="code" href="ce__functions_8cc.html#a10">00182</a> <a class="code" href="ce__functions_8cc.html#a10">func_nth</a>(<span class="keywordtype">int</span> argc, <a class="code" href="classBaseType.html">BaseType</a> *argv[], <a class="code" href="classDDS.html">DDS</a> &amp;)
00183 {
00184     <span class="keywordflow">if</span> (argc != 2) {
00185     cerr &lt;&lt; <span class="stringliteral">"Wrong number of arguments."</span> &lt;&lt; endl;
00186     <span class="keywordflow">return</span> 0;
00187     }
00188     
00189     <span class="keywordflow">switch</span> (argv[0]-&gt;<a class="code" href="classBaseType.html#Vectora29">type</a>()) {
00190     <span class="keywordflow">case</span> <a class="code" href="BaseType_8h.html#a21a16">dods_list_c</a>: {
00191         <span class="keywordflow">if</span> (argv[1]-&gt;<a class="code" href="classBaseType.html#Vectora29">type</a>() != <a class="code" href="BaseType_8h.html#a21a9">dods_int32_c</a>) {
00192         cerr &lt;&lt; <span class="stringliteral">"Second argument to NTH must be an integer."</span> &lt;&lt; endl;
00193         <span class="keywordflow">return</span> 0;
00194         }
00195         <a class="code" href="classList.html">List</a> *var = (<a class="code" href="classList.html">List</a> *)argv[0];
00196         <a class="code" href="dods-datatypes_8h.html#a13">dods_int32</a> n;
00197         <a class="code" href="dods-datatypes_8h.html#a13">dods_int32</a> *np = &amp;n;
00198         argv[1]-&gt;<a class="code" href="classBaseType.html#Constructora32">buf2val</a>((<span class="keywordtype">void</span> **)&amp;np);
00199 
00200         <span class="keywordflow">return</span> var-&gt;<a class="code" href="classVector.html#Vectora17">var</a>(n);
00201     }
00202 
00203       <span class="keywordflow">default</span>:
00204     cerr &lt;&lt; <span class="stringliteral">"Wrong type argument to list operator `nth'"</span> &lt;&lt; endl;
00205     <span class="keywordflow">return</span> 0;
00206     }
00207 }
00208 
00209 <span class="keywordtype">void</span>
<a name="l00210"></a><a class="code" href="ce__functions_8cc.html#a11">00210</a> <a class="code" href="ce__functions_8cc.html#a11">parse_gse_expression</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <a class="code" href="classBaseType.html">BaseType</a> *expr)
00211 {
00212     <a class="code" href="GSEClause_8cc.html#a2">gse_restart</a>(0);     <span class="comment">// Restart the scanner.</span>
00213     <span class="keywordtype">void</span> *cls = <a class="code" href="GSEClause_8cc.html#a5">gse_string</a>(<a class="code" href="ce__functions_8cc.html#a6">extract_string_argument</a>(expr).c_str());
00214     <span class="comment">// gse_switch_to_buffer(cls); // Get set to scan the string.</span>
00215     <span class="keywordtype">bool</span> status = <a class="code" href="GSEClause_8cc.html#a1">gse_parse</a>((<span class="keywordtype">void</span> *)arg) == 0;
00216     <a class="code" href="GSEClause_8cc.html#a4">gse_delete_buffer</a>(cls);
00217     <span class="keywordflow">if</span> (!status)
00218     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a5">malformed_expr</a>, <span class="stringliteral">"Error parsing grid selection."</span>);
00219 }
00220 
00221 <span class="comment">// Assume the following arguments are sent to func_grid_select:</span>
00222 <span class="comment">// Grid name, 0 or more strings which contain relational expressions.</span>
00223 
00224 <span class="comment">// This function has the type 'proj_func' (it is a projection function). It</span>
00225 <span class="comment">// must be used in the projection part of a CE. However, it performs a mix of</span>
00226 <span class="comment">// operations, some that are really projection (marking variables to be</span>
00227 <span class="comment">// returned) and some that are selection (choosing what to return based on</span>
00228 <span class="comment">// the values of variables, not just their structure).</span>
00229 <span class="keywordtype">void</span> 
<a name="l00230"></a><a class="code" href="ce__functions_8cc.html#a12">00230</a> <a class="code" href="ce__functions_8cc.html#a12">func_grid_select</a>(<span class="keywordtype">int</span> argc, <a class="code" href="classBaseType.html">BaseType</a> *argv[], <a class="code" href="classDDS.html">DDS</a> &amp;dds)
00231 {
00232     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Entering func_grid_select..."</span> &lt;&lt; endl);
00233 
00234     <span class="keywordflow">if</span> (argc &lt; 1)
00235     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a1">unknown_error</a>, <span class="stringliteral">"Wrong number of arguments to grid()"</span>);
00236 
00237     <a class="code" href="classGrid.html">Grid</a> *grid = dynamic_cast&lt;Grid*&gt;(argv[0]);
00238     <span class="keywordflow">if</span> (!grid)
00239     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<span class="stringliteral">"The first argument to grid() must be a Grid variable!"</span>);
00240 
00241     <span class="comment">// Mark this grid as part of the current projection.</span>
00242     <span class="keywordflow">if</span> (!dds.<a class="code" href="classDDS.html#DDSa49">mark</a>(grid-&gt;<a class="code" href="classBaseType.html#Vectora27">name</a>(), <span class="keyword">true</span>))
00243     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<span class="stringliteral">"Could not find the variable: "</span> + grid-&gt;<a class="code" href="classBaseType.html#Vectora27">name</a>());
00244 
00245     <span class="comment">// argv[1..n] holds strings; each are little expressions to be parsed.</span>
00246     vector&lt;GSEClause *&gt; clauses;
00247     <a class="code" href="structgse__arg.html">gse_arg</a> *arg = <span class="keyword">new</span> <a class="code" href="structgse__arg.html">gse_arg</a>(grid);
00248     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i) {
00249     <a class="code" href="ce__functions_8cc.html#a11">parse_gse_expression</a>(arg, argv[i]);
00250     clauses.push_back(arg-&gt;<a class="code" href="structgse__arg.html#gse__arga4">get_gsec</a>());
00251     }
00252     <span class="keyword">delete</span> arg;
00253 
00254     <span class="comment">// In this loop we have to iterate over the map vectors and the grid</span>
00255     <span class="comment">// dimensions at the same time and set the grid's array's constraint to</span>
00256     <span class="comment">// match that of the map vectors. Maybe we need an interface in Grid to</span>
00257     <span class="comment">// do this? 9/21/2001 jhrg</span>
00258     <a class="code" href="classArray.html">Array</a> *grid_array = dynamic_cast&lt;Array *&gt;(grid-&gt;<a class="code" href="classGrid.html#Grida12">array_var</a>());
00259 
00260     <a class="code" href="classGrid.html#Gridw1">Grid::Map_iter</a> piter = grid-&gt;<a class="code" href="classGrid.html#Grida28">map_begin</a>() ;
00261     <a class="code" href="classArray.html#Arrayw1">Array::Dim_iter</a> grid_dim = grid_array-&gt;<a class="code" href="classArray.html#Arraya13">dim_begin</a>() ;
00262     <span class="keywordflow">for</span> (; piter != grid-&gt;<a class="code" href="classGrid.html#Grida29">map_end</a>(); piter++, grid_dim++)
00263     {
00264     <a class="code" href="classArray.html">Array</a> *map = dynamic_cast&lt;Array *&gt;((*piter)) ;
00265     string map_name = map-&gt;<a class="code" href="classBaseType.html#Vectora27">name</a>();
00266 
00267     <span class="comment">// a valid Grid Map is a vector.</span>
00268     <a class="code" href="classArray.html#Arrayw1">Array::Dim_iter</a> qiter = map-&gt;<a class="code" href="classArray.html#Arraya13">dim_begin</a>();
00269 
00270     <span class="keywordtype">int</span> start = map-&gt;<a class="code" href="classArray.html#Arraya17">dimension_start</a>(qiter);
00271     <span class="keywordtype">int</span> stop = map-&gt;<a class="code" href="classArray.html#Arraya19">dimension_stop</a>(qiter);
00272 
00273     vector&lt;GSEClause*&gt;::iterator cs_iter;
00274     <span class="keywordflow">for</span> (cs_iter = clauses.begin(); cs_iter != clauses.end(); cs_iter++) {
00275         <a class="code" href="classGSEClause.html">GSEClause</a> *gsec = *cs_iter;
00276         <span class="keywordflow">if</span> (gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_1">get_map_name</a>() == map_name) {
00277         <span class="keywordflow">if</span> (gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_2">get_start</a>() &gt;= start)
00278             start = gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_2">get_start</a>();
00279         <span class="keywordflow">else</span>
00280             <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__,
00281                   <span class="stringliteral">"Improper starting Grid selection value; the value preceeds the starting index of the map vector."</span>);
00282 
00283         <span class="keywordflow">if</span> (gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_3">get_stop</a>() &lt;= stop)
00284             stop = gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_3">get_stop</a>();
00285         <span class="keywordflow">else</span>
00286             <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__,
00287                    <span class="stringliteral">"Improper ending Grid selection value; the index overran the end of the map vector"</span>);
00288 
00289         <span class="keywordflow">if</span> (start &gt; stop) {
00290             string msg = <span class="stringliteral">"The selection range given does not correspond to any values of "</span>;
00291             msg += gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_1">get_map_name</a>()
00292             + (string)<span class="stringliteral">".\nThe vector's values range from "</span>
00293             + gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_4">get_map_min_value</a>()
00294             + (string)<span class="stringliteral">" to "</span>
00295             + gsec-&gt;<a class="code" href="classGSEClause.html#GSEClausez78_5">get_map_max_value</a>()
00296             + (string)<span class="stringliteral">"."</span>;
00297             <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<a class="code" href="Error_8h.html#a1">unknown_error</a>, msg);
00298         }
00299         <span class="comment">// This map is constrained, set read_p so that during</span>
00300         <span class="comment">// serialization new values will be read according to the</span>
00301         <span class="comment">// constraint set here. 9/21/2001 jhrg</span>
00302         map-&gt;<a class="code" href="classVector.html#Vectora7">set_read_p</a>(<span class="keyword">false</span>);
00303         }
00304     }       
00305     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Setting constraint on "</span> &lt;&lt; map-&gt;<a class="code" href="classBaseType.html#Vectora27">name</a>() \
00306         &lt;&lt; <span class="stringliteral">"["</span> &lt;&lt; start &lt;&lt; <span class="stringliteral">":"</span> &lt;&lt; stop &lt;&lt; <span class="stringliteral">"]"</span> &lt;&lt; endl);
00307 
00308     <span class="comment">// Stride is always one.</span>
00309     <a class="code" href="classArray.html#Arrayw1">Array::Dim_iter</a> fd = map-&gt;<a class="code" href="classArray.html#Arraya13">dim_begin</a>() ;
00310     map-&gt;<a class="code" href="classArray.html#Arraya7">add_constraint</a>(fd, start, 1, stop);
00311     grid_array-&gt;<a class="code" href="classArray.html#Arraya7">add_constraint</a>(grid_dim, start, 1, stop);
00312     }
00313     
00314     <span class="comment">// Make sure we reread the grid's array, too. 9/24/2001 jhrg</span>
00315     grid_array-&gt;<a class="code" href="classVector.html#Vectora7">set_read_p</a>(<span class="keyword">false</span>);
00316 
00317     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Exiting func_grid_select."</span> &lt;&lt; endl);
00318 }
00319 
00320 <span class="comment">// $Log: ce__functions_8cc-source.html,v $
00320 <span class="comment">// Revision 1.4  2004/02/05 06:51:17  jimg
00320 <span class="comment">// Added/update.
00320 <span class="comment">//</span>
00321 <span class="comment">// Revision 1.15.2.2  2004/01/17 13:37:50  rmorris</span>
00322 <span class="comment">// Mod's to account for differences in usage statements containing template</span>
00323 <span class="comment">// reference between MS VC++ 6.0 and MS VC++ 7.0.</span>
00324 <span class="comment">//</span>
00325 <span class="comment">// Revision 1.15.2.1  2003/09/06 22:58:59  jimg</span>
00326 <span class="comment">// New Comments.</span>
00327 <span class="comment">//</span>
00328 <span class="comment">// Revision 1.15  2003/04/22 19:40:28  jimg</span>
00329 <span class="comment">// Merged with 3.3.1.</span>
00330 <span class="comment">//</span>
00331 <span class="comment">// Revision 1.13.2.2  2003/04/18 03:33:58  jimg</span>
00332 <span class="comment">// Added check to grid(); throws Error if the named Grid does not exist.</span>
00333 <span class="comment">//</span>
00334 <span class="comment">// Revision 1.14  2003/02/21 00:14:25  jimg</span>
00335 <span class="comment">// Repaired copyright.</span>
00336 <span class="comment">//</span>
00337 <span class="comment">// Revision 1.13.2.1  2003/02/21 00:10:07  jimg</span>
00338 <span class="comment">// Repaired copyright.</span>
00339 <span class="comment">//</span>
00340 <span class="comment">// Revision 1.13  2003/01/23 00:22:24  jimg</span>
00341 <span class="comment">// Updated the copyright notice; this implementation of the DAP is</span>
00342 <span class="comment">// copyrighted by OPeNDAP, Inc.</span>
00343 <span class="comment">//</span>
00344 <span class="comment">// Revision 1.12  2003/01/10 19:46:40  jimg</span>
00345 <span class="comment">// Merged with code tagged release-3-2-10 on the release-3-2 branch. In many</span>
00346 <span class="comment">// cases files were added on that branch (so they appear on the trunk for</span>
00347 <span class="comment">// the first time).</span>
00348 <span class="comment">//</span>
00349 <span class="comment">// Revision 1.8.4.9  2002/10/28 21:17:44  pwest</span>
00350 <span class="comment">// Converted all return values and method parameters to use non-const iterator.</span>
00351 <span class="comment">// Added operator== and operator!= methods to IteratorAdapter to handle Pix</span>
00352 <span class="comment">// problems.</span>
00353 <span class="comment">//</span>
00354 <span class="comment">// Revision 1.8.4.8  2002/09/12 22:49:58  pwest</span>
00355 <span class="comment">// Corrected signature changes made with Pix to IteratorAdapter changes. Rather</span>
00356 <span class="comment">// than taking a reference to a Pix, taking a Pix value.</span>
00357 <span class="comment">//</span>
00358 <span class="comment">// Revision 1.8.4.7  2002/09/05 22:52:54  pwest</span>
00359 <span class="comment">// Replaced the GNU data structures SLList and DLList with the STL container</span>
00360 <span class="comment">// class vector&lt;&gt;. To maintain use of Pix, changed the Pix.h header file to</span>
00361 <span class="comment">// redefine Pix to be an IteratorAdapter. Usage remains the same and all code</span>
00362 <span class="comment">// outside of the DAP should compile and link with no problems. Added methods</span>
00363 <span class="comment">// to the different classes where Pix is used to include methods to use STL</span>
00364 <span class="comment">// iterators. Replaced the use of Pix within the DAP to use iterators instead.</span>
00365 <span class="comment">// Updated comments for documentation, updated the test suites, and added some</span>
00366 <span class="comment">// unit tests. Updated the Makefile to remove GNU/SLList and GNU/DLList.</span>
00367 <span class="comment">//</span>
00368 <span class="comment">// Revision 1.8.4.6  2002/08/08 06:54:57  jimg</span>
00369 <span class="comment">// Changes for thread-safety. In many cases I found ugly places at the</span>
00370 <span class="comment">// tops of files while looking for globals, et c., and I fixed them up</span>
00371 <span class="comment">// (hopefully making them easier to read, ...). Only the files RCReader.cc</span>
00372 <span class="comment">// and usage.cc actually use pthreads synchronization functions. In other</span>
00373 <span class="comment">// cases I removed static objects where they were used for supposed</span>
00374 <span class="comment">// improvements in efficiency which had never actually been verifiied (and</span>
00375 <span class="comment">// which looked dubious).</span>
00376 <span class="comment">//</span>
00377 <span class="comment">// Revision 1.11  2002/06/03 22:21:15  jimg</span>
00378 <span class="comment">// Merged with release-3-2-9</span>
00379 <span class="comment">//</span>
00380 <span class="comment">// Revision 1.8.4.5  2002/03/01 21:03:08  jimg</span>
00381 <span class="comment">// Significant changes to the var(...) methods. These now take a btp_stack</span>
00382 <span class="comment">// pointer and are used by DDS::mark(...). The exact_match methods have also</span>
00383 <span class="comment">// been updated so that leaf variables which contain dots in their names</span>
00384 <span class="comment">// will be found. Note that constructor variables with dots in their names</span>
00385 <span class="comment">// will break the lookup routines unless the ctor is the last field in the</span>
00386 <span class="comment">// constraint expression. These changes were made to fix bug 330.</span>
00387 <span class="comment">//</span>
00388 <span class="comment">// Revision 1.8.4.4  2001/10/30 06:55:45  rmorris</span>
00389 <span class="comment">// Win32 porting changes.  Brings core win32 port up-to-date.</span>
00390 <span class="comment">//</span>
00391 <span class="comment">// Revision 1.10  2001/09/28 17:50:07  jimg</span>
00392 <span class="comment">// Merged with 3.2.7.</span>
00393 <span class="comment">//</span>
00394 <span class="comment">// Revision 1.8.4.3  2001/09/25 20:26:53  jimg</span>
00395 <span class="comment">// Massive fixes to the grid() server side function.</span>
00396 <span class="comment">//</span>
00397 <span class="comment">// Revision 1.9  2001/08/24 17:46:22  jimg</span>
00398 <span class="comment">// Resolved conflicts from the merge of release 3.2.6</span>
00399 <span class="comment">//</span>
00400 <span class="comment">// Revision 1.8.4.2  2001/08/18 00:13:03  jimg</span>
00401 <span class="comment">// Removed WIN32 compile guards from using statements.</span>
00402 <span class="comment">//</span>
00403 <span class="comment">// Revision 1.8.4.1  2001/07/28 01:10:42  jimg</span>
00404 <span class="comment">// Some of the numeric type classes did not have copy ctors or operator=.</span>
00405 <span class="comment">// I added those where they were needed.</span>
00406 <span class="comment">// In every place where delete (or delete []) was called, I set the pointer</span>
00407 <span class="comment">// just deleted to zero. Thus if for some reason delete is called again</span>
00408 <span class="comment">// before new memory is allocated there won't be a mysterious crash. This is</span>
00409 <span class="comment">// just good form when using delete.</span>
00410 <span class="comment">// I added calls to www2id and id2www where appropriate. The DAP now handles</span>
00411 <span class="comment">// making sure that names are escaped and unescaped as needed. Connect is</span>
00412 <span class="comment">// set to handle CEs that contain names as they are in the dataset (see the</span>
00413 <span class="comment">// comments/Log there). Servers should not handle escaping or unescaping</span>
00414 <span class="comment">// characters on their own.</span>
00415 <span class="comment">//</span>
00416 <span class="comment">// Revision 1.8  2000/09/22 02:17:22  jimg</span>
00417 <span class="comment">// Rearranged source files so that the CVS logs appear at the end rather than</span>
00418 <span class="comment">// the start. Also made the ifdef guard symbols use the same naming scheme and</span>
00419 <span class="comment">// wrapped headers included in other headers in those guard symbols (to cut</span>
00420 <span class="comment">// down on extraneous file processing - See Lakos).</span>
00421 <span class="comment">//</span>
00422 <span class="comment">// Revision 1.7  2000/09/21 16:22:09  jimg</span>
00423 <span class="comment">// Merged changes from Jose Garcia that add exceptions to the software.</span>
00424 <span class="comment">// Many methods that returned error codes now throw exectptions. There are</span>
00425 <span class="comment">// two classes which are thrown by the software, Error and InternalErr.</span>
00426 <span class="comment">// InternalErr is used to report errors within the library or errors using</span>
00427 <span class="comment">// the library. Error is used to reprot all other errors. Since InternalErr</span>
00428 <span class="comment">// is a subclass of Error, programs need only to catch Error.</span>
00429 <span class="comment">//</span>
00430 <span class="comment">// Revision 1.6  2000/07/09 22:05:36  rmorris</span>
00431 <span class="comment">// Changes to increase portability, minimize ifdef's for win32 and account</span>
00432 <span class="comment">// for differences in the iostreams implementations.</span>
00433 <span class="comment">//</span>
00434 <span class="comment">// Revision 1.5  2000/06/07 18:06:59  jimg</span>
00435 <span class="comment">// Merged the pc port branch</span>
00436 <span class="comment">//</span>
00437 <span class="comment">// Revision 1.4.20.1  2000/06/02 18:36:38  rmorris</span>
00438 <span class="comment">// Mod's for port to Win32.</span>
00439 <span class="comment">//</span>
00440 <span class="comment">// Revision 1.4.14.1  2000/02/17 05:03:16  jimg</span>
00441 <span class="comment">// Added file and line number information to calls to InternalErr.</span>
00442 <span class="comment">// Resolved compile-time problems with read due to a change in its</span>
00443 <span class="comment">// parameter list given that errors are now reported using exceptions.</span>
00444 <span class="comment">//</span>
00445 <span class="comment">// Revision 1.4  1999/04/29 02:29:34  jimg</span>
00446 <span class="comment">// Merge of no-gnu branch</span>
00447 <span class="comment">//</span>
00448 <span class="comment">// Revision 1.3  1999/04/22 22:30:52  jimg</span>
00449 <span class="comment">// Uses dynamic_cast</span>
00450 <span class="comment">//</span>
00451 <span class="comment">// Revision 1.2  1999/01/21 02:52:52  jimg</span>
00452 <span class="comment">// Added extract_string_argument function.</span>
00453 <span class="comment">// Added grid_selection projection function.</span>
00454 <span class="comment">//</span>
00455 <span class="comment">// Revision 1.1  1999/01/15 22:06:44  jimg</span>
00456 <span class="comment">// Moved code from util.cc</span>
00457 <span class="comment">//</span>
00458 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 4 23:42:57 2004 for libdap++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
