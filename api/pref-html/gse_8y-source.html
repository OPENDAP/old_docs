<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gse.y Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>gse.y</h1><a href="gse_8y.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2002,2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//</span>
00010 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00011 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00012 <span class="comment">// License as published by the Free Software Foundation; either</span>
00013 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00014 <span class="comment">// </span>
00015 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00016 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00017 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00018 <span class="comment">// Lesser General Public License for more details.</span>
00019 <span class="comment">// </span>
00020 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00021 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00022 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00023 <span class="comment">//</span>
00024 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00025  
00026 <span class="comment">// (c) COPYRIGHT URI/MIT 1999</span>
00027 <span class="comment">// Please read the full copyright statement in the file COPYRIGHT_URI.</span>
00028 <span class="comment">//</span>
00029 <span class="comment">// Authors:</span>
00030 <span class="comment">//      jhrg,jimg       James Gallagher &lt;jgallagher@gso.uri.edu&gt;</span>
00031 
00032 <span class="comment">// Parse a Grid selection expression. This parser is a little different than</span>
00033 <span class="comment">// the other parsers and uses its own argument class. See parser.h.</span>
00034 
00035 %{
00036 
00037 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00038 
00039 <span class="keyword">static</span> <span class="keywordtype">char</span> rcsid[] not_used = {<span class="stringliteral">"$Id$"</span>};
00040 
00041 <span class="preprocessor">#include &lt;iostream&gt;</span>
00042 
00043 <span class="preprocessor">#include "<a class="code" href="Error_8h.html">Error.h</a>"</span>
00044 <span class="preprocessor">#include "<a class="code" href="GSEClause_8h.html">GSEClause.h</a>"</span>
00045 <span class="preprocessor">#include "<a class="code" href="parser_8h.html">parser.h</a>"</span>
00046 
00047 <span class="keyword">using</span> std::cerr;
00048 <span class="keyword">using</span> std::endl;
00049 
00050 <span class="comment">// This macro is used to access the instance of a gse_arg class which is</span>
00051 <span class="comment">// passed to the parser through a void *. See parser.h.</span>
00052 
00053 <span class="preprocessor">#define gse_arg(arg) ((gse_arg *)(arg))</span>
00054 <span class="preprocessor"></span>
00055 <span class="comment">// Assume bison 1.25</span>
00056 <span class="preprocessor">#define YYPARSE_PARAM arg</span>
00057 <span class="preprocessor"></span>
00058 <span class="keywordtype">int</span> <a class="code" href="gse-test_8cc.html#a10">gse_lex</a>(<span class="keywordtype">void</span>);
00059 <span class="keywordtype">void</span> <a class="code" href="gse_8y.html#a5">gse_error</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str);
00060 <a class="code" href="classGSEClause.html">GSEClause</a> *<a class="code" href="gse_8y.html#a8">build_gse_clause</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <span class="keywordtype">char</span> id[ID_MAX], <span class="keywordtype">int</span> op, <span class="keywordtype">double</span> val);
00061 <a class="code" href="classGSEClause.html">GSEClause</a> *<a class="code" href="gse_8y.html#a9">build_rev_gse_clause</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <span class="keywordtype">char</span> id[ID_MAX], <span class="keywordtype">int</span> op,
00062                 <span class="keywordtype">double</span> val);
00063 <a class="code" href="classGSEClause.html">GSEClause</a> *
00064 <a class="code" href="gse_8y.html#a10">build_dual_gse_clause</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <span class="keywordtype">char</span> id[ID_MAX], <span class="keywordtype">int</span> op1, <span class="keywordtype">double</span> val1, 
00065               <span class="keywordtype">int</span> op2, <span class="keywordtype">double</span> val2);
00066 
00067 %}
00068 
00069 %<span class="keyword">union </span>{
00070     <span class="keywordtype">bool</span> <span class="keywordtype">boolean</span>;
00071 
00072     <span class="keywordtype">int</span> op;
00073     <span class="keywordtype">char</span> id[ID_MAX];
00074     <span class="keywordtype">double</span> val;
00075 }
00076 
00077 %token &lt;val&gt; SCAN_INT
00078 %token &lt;val&gt; SCAN_FLOAT
00079 
00080 %token &lt;id&gt; SCAN_WORD
00081 %token &lt;id&gt; SCAN_FIELD
00082 
00083 %token &lt;op&gt; SCAN_EQUAL
00084 %token &lt;op&gt; SCAN_NOT_EQUAL
00085 %token &lt;op&gt; SCAN_GREATER
00086 %token &lt;op&gt; SCAN_GREATER_EQL
00087 %token &lt;op&gt; SCAN_LESS
00088 %token &lt;op&gt; SCAN_LESS_EQL
00089 
00090 %type &lt;boolean&gt; clause
00091 %type &lt;id&gt; identifier
00092 %type &lt;op&gt; <a class="code" href="GSEClause_8h.html#a16">relop</a>
00093 %type &lt;val&gt; constant
00094 
00095 %%
00096 
00097 clause:     identifier <a class="code" href="GSEClause_8h.html#a16">relop</a> constant
00098                 {
00099             ((<a class="code" href="structgse__arg.html">gse_arg</a> *)arg)-&gt;set_gsec(
00100             <a class="code" href="gse_8y.html#a8">build_gse_clause</a>((<a class="code" href="structgse__arg.html">gse_arg</a> *)(arg), $1, $2, $3));
00101             $$ = <span class="keyword">true</span>;
00102         }
00103         | constant <a class="code" href="GSEClause_8h.html#a16">relop</a> identifier
00104                 {
00105             ((<a class="code" href="structgse__arg.html">gse_arg</a> *)arg)-&gt;set_gsec(
00106                <a class="code" href="gse_8y.html#a9">build_rev_gse_clause</a>((<a class="code" href="structgse__arg.html">gse_arg</a> *)(arg), $3, $2, $1));
00107             $$ = <span class="keyword">true</span>;
00108         }
00109         | constant <a class="code" href="GSEClause_8h.html#a16">relop</a> identifier <a class="code" href="GSEClause_8h.html#a16">relop</a> constant
00110                 {
00111             ((<a class="code" href="structgse__arg.html">gse_arg</a> *)arg)-&gt;set_gsec(
00112                <a class="code" href="gse_8y.html#a10">build_dual_gse_clause</a>((<a class="code" href="structgse__arg.html">gse_arg</a> *)(arg), $3, $2, $1, $4,
00113                          $5));
00114             $$ = <span class="keyword">true</span>;
00115         }
00116 ;
00117 
00118 identifier: SCAN_WORD 
00119 ;
00120 
00121 constant:       SCAN_INT
00122         | SCAN_FLOAT
00123 ;
00124 
00125 <a class="code" href="GSEClause_8h.html#a16">relop</a>:      SCAN_EQUAL
00126                 | SCAN_NOT_EQUAL
00127         | SCAN_GREATER
00128         | SCAN_GREATER_EQL
00129         | SCAN_LESS
00130         | SCAN_LESS_EQL
00131 ;
00132 
00133 %%
00134 
00135 <span class="keywordtype">void</span>
00136 <a class="code" href="gse_8y.html#a5">gse_error</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str)
00137 {
00138     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(
00139 <span class="stringliteral">"An expression passed to the grid() function could not be parsed.\n\</span>
00140 <span class="stringliteral">Exmples of expressions that will work are: \"i&gt;=10.0\" or \"23.6&lt;i&lt;56.0\"\n\</span>
00141 <span class="stringliteral">where \"i\" is the name of one of the Grid's map vectors."</span>);
00142 }
00143 
00144 <span class="keyword">static</span> <a class="code" href="GSEClause_8h.html#a16">relop</a>
00145 decode_relop(<span class="keywordtype">int</span> op)
00146 {
00147     <span class="keywordflow">switch</span> (op) {
00148       <span class="keywordflow">case</span> SCAN_GREATER:
00149     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a10">dods_greater_op</a>;
00150       <span class="keywordflow">case</span> SCAN_GREATER_EQL:
00151     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a11">dods_greater_equal_op</a>;
00152       <span class="keywordflow">case</span> SCAN_LESS:
00153     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a12">dods_less_op</a>;
00154       <span class="keywordflow">case</span> SCAN_LESS_EQL:
00155     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a13">dods_less_equal_op</a>;
00156       <span class="keywordflow">case</span> SCAN_EQUAL:
00157     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a14">dods_equal_op</a>;
00158       <span class="keywordflow">default</span>:
00159     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(malformed_expr, <span class="stringliteral">"Unrecognized relational operator"</span>);
00160     }
00161 }
00162 
00163 <span class="keyword">static</span> <a class="code" href="GSEClause_8h.html#a16">relop</a>
00164 decode_inverse_relop(<span class="keywordtype">int</span> op)
00165 {
00166     <span class="keywordflow">switch</span> (op) {
00167       <span class="keywordflow">case</span> SCAN_GREATER:
00168     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a12">dods_less_op</a>;
00169       <span class="keywordflow">case</span> SCAN_GREATER_EQL:
00170     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a13">dods_less_equal_op</a>;
00171       <span class="keywordflow">case</span> SCAN_LESS:
00172     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a10">dods_greater_op</a>;
00173       <span class="keywordflow">case</span> SCAN_LESS_EQL:
00174     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a11">dods_greater_equal_op</a>;
00175       <span class="keywordflow">case</span> SCAN_EQUAL:
00176     <span class="keywordflow">return</span> <a class="code" href="GSEClause_8h.html#a16a14">dods_equal_op</a>;
00177       <span class="keywordflow">default</span>:
00178     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(malformed_expr, <span class="stringliteral">"Unrecognized relational operator"</span>);
00179     }
00180 }
00181 
00182 <a class="code" href="classGSEClause.html">GSEClause</a> *
00183 <a class="code" href="gse_8y.html#a8">build_gse_clause</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <span class="keywordtype">char</span> id[ID_MAX], <span class="keywordtype">int</span> op, <span class="keywordtype">double</span> val)
00184 {
00185     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classGSEClause.html">GSEClause</a>(arg-&gt;<a class="code" href="structgse__arg.html#gse__arga6">get_grid</a>(), (string)id, val, decode_relop(op));
00186 }
00187 
00188 <span class="comment">// Build a GSE Clause given that the operands are reversed.</span>
00189 
00190 <a class="code" href="classGSEClause.html">GSEClause</a> *
00191 <a class="code" href="gse_8y.html#a9">build_rev_gse_clause</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <span class="keywordtype">char</span> id[ID_MAX], <span class="keywordtype">int</span> op, <span class="keywordtype">double</span> val)
00192 {
00193     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classGSEClause.html">GSEClause</a>(arg-&gt;<a class="code" href="structgse__arg.html#gse__arga6">get_grid</a>(), (string)id, val, 
00194              decode_inverse_relop(op));
00195 }
00196 
00197 <a class="code" href="classGSEClause.html">GSEClause</a> *
00198 <a class="code" href="gse_8y.html#a10">build_dual_gse_clause</a>(<a class="code" href="structgse__arg.html">gse_arg</a> *arg, <span class="keywordtype">char</span> id[ID_MAX], <span class="keywordtype">int</span> op1, <span class="keywordtype">double</span> val1, 
00199               <span class="keywordtype">int</span> op2, <span class="keywordtype">double</span> val2)
00200 {
00201     <span class="comment">// Check that the operands (op1 and op2) and the values (val1 and val2)</span>
00202     <span class="comment">// describe a monotonic interval.</span>
00203     <a class="code" href="GSEClause_8h.html#a16">relop</a> rop1 = decode_inverse_relop(op1);
00204     <a class="code" href="GSEClause_8h.html#a16">relop</a> rop2 = decode_relop(op2);
00205 
00206     <span class="keywordflow">switch</span> (rop1) {
00207       <span class="keywordflow">case</span> <a class="code" href="GSEClause_8h.html#a16a12">dods_less_op</a>:
00208       <span class="keywordflow">case</span> <a class="code" href="GSEClause_8h.html#a16a13">dods_less_equal_op</a>:
00209     <span class="keywordflow">if</span> (rop2 == <a class="code" href="GSEClause_8h.html#a16a12">dods_less_op</a> || rop2 == <a class="code" href="GSEClause_8h.html#a16a13">dods_less_equal_op</a>)
00210         <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(malformed_expr, 
00211 <span class="stringliteral">"GSE Clause operands must define a monotonic interval."</span>);
00212     <span class="keywordflow">break</span>;
00213       <span class="keywordflow">case</span> <a class="code" href="GSEClause_8h.html#a16a10">dods_greater_op</a>:
00214       <span class="keywordflow">case</span> <a class="code" href="GSEClause_8h.html#a16a11">dods_greater_equal_op</a>:
00215     <span class="keywordflow">if</span> (rop2 == <a class="code" href="GSEClause_8h.html#a16a10">dods_greater_op</a> || rop2 == <a class="code" href="GSEClause_8h.html#a16a11">dods_greater_equal_op</a>)
00216         <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(malformed_expr, 
00217 <span class="stringliteral">"GSE Clause operands must define a monotonic interval."</span>);
00218     <span class="keywordflow">break</span>;
00219       <span class="keywordflow">case</span> <a class="code" href="GSEClause_8h.html#a16a14">dods_equal_op</a>:
00220     <span class="keywordflow">break</span>;
00221       <span class="keywordflow">default</span>:
00222     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(malformed_expr, <span class="stringliteral">"Unrecognized relational operator."</span>);
00223     }
00224 
00225     <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classGSEClause.html">GSEClause</a>(arg-&gt;<a class="code" href="structgse__arg.html#gse__arga6">get_grid</a>(), (string)id, val1, rop1, val2, rop2);
00226 }
00227 
00228 <span class="comment">// $Log: gse_8y-source.html,v $
00228 <span class="comment">// Revision 1.2  2004/01/30 22:51:15  jimg
00228 <span class="comment">// Updated 2004/01/30.
00228 <span class="comment">//</span>
00229 <span class="comment">// Revision 1.10  2003/04/22 19:40:28  jimg</span>
00230 <span class="comment">// Merged with 3.3.1.</span>
00231 <span class="comment">//</span>
00232 <span class="comment">// Revision 1.8.2.2  2003/04/21 23:28:20  jimg</span>
00233 <span class="comment">// Updates to the grammar and configure files.</span>
00234 <span class="comment">//</span>
00235 <span class="comment">// Revision 1.9  2003/02/21 00:14:25  jimg</span>
00236 <span class="comment">// Repaired copyright.</span>
00237 <span class="comment">//</span>
00238 <span class="comment">// Revision 1.8.2.1  2003/02/21 00:10:08  jimg</span>
00239 <span class="comment">// Repaired copyright.</span>
00240 <span class="comment">//</span>
00241 <span class="comment">// Revision 1.8  2003/01/23 00:22:25  jimg</span>
00242 <span class="comment">// Updated the copyright notice; this implementation of the DAP is</span>
00243 <span class="comment">// copyrighted by OPeNDAP, Inc.</span>
00244 <span class="comment">//</span>
00245 <span class="comment">// Revision 1.7  2002/06/03 22:21:16  jimg</span>
00246 <span class="comment">// Merged with release-3-2-9</span>
00247 <span class="comment">//</span>
00248 <span class="comment">// Revision 1.5.4.2  2001/11/01 00:43:51  jimg</span>
00249 <span class="comment">// Fixes to the scanners and parsers so that dataset variable names may</span>
00250 <span class="comment">// start with digits. I've expanded the set of characters that may appear</span>
00251 <span class="comment">// in a variable name and made it so that all except `#' may appear at</span>
00252 <span class="comment">// the start. Some characters are not allowed in variables that appear in</span>
00253 <span class="comment">// a DDS or CE while they are allowed in the DAS. This makes it possible</span>
00254 <span class="comment">// to define containers with names like `COARDS:long_name.' Putting a colon</span>
00255 <span class="comment">// in a variable name makes the CE parser much more complex. Since the set</span>
00256 <span class="comment">// of characters that people want seems pretty limited (compared to the</span>
00257 <span class="comment">// complete ASCII set) I think this is an OK approach. If we have to open</span>
00258 <span class="comment">// up the expr.lex scanner completely, then we can but not without adding</span>
00259 <span class="comment">// lots of action clauses to teh parser. Note that colon is just an example,</span>
00260 <span class="comment">// there's a host of characters that are used in CEs that are not allowed</span>
00261 <span class="comment">// in IDs.</span>
00262 <span class="comment">//</span>
00263 <span class="comment">// Revision 1.6  2001/09/28 17:50:07  jimg</span>
00264 <span class="comment">// Merged with 3.2.7.</span>
00265 <span class="comment">//</span>
00266 <span class="comment">// Revision 1.5.4.1  2001/09/25 20:16:40  jimg</span>
00267 <span class="comment">// Fixed the EQUAL token. Added NOT_EQUAL.</span>
00268 <span class="comment">//</span>
00269 <span class="comment">// Revision 1.5  2000/09/22 02:17:23  jimg</span>
00270 <span class="comment">// Rearranged source files so that the CVS logs appear at the end rather than</span>
00271 <span class="comment">// the start. Also made the ifdef guard symbols use the same naming scheme and</span>
00272 <span class="comment">// wrapped headers included in other headers in those guard symbols (to cut</span>
00273 <span class="comment">// down on extraneous file processing - See Lakos).</span>
00274 <span class="comment">//</span>
00275 <span class="comment">// Revision 1.4  2000/07/09 21:43:30  rmorris</span>
00276 <span class="comment">// Mods to increase portability, minimize ifdef's for win32</span>
00277 <span class="comment">//</span>
00278 <span class="comment">// Revision 1.3  2000/06/07 18:07:01  jimg</span>
00279 <span class="comment">// Merged the pc port branch</span>
00280 <span class="comment">//</span>
00281 <span class="comment">// Revision 1.2.20.1  2000/06/02 18:39:04  rmorris</span>
00282 <span class="comment">// Mod's for port to win32.</span>
00283 <span class="comment">//</span>
00284 <span class="comment">// Revision 1.2  1999/04/29 02:29:37  jimg</span>
00285 <span class="comment">// Merge of no-gnu branch</span>
00286 <span class="comment">//</span>
00287 <span class="comment">// Revision 1.1  1999/01/21 02:07:44  jimg</span>
00288 <span class="comment">// Created</span>
00289 <span class="comment">//</span>
00290 
</pre></div><hr><address style="align: right;"><small>Generated on Tue Aug 19 12:42:02 2003 for OPeNDAP by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.18 </small></address>
</body>
</html>
