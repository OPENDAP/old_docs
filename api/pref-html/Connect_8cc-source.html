<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libdap++: Connect.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>Connect.cc</h1><a href="Connect_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2002,2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//         Dan Holloway &lt;dholloway@gso.uri.edu&gt;</span>
00010 <span class="comment">//         Reza Nekovei &lt;reza@intcomm.net&gt;</span>
00011 <span class="comment">//</span>
00012 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00013 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00014 <span class="comment">// License as published by the Free Software Foundation; either</span>
00015 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00016 <span class="comment">// </span>
00017 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00018 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00019 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00020 <span class="comment">// Lesser General Public License for more details.</span>
00021 <span class="comment">// </span>
00022 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00023 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00024 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00025 <span class="comment">//</span>
00026 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00027  
00028 <span class="comment">// (c) COPYRIGHT URI/MIT 1994-2002</span>
00029 <span class="comment">// Please read the full copyright statement in the file COPYRIGHT_URI.</span>
00030 <span class="comment">//</span>
00031 <span class="comment">// Authors:</span>
00032 <span class="comment">//      jhrg,jimg       James Gallagher &lt;jgallagher@gso.uri.edu&gt;</span>
00033 <span class="comment">//      dan             Dan Holloway &lt;dholloway@gso.uri.edu&gt;</span>
00034 <span class="comment">//      reza            Reza Nekovei &lt;reza@intcomm.net&gt;</span>
00035 
00036 <span class="preprocessor">#ifdef __GNUG__</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#pragma implementation</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00041 
00042 <span class="keyword">static</span> <span class="keywordtype">char</span> rcsid[] <a class="code" href="config__dap_8h.html#a49">not_used</a> =
00043     { <span class="stringliteral">"$Id$"</span> };
00044 
00045 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00046 <span class="preprocessor">#ifndef WIN32</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#include &lt;unistd.h&gt;</span>
00048 <span class="preprocessor">#endif</span>
00049 <span class="preprocessor"></span>
00050 <span class="preprocessor">#include &lt;fstream&gt;</span>
00051 
00052 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00053 <span class="preprocessor">#include "<a class="code" href="DataDDS_8h.html">DataDDS.h</a>"</span>
00054 <span class="preprocessor">#include "<a class="code" href="Connect_8h.html">Connect.h</a>"</span>
00055 <span class="preprocessor">#include "<a class="code" href="escaping_8h.html">escaping.h</a>"</span>
00056 <span class="preprocessor">#include "<a class="code" href="RCReader_8h.html">RCReader.h</a>"</span>
00057 
00058 <span class="keyword">using</span> std::cerr;
00059 <span class="keyword">using</span> std::endl;
00060 <span class="keyword">using</span> std::ifstream;
00061 <span class="keyword">using</span> std::ofstream;
00062 
00063 <span class="keyword">extern</span> <a class="code" href="ObjectType_8h.html#a6">ObjectType</a> <a class="code" href="HTTPConnect_8h.html#a0">get_type</a>(<span class="keyword">const</span> string &amp;value);
00064 
00067 <span class="keywordtype">void</span>
00068 Connect::process_data(<a class="code" href="classDataDDS.html">DataDDS</a> &amp;data, <a class="code" href="classResponse.html">Response</a> *rs) 
00069     <span class="keywordflow">throw</span>(<a class="code" href="classError.html">Error</a>, <a class="code" href="classInternalErr.html">InternalErr</a>)
00070 {
00071     data.set_version(rs-&gt;get_version());
00072 
00073     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Entring process_data: d_stream = "</span> &lt;&lt; rs &lt;&lt; endl);
00074     <span class="keywordflow">switch</span> (rs-&gt;get_type()) {
00075       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>:
00076     <span class="keywordflow">if</span> (!_error.parse(rs-&gt;get_stream()))
00077         <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__,
00078           <span class="stringliteral">"Could not parse the Error object returned by the server!"</span>);
00079     <span class="keywordflow">throw</span> _error;
00080 
00081       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a5">web_error</a>:
00082     <span class="comment">// Web errors (those reported in the return document's MIME header)</span>
00083     <span class="comment">// are processed by the WWW library.</span>
00084     <span class="keywordflow">return</span>;
00085 
00086       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a3">dods_data</a>: {
00087       <span class="comment">// Parse the DDS; throw an exception on error.</span>
00088       data.parse(rs-&gt;get_stream());
00089       XDR *xdr_stream = <a class="code" href="util_8cc.html#a4">new_xdrstdio</a>(rs-&gt;get_stream(), XDR_DECODE);
00090 
00091       <span class="comment">// Load the DDS with data.</span>
00092       <span class="keywordflow">try</span> {
00093           <span class="keywordflow">for</span> (<a class="code" href="classDDS.html#DDSw1">DDS::Vars_iter</a> i = data.var_begin(); i != data.var_end(); 
00094            i++) {
00095           (*i)-&gt;deserialize(xdr_stream, &amp;data);
00096           }
00097       }
00098       <span class="keywordflow">catch</span>(Error &amp;e) {
00099           <a class="code" href="util_8cc.html#a6">delete_xdrstdio</a>(xdr_stream);
00100           <span class="keywordflow">throw</span> e;
00101       }
00102 
00103       <a class="code" href="util_8cc.html#a6">delete_xdrstdio</a>(xdr_stream);
00104       <span class="keywordflow">return</span>;
00105       }
00106 
00107       <span class="keywordflow">default</span>:
00108     <span class="keywordflow">throw</span> Error(
00109 <span class="stringliteral">"The site did not return a valid response (it lacked the\n\</span>
00110 <span class="stringliteral">expected content description header value of 'dods_data').\n\</span>
00111 <span class="stringliteral">This may indicate that the server at the site is not correctly\n\</span>
00112 <span class="stringliteral">configured, or that the URL has changed."</span>);
00113     }
00114 }
00115 
00116 <span class="comment">// This function returns the ObjectType value that matches the given string.</span>
00117 <a class="code" href="ObjectType_8h.html#a6">ObjectType</a> 
<a name="l00118"></a><a class="code" href="Connect_8cc.html#a1">00118</a> <a class="code" href="HTTPConnect_8h.html#a0">get_type</a>(<span class="keyword">const</span> string &amp;value)
00119 {
00120     <span class="keywordflow">if</span> (value == <span class="stringliteral">"dods_das"</span>)
00121     <span class="keywordflow">return</span> <a class="code" href="ObjectType_8h.html#a6a1">dods_das</a>;
00122     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"dods_dds"</span>)
00123     <span class="keywordflow">return</span> <a class="code" href="ObjectType_8h.html#a6a2">dods_dds</a>;
00124     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"dods_data"</span>)
00125     <span class="keywordflow">return</span> <a class="code" href="ObjectType_8h.html#a6a3">dods_data</a>;
00126     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"dods_error"</span>)
00127     <span class="keywordflow">return</span> <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>;
00128     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value == <span class="stringliteral">"web_error"</span>)
00129     <span class="keywordflow">return</span> <a class="code" href="ObjectType_8h.html#a6a5">web_error</a>;
00130     <span class="keywordflow">else</span>
00131     <span class="keywordflow">return</span> <a class="code" href="ObjectType_8h.html#a6a0">unknown_type</a>;
00132 }
00133 
00134 <span class="comment">// Barely a parser... This is used when reading from local sources of DODS</span>
00135 <span class="comment">// Data objects. It simulates the important actions of the libwww MIME header</span>
00136 <span class="comment">// parser. Those actions fill in certain fields in the Connect object. jhrg</span>
00137 <span class="comment">// 5/20/97</span>
00138 <span class="comment">//</span>
00139 <span class="comment">// Make sure that this parser reads from data_source without disturbing the</span>
00140 <span class="comment">// information in data_source that follows the MIME header. Since the DDS</span>
00141 <span class="comment">// (which follows the MIME header) is parsed by a flex/bison scanner/parser,</span>
00142 <span class="comment">// make sure to use I/O calls that will mesh with ANSI C I/O calls. In the</span>
00143 <span class="comment">// old GNU libg++, the C++ calls were synchronized with the C calls, but that</span>
00144 <span class="comment">// may no longer be the case. 5/31/99 jhrg</span>
00145 
00150 <span class="keywordtype">void</span> 
00151 <a class="code" href="expr-test_8cc.html#a25">Connect::parse_mime</a>(FILE *data_source, <a class="code" href="classResponse.html">Response</a> *rs)
00152 {
00153     rs-&gt;<a class="code" href="classResponse.html#Responsez107_1">set_version</a>(<span class="stringliteral">"dods/0.0"</span>); <span class="comment">// initial value; for backward compat.</span>
00154 
00155     <span class="keywordtype">char</span> line[256];
00156     fgets(line, 255, data_source);
00157     line[strlen(line) - 1] = <span class="charliteral">'\0'</span>;  <span class="comment">// remove the newline</span>
00158 
00159     <span class="keywordflow">while</span> (line[0] != <span class="charliteral">'\0'</span>) {
00160     <span class="keywordtype">char</span> h[256], v[256];
00161     sscanf(line, <span class="stringliteral">"%s %s\n"</span>, h, v);
00162     string header = h;
00163     string value = v;
00164     <a class="code" href="util_8cc.html#a12">downcase</a>(header);
00165     <a class="code" href="util_8cc.html#a12">downcase</a>(value);
00166 
00167     <span class="keywordflow">if</span> (header == <span class="stringliteral">"content-description:"</span>) {
00168         <a class="code" href="debug_8h.html#a1">DBG</a>(cout &lt;&lt; header &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; value &lt;&lt; endl);
00169         rs-&gt;<a class="code" href="classResponse.html#Responsez107_0">set_type</a>(<a class="code" href="HTTPConnect_8h.html#a0">get_type</a>(value));
00170     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (header == <span class="stringliteral">"xdods-server:"</span>) {
00171         <a class="code" href="debug_8h.html#a1">DBG</a>(cout &lt;&lt; header &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; value &lt;&lt; endl);
00172         rs-&gt;<a class="code" href="classResponse.html#Responsez107_1">set_version</a>(value);
00173     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rs-&gt;<a class="code" href="classResponse.html#Responsez105_2">get_version</a>() == <span class="stringliteral">"dods/0.0"</span> &amp;&amp; header == <span class="stringliteral">"server:"</span>) {
00174         <a class="code" href="debug_8h.html#a1">DBG</a>(cout &lt;&lt; header &lt;&lt; <span class="stringliteral">": "</span> &lt;&lt; value &lt;&lt; endl);
00175         rs-&gt;<a class="code" href="classResponse.html#Responsez107_1">set_version</a>(value);
00176     }
00177 
00178     fgets(line, 255, data_source);
00179     line[strlen(line) - 1] = <span class="charliteral">'\0'</span>;
00180     }
00181 }
00182 
00183 <span class="comment">// public mfuncs</span>
00184 
<a name="l00192"></a><a class="code" href="classConnect.html#Connecta1">00192</a> <a class="code" href="classConnect.html#Connectz74_0">Connect::Connect</a>(<span class="keyword">const</span> string &amp;n, string uname, string password) 
00193     <span class="keywordflow">throw</span> (Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00194     : d_http(0), d_version(<span class="stringliteral">"unknown"</span>)
00195 {
00196     string name = <a class="code" href="util_8cc.html#a2">prune_spaces</a>(n);
00197     
00198     <span class="comment">// Figure out if the URL starts with 'http', if so, make sure that we</span>
00199     <span class="comment">// talk to an instance of HTTPConnect.</span>
00200     <span class="keywordflow">if</span> (name.find(<span class="stringliteral">"http"</span>) == 0) {
00201     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Connect: The identifier is an http URL"</span> &lt;&lt; endl);
00202     d_http = <span class="keyword">new</span> <a class="code" href="classHTTPConnect.html">HTTPConnect</a>(<a class="code" href="classRCReader.html#RCReadere0">RCReader::instance</a>());
00203 
00204     <span class="comment">// Find and store any CE given with the URL.</span>
00205     string::size_type dotpos = name.find(<span class="charliteral">'?'</span>);
00206     <span class="keywordflow">if</span> (dotpos != name.npos) {
00207         _URL = name.substr(0, dotpos);
00208         string expr = name.substr(dotpos + 1);
00209 
00210         dotpos = expr.find(<span class="charliteral">'&amp;'</span>);
00211         <span class="keywordflow">if</span> (dotpos != expr.npos) {
00212         _proj = expr.substr(0, dotpos);
00213         _sel = expr.substr(dotpos); <span class="comment">// XXX includes '&amp;'</span>
00214         } <span class="keywordflow">else</span> {
00215         _proj = expr;
00216         _sel = <span class="stringliteral">""</span>;
00217         }
00218     } <span class="keywordflow">else</span> {
00219         _URL = name;
00220         _proj = <span class="stringliteral">""</span>;
00221         _sel = <span class="stringliteral">""</span>;
00222     }
00223 
00224     _local = <span class="keyword">false</span>;
00225     } 
00226     <span class="keywordflow">else</span> {
00227     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Connect: The identifier is a local data source."</span> &lt;&lt; endl);
00228 
00229     d_http = 0;
00230     _URL = <span class="stringliteral">""</span>;
00231     _local = <span class="keyword">true</span>;      <span class="comment">// local in this case means non-DODS</span>
00232     }
00233 
00234     set_credentials(uname, password);
00235 }
00236 
<a name="l00254"></a><a class="code" href="classConnect.html#Connecta0">00254</a> <a class="code" href="classConnect.html#Connectz74_0">Connect::Connect</a>(<span class="keyword">const</span> string &amp;n, <span class="keywordtype">bool</span> www_verbose_errors, 
00255          <span class="keywordtype">bool</span> accept_deflate, string uname, string password) 
00256     <span class="keywordflow">throw</span> (Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00257     : d_http(0), d_version(<span class="stringliteral">"unknown"</span>)
00258 {
00259     string name = <a class="code" href="util_8cc.html#a2">prune_spaces</a>(n);
00260     
00261     <span class="comment">// Figure out if the URL starts with 'http', if so, make sure that we</span>
00262     <span class="comment">// talk to an instance of HTTPConnect.</span>
00263     <span class="keywordflow">if</span> (name.find(<span class="stringliteral">"http"</span>) == 0) {
00264     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Connect: The identifier is an http URL"</span> &lt;&lt; endl);
00265     d_http = <span class="keyword">new</span> <a class="code" href="classHTTPConnect.html">HTTPConnect</a>(<a class="code" href="classRCReader.html#RCReadere0">RCReader::instance</a>());
00266     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"Initialized d_http to: "</span> &lt;&lt; hex &lt;&lt; d_http &lt;&lt; dec &lt;&lt; endl);
00267 
00268     <span class="comment">// Find and store any CE given with the URL.</span>
00269     string::size_type dotpos = name.find(<span class="charliteral">'?'</span>);
00270     <span class="keywordflow">if</span> (dotpos != name.npos) {
00271         _URL = name.substr(0, dotpos);
00272         string expr = name.substr(dotpos + 1);
00273 
00274         dotpos = expr.find(<span class="charliteral">'&amp;'</span>);
00275         <span class="keywordflow">if</span> (dotpos != expr.npos) {
00276         _proj = expr.substr(0, dotpos);
00277         _sel = expr.substr(dotpos); <span class="comment">// XXX includes '&amp;'</span>
00278         } <span class="keywordflow">else</span> {
00279         _proj = expr;
00280         _sel = <span class="stringliteral">""</span>;
00281         }
00282     } <span class="keywordflow">else</span> {
00283         _URL = name;
00284         _proj = <span class="stringliteral">""</span>;
00285         _sel = <span class="stringliteral">""</span>;
00286     }
00287 
00288     _local = <span class="keyword">false</span>;
00289     } 
00290     <span class="keywordflow">else</span> {
00291     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Connect: The identifier is a local data source."</span> &lt;&lt; endl);
00292 
00293     d_http = 0;
00294     _URL = <span class="stringliteral">""</span>;
00295     _local = <span class="keyword">true</span>;      <span class="comment">// local in this case means non-DODS</span>
00296     }
00297 
00298     set_accept_deflate(accept_deflate);
00299 
00300     set_credentials(uname, password);
00301 }
00302 
<a name="l00303"></a><a class="code" href="classConnect.html#Connecta2">00303</a> <a class="code" href="classConnect.html#Connecta2">Connect::~Connect</a>()
00304 {
00305     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"Entering the Connect dtor"</span> &lt;&lt; endl);
00306 
00307     <span class="keywordflow">if</span> (d_http)
00308     <span class="keyword">delete</span> d_http;
00309 
00310     <a class="code" href="debug_8h.html#a3">DBG2</a>(cerr &lt;&lt; <span class="stringliteral">"Leaving the Connect dtor"</span> &lt;&lt; endl);
00311 }
00312 
00317 string
<a name="l00318"></a><a class="code" href="classConnect.html#Connecta11">00318</a> <a class="code" href="classConnect.html#Connecta11">Connect::request_version</a>() <span class="keywordflow">throw</span>(Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00319 {
00320     string version_url = _URL + <span class="stringliteral">".ver"</span>;
00321     <span class="keywordflow">if</span> (_proj.length() + _sel.length())
00322     version_url = version_url + <span class="stringliteral">"?"</span> + <a class="code" href="escaping_8cc.html#a6">id2www_ce</a>(_proj + _sel);
00323 
00324     <a class="code" href="classResponse.html">Response</a> *rs = 0;
00325     <span class="keywordflow">try</span> {
00326     rs = d_http-&gt;fetch_url(version_url);
00327     }
00328     <span class="keywordflow">catch</span> (Error &amp;e) {
00329     <span class="keyword">delete</span> rs;
00330     <span class="keywordflow">throw</span> e;
00331     }
00332 
00333     d_version = rs-&gt;<a class="code" href="classResponse.html#Responsez105_2">get_version</a>();
00334     <span class="keyword">delete</span> rs;
00335     <span class="keywordflow">return</span> d_version;
00336 }
00337 
00345 <span class="keywordtype">void</span>
<a name="l00346"></a><a class="code" href="classConnect.html#Connecta12">00346</a> <a class="code" href="classConnect.html#Connecta12">Connect::request_das</a>(<a class="code" href="classDAS.html">DAS</a> &amp;das) <span class="keywordflow">throw</span>(Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00347 {
00348     string das_url = _URL + <span class="stringliteral">".das"</span>;
00349     <span class="keywordflow">if</span> (_proj.length() + _sel.length())
00350     das_url = das_url + <span class="stringliteral">"?"</span> + <a class="code" href="escaping_8cc.html#a6">id2www_ce</a>(_proj + _sel);
00351 
00352     <a class="code" href="classResponse.html">Response</a> *rs = 0;
00353     <span class="keywordflow">try</span> {
00354     rs = d_http-&gt;fetch_url(das_url);
00355     }
00356     <span class="keywordflow">catch</span> (Error &amp;e) {
00357     <span class="keyword">delete</span> rs;
00358     <span class="keywordflow">throw</span> e;
00359     }
00360 
00361     d_version = rs-&gt;<a class="code" href="classResponse.html#Responsez105_2">get_version</a>(); <span class="comment">// Improve this design!</span>
00362 
00363     <span class="keywordflow">switch</span> (rs-&gt;<a class="code" href="classResponse.html#Responsez105_1">get_type</a>()) {
00364       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>: {
00365       <span class="keywordflow">if</span> (!_error.parse(rs-&gt;<a class="code" href="classResponse.html#Responsez105_0">get_stream</a>())) {
00366           <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__, 
00367             <span class="stringliteral">"Could not parse error returned from server."</span>);
00368           <span class="keywordflow">break</span>;
00369       }
00370       <span class="keywordflow">throw</span> _error;
00371       <span class="keywordflow">break</span>;
00372       }
00373 
00374       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a5">web_error</a>:
00375     <span class="comment">// We should never get here; a web error should be picked up read_url</span>
00376     <span class="comment">// (called by fetch_url) and result in a thrown Error object.</span>
00377     <span class="keywordflow">break</span>;
00378 
00379       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a1">dods_das</a>:
00380     <span class="comment">// DAS::parse throws an exception on error.</span>
00381     <span class="keywordflow">try</span> {
00382         das.parse(rs-&gt;<a class="code" href="classResponse.html#Responsez105_0">get_stream</a>()); <span class="comment">// read and parse the das from a file </span>
00383     }
00384     <span class="keywordflow">catch</span> (Error &amp;e) {
00385         <span class="keyword">delete</span> rs;
00386         <span class="keywordflow">throw</span> e;
00387     }
00388         
00389     <span class="keywordflow">break</span>;
00390 
00391       <span class="keywordflow">default</span>:
00392     <span class="keywordflow">throw</span> Error(
00393 <span class="stringliteral">"The site did not return a valid response (it lacked the\n\</span>
00394 <span class="stringliteral">expected content description header value of 'dods_das').\n\</span>
00395 <span class="stringliteral">This may indicate that the server at the site is not correctly\n\</span>
00396 <span class="stringliteral">configured, or that the URL has changed."</span>);
00397     }
00398 
00399     <span class="keyword">delete</span> rs;
00400 }
00401 
00409 <span class="keywordtype">void</span>
<a name="l00410"></a><a class="code" href="classConnect.html#Connecta13">00410</a> <a class="code" href="classConnect.html#Connecta13">Connect::request_dds</a>(<a class="code" href="classDDS.html">DDS</a> &amp;dds, string expr) <span class="keywordflow">throw</span>(Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00411 {
00412     string proj, sel;
00413     string::size_type dotpos = expr.find(<span class="charliteral">'&amp;'</span>);
00414     <span class="keywordflow">if</span> (dotpos != expr.npos) {
00415     proj = expr.substr(0, dotpos);
00416     sel = expr.substr(dotpos);
00417     } <span class="keywordflow">else</span> {
00418     proj = expr;
00419     sel = <span class="stringliteral">""</span>;
00420     }
00421 
00422     string dds_url = _URL + <span class="stringliteral">".dds"</span> + <span class="stringliteral">"?"</span> 
00423     + <a class="code" href="escaping_8cc.html#a6">id2www_ce</a>(_proj + proj + _sel + sel);
00424 
00425     <a class="code" href="classResponse.html">Response</a> *rs = 0;
00426     <span class="keywordflow">try</span> {
00427     rs = d_http-&gt;fetch_url(dds_url);
00428     }
00429     <span class="keywordflow">catch</span> (Error &amp;e) {
00430     <span class="keyword">delete</span> rs;
00431     <span class="keywordflow">throw</span> e;
00432     }
00433 
00434     d_version = rs-&gt;<a class="code" href="classResponse.html#Responsez105_2">get_version</a>(); <span class="comment">// Improve this design!</span>
00435 
00436     <span class="keywordflow">switch</span> (rs-&gt;<a class="code" href="classResponse.html#Responsez105_1">get_type</a>()) {
00437       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>: {
00438       <span class="keywordflow">if</span> (!_error.parse(rs-&gt;<a class="code" href="classResponse.html#Responsez105_0">get_stream</a>())) {
00439           <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__, 
00440             <span class="stringliteral">"Could not parse error returned from server."</span>);
00441           <span class="keywordflow">break</span>;
00442       }
00443       <span class="keywordflow">throw</span> _error;
00444       <span class="keywordflow">break</span>;
00445       }
00446 
00447       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a5">web_error</a>:
00448     <span class="comment">// We should never get here; a web error should be picked up read_url</span>
00449     <span class="comment">// (called by fetch_url) and result in a thrown Error object.</span>
00450     <span class="keywordflow">break</span>;
00451 
00452       <span class="keywordflow">case</span> <a class="code" href="ObjectType_8h.html#a6a2">dods_dds</a>:
00453     <span class="comment">// DDS::prase throws an exception on error.</span>
00454     <span class="keywordflow">try</span> {
00455         dds.parse(rs-&gt;<a class="code" href="classResponse.html#Responsez105_0">get_stream</a>()); <span class="comment">// read and parse the dds from a file </span>
00456     }
00457     <span class="keywordflow">catch</span> (Error &amp;e) {
00458         <span class="keyword">delete</span> rs;
00459         <span class="keywordflow">throw</span> e;
00460     }
00461     <span class="keywordflow">break</span>;
00462 
00463       <span class="keywordflow">default</span>:
00464     <span class="keywordflow">throw</span> Error(
00465 <span class="stringliteral">"The site did not return a valid response (it lacked the\n\</span>
00466 <span class="stringliteral">expected content description header value of 'dods_dds').\n\</span>
00467 <span class="stringliteral">This may indicate that the server at the site is not correctly\n\</span>
00468 <span class="stringliteral">configured, or that the URL has changed."</span>);
00469     }
00470 
00471     <span class="keyword">delete</span> rs;
00472 }
00473 
00483 <span class="keywordtype">void</span>
<a name="l00484"></a><a class="code" href="classConnect.html#Connecta14">00484</a> <a class="code" href="classConnect.html#Connecta14">Connect::request_data</a>(<a class="code" href="classDataDDS.html">DataDDS</a> &amp;data, string expr) <span class="keywordflow">throw</span>(Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00485 {
00486     string proj, sel;
00487     string::size_type dotpos = expr.find(<span class="charliteral">'&amp;'</span>);
00488     <span class="keywordflow">if</span> (dotpos != expr.npos) {
00489     proj = expr.substr(0, dotpos);
00490     sel = expr.substr(dotpos);
00491     } <span class="keywordflow">else</span> {
00492     proj = expr;
00493     sel = <span class="stringliteral">""</span>;
00494     }
00495 
00496     string data_url = _URL + <span class="stringliteral">".dods?"</span> 
00497     + <a class="code" href="escaping_8cc.html#a6">id2www_ce</a>(_proj + proj + _sel + sel);
00498 
00499     <a class="code" href="classResponse.html">Response</a> *rs = 0;
00500     <span class="comment">// We need to catch Error exceptions to ensure calling close_output.</span>
00501     <span class="keywordflow">try</span> {
00502     rs = d_http-&gt;fetch_url(data_url);
00503     d_version = rs-&gt;<a class="code" href="classResponse.html#Responsez105_2">get_version</a>(); <span class="comment">// Improve this design!</span>
00504 
00505     process_data(data, rs);
00506     <span class="keyword">delete</span> rs;
00507     }
00508     <span class="keywordflow">catch</span> (Error &amp;e) {
00509     <span class="keyword">delete</span> rs;
00510     <span class="keywordflow">throw</span> e;
00511     }
00512 }
00513 
00520 <span class="keywordtype">void</span>
<a name="l00521"></a><a class="code" href="classConnect.html#Connecta15">00521</a> <a class="code" href="classConnect.html#Connecta15">Connect::read_data</a>(<a class="code" href="classDataDDS.html">DataDDS</a> &amp;data, FILE *data_source) <span class="keywordflow">throw</span>(Error, <a class="code" href="classInternalErr.html">InternalErr</a>)
00522 {
00523     <span class="keywordflow">if</span> (!data_source) 
00524     <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__, <span class="stringliteral">"data_source is null."</span>);
00525 
00526     <a class="code" href="classResponse.html">Response</a> *rs = 0;
00527 
00528     <span class="keywordflow">try</span> {
00529     rs = <span class="keyword">new</span> <a class="code" href="classResponse.html">Response</a>(data_source);
00530     <span class="comment">// Read from data_source and parse the MIME headers specific to DODS.</span>
00531     <a class="code" href="expr-test_8cc.html#a25">parse_mime</a>(data_source, rs);
00532     
00533     process_data(data, rs);
00534 
00535     <span class="keyword">delete</span> rs;
00536     }
00537     <span class="keywordflow">catch</span> (Error &amp;e) {
00538     <span class="keyword">delete</span> rs;
00539     <span class="keywordflow">throw</span> e;
00540     }
00541 }
00542 
00543 <span class="keywordtype">bool</span> 
<a name="l00544"></a><a class="code" href="classConnect.html#Connecta3">00544</a> <a class="code" href="classConnect.html#Connecta3">Connect::is_local</a>()
00545 {
00546     <span class="keywordflow">return</span> _local;
00547 }
00548 
00565 string 
<a name="l00566"></a><a class="code" href="classConnect.html#Connecta4">00566</a> <a class="code" href="classConnect.html#Connecta4">Connect::URL</a>(<span class="keywordtype">bool</span> ce)
00567 {
00568     <span class="keywordflow">if</span> (_local)
00569     <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__, 
00570           <span class="stringliteral">"URL(): This call is only valid for a DODS data source."</span>);
00571 
00572     <span class="keywordflow">if</span> (ce)
00573     <span class="keywordflow">return</span> _URL + <span class="stringliteral">"?"</span> + _proj + _sel;
00574     <span class="keywordflow">else</span>
00575     <span class="keywordflow">return</span> _URL;
00576 }
00577 
00586 string 
<a name="l00587"></a><a class="code" href="classConnect.html#Connecta5">00587</a> <a class="code" href="classConnect.html#Connecta5">Connect::CE</a>()
00588 {
00589     <span class="keywordflow">if</span> (_local)
00590     <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__, 
00591           <span class="stringliteral">"CE(): This call is only valid for a DODS data source."</span>);
00592 
00593     <span class="keywordflow">return</span> _proj + _sel;
00594 }
00595 
00601 <span class="keywordtype">void</span> 
<a name="l00602"></a><a class="code" href="classConnect.html#Connecta6">00602</a> <a class="code" href="classConnect.html#Connecta6">Connect::set_credentials</a>(string u, string p)
00603 {
00604     <span class="keywordflow">if</span> (d_http)
00605     d_http-&gt;<a class="code" href="classHTTPConnect.html#HTTPConnecta2">set_credentials</a>(u, p);
00606 }
00607 
00611 <span class="keywordtype">void</span> 
<a name="l00612"></a><a class="code" href="classConnect.html#Connecta7">00612</a> <a class="code" href="classConnect.html#Connecta7">Connect::set_accept_deflate</a>(<span class="keywordtype">bool</span> deflate)
00613 {
00614     <span class="keywordflow">if</span> (d_http)
00615     d_http-&gt;<a class="code" href="classHTTPConnect.html#HTTPConnecta3">set_accept_deflate</a>(<a class="code" href="EncodingType_8h.html#a3a1">deflate</a>);
00616 }
00617 
00621 <span class="keywordtype">void</span>
<a name="l00622"></a><a class="code" href="classConnect.html#Connecta8">00622</a> <a class="code" href="classConnect.html#Connecta8">Connect::set_cache_enabled</a>(<span class="keywordtype">bool</span> cache)
00623 {
00624     <span class="keywordflow">if</span> (d_http)
00625     d_http-&gt;<a class="code" href="classHTTPConnect.html#HTTPConnecta4">set_cache_enabled</a>(cache);
00626 }
00627 
00628 <span class="keywordtype">bool</span>
<a name="l00629"></a><a class="code" href="classConnect.html#Connecta9">00629</a> <a class="code" href="classConnect.html#Connecta9">Connect::is_cache_enabled</a>()
00630 {
00631     <span class="keywordtype">bool</span> status;
00632     <a class="code" href="debug_8h.html#a1">DBG</a>(cerr &lt;&lt; <span class="stringliteral">"Entering is_cache_enabled ("</span> &lt;&lt; hex &lt;&lt; d_http &lt;&lt; dec 
00633     &lt;&lt; <span class="stringliteral">")... "</span>);
00634     <span class="keywordflow">if</span> (d_http)
00635     status = d_http-&gt;<a class="code" href="classHTTPConnect.html#HTTPConnecta5">is_cache_enabled</a>();
00636     <span class="keywordflow">else</span>
00637     status = <span class="keyword">false</span>;
00638     <a class="code" href="debug_8h.html#a2">DBGN</a>(cerr &lt;&lt; <span class="stringliteral">"exiting"</span> &lt;&lt; endl);
00639     <span class="keywordflow">return</span> status;
00640 }
00641 
00657 <a class="code" href="classDAS.html">DAS</a> &amp; 
<a name="l00658"></a><a class="code" href="classConnect.html#Connectz15_0">00658</a> <a class="code" href="classConnect.html#Connectz15_0">Connect::das</a>()
00659 {
00660     <span class="keywordflow">if</span> (_local)
00661     <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__,
00662               <span class="stringliteral">"Cannot access DAS for a non-DODS data source."</span>);
00663 
00664     <span class="keywordflow">return</span> _das;
00665 }
00666 
00678 <a class="code" href="classDDS.html">DDS</a> &amp; 
<a name="l00679"></a><a class="code" href="classConnect.html#Connectz15_1">00679</a> <a class="code" href="classConnect.html#Connectz15_1">Connect::dds</a>()
00680 {
00681     <span class="keywordflow">if</span> (_local)
00682     <span class="keywordflow">throw</span> <a class="code" href="classInternalErr.html">InternalErr</a>(__FILE__, __LINE__,
00683               <span class="stringliteral">"Cannot access DDS for a non-DODS data source."</span>);
00684 
00685     <span class="keywordflow">return</span> _dds;
00686 }
00687 
00704 Error &amp; 
<a name="l00705"></a><a class="code" href="classConnect.html#Connectz15_2">00705</a> <a class="code" href="classConnect.html#Connectz15_2">Connect::error</a>()
00706 {
00707     <span class="keywordflow">return</span> _error;
00708 }
00710 
00711 <span class="comment">// $Log: Connect_8cc-source.html,v $
00711 <span class="comment">// Revision 1.4  2004/02/05 06:51:15  jimg
00711 <span class="comment">// Added/update.
00711 <span class="comment">//</span>
00712 <span class="comment">// Revision 1.128.2.6  2004/01/28 20:39:17  jimg</span>
00713 <span class="comment">// I changed the error messages returned when a valid Content-Description</span>
00714 <span class="comment">// header is not returned to make it more obvious that's the problem. This</span>
00715 <span class="comment">// adresses (at least in part) a problem reported by Kevin O'Brien</span>
00716 <span class="comment">// regarding Benno's server at LDEO.</span>
00717 <span class="comment">//</span>
00718 <span class="comment">// Revision 1.128.2.5  2003/11/19 18:51:39  jimg</span>
00719 <span class="comment">// Added request_version(). Gets the server's version information without</span>
00720 <span class="comment">// getting anything else.</span>
00721 <span class="comment">//</span>
00722 <span class="comment">// Revision 1.128.2.4  2003/10/03 16:20:24  jimg</span>
00723 <span class="comment">// This class now throws an exception when a response is received that does not</span>
00724 <span class="comment">// contain a Content-Description header indicating the response is from a dods</span>
00725 <span class="comment">// server.</span>
00726 <span class="comment">//</span>
00727 <span class="comment">// Revision 1.128.2.3  2003/09/06 22:37:50  jimg</span>
00728 <span class="comment">// Updated the documentation.</span>
00729 <span class="comment">//</span>
00730 <span class="comment">// Revision 1.128.2.2  2003/06/05 20:15:25  jimg</span>
00731 <span class="comment">// Removed many uses of strstream and replaced them with stringstream.</span>
00732 <span class="comment">//</span>
00733 <span class="comment">// Revision 1.128.2.1  2003/05/06 22:06:42  jimg</span>
00734 <span class="comment">// I added a new constructor to Connect and deprecated the old ctor. The</span>
00735 <span class="comment">// old ctor was forcing compression to be on, ignoring the value of DEFLATE</span>
00736 <span class="comment">// in the .dodsrc file. This was left over behavior from before we started</span>
00737 <span class="comment">// using that file. However, now HTTPConnect (and later other protocol</span>
00738 <span class="comment">// modules?) look at the value in the .dodsrc (using RCReader) and decide</span>
00739 <span class="comment">// what action to take.</span>
00740 <span class="comment">//</span>
00741 <span class="comment">// Revision 1.128  2003/05/01 23:40:21  jimg</span>
00742 <span class="comment">// Changed catch(...) statements to ones which explicitly declare the types of</span>
00743 <span class="comment">// exceptions (all Error, I think). If these catch clauses re-throw the</span>
00744 <span class="comment">// exceptions ad the method declares its exceptions, the (...) causes an</span>
00745 <span class="comment">// immediate call to abort().</span>
00746 <span class="comment">//</span>
00747 <span class="comment">// Revision 1.127  2003/04/22 19:40:27  jimg</span>
00748 <span class="comment">// Merged with 3.3.1.</span>
00749 <span class="comment">//</span>
00750 <span class="comment">// Revision 1.126  2003/03/14 00:01:00  jimg</span>
00751 <span class="comment">// Added DBG statements to is_cache_enabled(). This helped find a bug that</span>
00752 <span class="comment">// defied the debugger...</span>
00753 <span class="comment">//</span>
00754 <span class="comment">// Revision 1.125  2003/03/04 21:45:17  jimg</span>
00755 <span class="comment">// Removed code in #if 0 ... #endif. Added get_version(). Fixed constructor</span>
00756 <span class="comment">// documentation.</span>
00757 <span class="comment">//</span>
00758 <span class="comment">// Revision 1.124  2003/03/04 17:54:52  jimg</span>
00759 <span class="comment">// Removed many old methods (methods that were used with libwww). Switched to</span>
00760 <span class="comment">// the new Response objects.</span>
00761 <span class="comment">//</span>
00762 <span class="comment">// Revision 1.123  2003/02/27 23:22:30  jimg</span>
00763 <span class="comment">// Removed old code (code inside #if 0 ... #endif) and added a call to</span>
00764 <span class="comment">// HTTPConnect::set_credentials() and set_accept_deflate() in the constructor.</span>
00765 <span class="comment">//</span>
00766 <span class="comment">// Revision 1.122  2003/02/26 06:39:13  jimg</span>
00767 <span class="comment">// Fixed documentation comments.</span>
00768 <span class="comment">//</span>
00769 <span class="comment">// Revision 1.121  2003/02/21 00:14:24  jimg</span>
00770 <span class="comment">// Repaired copyright.</span>
00771 <span class="comment">//</span>
00772 <span class="comment">// Revision 1.120.2.1  2003/02/21 00:10:07  jimg</span>
00773 <span class="comment">// Repaired copyright.</span>
00774 <span class="comment">//</span>
00775 <span class="comment">// Revision 1.120  2003/01/23 00:22:23  jimg</span>
00776 <span class="comment">// Updated the copyright notice; this implementation of the DAP is</span>
00777 <span class="comment">// copyrighted by OPeNDAP, Inc.</span>
00778 <span class="comment">//</span>
00779 <span class="comment">// Revision 1.119  2003/01/10 19:46:39  jimg</span>
00780 <span class="comment">// Merged with code tagged release-3-2-10 on the release-3-2 branch. In many</span>
00781 <span class="comment">// cases files were added on that branch (so they appear on the trunk for</span>
00782 <span class="comment">// the first time).</span>
00783 <span class="comment">//</span>
00784 <span class="comment">// Revision 1.1  1994/10/05  18:02:06  jimg</span>
00785 <span class="comment">// First version of the connection management classes.</span>
00786 <span class="comment">// This commit also includes early versions of the test code.</span>
00787 <span class="comment">// Revision 1.105.2.41  2002/12/24 00:14:53  jimg</span>
00788 <span class="comment">// Changed the output() method so that it works with the new changes to</span>
00789 <span class="comment">// HTTPConnect.</span>
00790 <span class="comment">// Made output(), close_output(), source() and close_source() private. These</span>
00791 <span class="comment">// four methods made up a deprecated interface to data. All data accessed using</span>
00792 <span class="comment">// this class is now read directly from a returned DataDDS instance.</span>
00793 <span class="comment">//</span>
00794 <span class="comment">// Revision 1.105.2.40  2002/12/17 22:35:02  pwest</span>
00795 <span class="comment">// Added and updated methods using stdio. Deprecated methods using iostream.</span>
00796 <span class="comment">//</span>
00797 <span class="comment">// Revision 1.105.2.39  2002/12/05 20:36:19  pwest</span>
00798 <span class="comment">// Corrected problems with IteratorAdapter code, making methods non-inline,</span>
00799 <span class="comment">// creating source files and template instantiation file. Cleaned up file</span>
00800 <span class="comment">// descriptors and memory management problems. Corrected problem in Connect</span>
00801 <span class="comment">// where the xdr source was not being cleaned up or a new one created when a</span>
00802 <span class="comment">// new file was opened for reading.</span>
00803 <span class="comment">//</span>
00804 <span class="comment">// Revision 1.105.2.38  2002/11/21 21:24:17  pwest</span>
00805 <span class="comment">// memory leak cleanup and file descriptor cleanup</span>
00806 <span class="comment">//</span>
00807 <span class="comment">// Revision 1.105.2.37  2002/10/28 21:17:43  pwest</span>
00808 <span class="comment">// Converted all return values and method parameters to use non-const iterator.</span>
00809 <span class="comment">// Added operator== and operator!= methods to IteratorAdapter to handle Pix</span>
00810 <span class="comment">// problems.</span>
00811 <span class="comment">//</span>
00812 <span class="comment">// Revision 1.105.2.36  2002/09/05 22:52:54  pwest</span>
00813 <span class="comment">// Replaced the GNU data structures SLList and DLList with the STL container</span>
00814 <span class="comment">// class vector&lt;&gt;. To maintain use of Pix, changed the Pix.h header file to</span>
00815 <span class="comment">// redefine Pix to be an IteratorAdapter. Usage remains the same and all code</span>
00816 <span class="comment">// outside of the DAP should compile and link with no problems. Added methods</span>
00817 <span class="comment">// to the different classes where Pix is used to include methods to use STL</span>
00818 <span class="comment">// iterators. Replaced the use of Pix within the DAP to use iterators instead.</span>
00819 <span class="comment">// Updated comments for documentation, updated the test suites, and added some</span>
00820 <span class="comment">// unit tests. Updated the Makefile to remove GNU/SLList and GNU/DLList.</span>
00821 <span class="comment">//</span>
00822 <span class="comment">// Revision 1.105.2.35  2002/08/22 21:23:23  jimg</span>
00823 <span class="comment">// Fixes for the Win32 Build made at ESRI by Vlad Plenchoy and myslef.</span>
00824 <span class="comment">//</span>
00825 <span class="comment">// Revision 1.105.2.34  2002/08/08 06:54:56  jimg</span>
00826 <span class="comment">// Changes for thread-safety. In many cases I found ugly places at the</span>
00827 <span class="comment">// tops of files while looking for globals, et c., and I fixed them up</span>
00828 <span class="comment">// (hopefully making them easier to read, ...). Only the files RCReader.cc</span>
00829 <span class="comment">// and usage.cc actually use pthreads synchronization functions. In other</span>
00830 <span class="comment">// cases I removed static objects where they were used for supposed</span>
00831 <span class="comment">// improvements in efficiency which had never actually been verifiied (and</span>
00832 <span class="comment">// which looked dubious).</span>
00833 <span class="comment">//</span>
00834 <span class="comment">// Revision 1.105.2.33  2002/07/06 19:33:34  jimg</span>
00835 <span class="comment">// I fixed some of the access functions that provide information that servers</span>
00836 <span class="comment">// send in the headers of a response. If we're accessing a local response (a</span>
00837 <span class="comment">// DataDDS dumped to a file or read from stdin) the behavior of HTTP is</span>
00838 <span class="comment">// simulated (something that we should change but can stay for now). In some</span>
00839 <span class="comment">// cases it was possible for a client of Connect to ask the HTTPConnect object</span>
00840 <span class="comment">// for information when that object had not been initialized because the data</span>
00841 <span class="comment">// source was a local file. The implementation of Connect still needs work...</span>
00842 <span class="comment">//</span>
00843 <span class="comment">// Revision 1.105.2.32  2002/06/21 22:23:29  jimg</span>
00844 <span class="comment">// I revised the basic interface to this class. The old interface is implemented</span>
00845 <span class="comment">// using the new one. Methods to get objects from DODS objects now take</span>
00846 <span class="comment">// references to the containers for those objects as formal parameters. This</span>
00847 <span class="comment">// enables a user of Connect to control how/when/where those containers are</span>
00848 <span class="comment">// created and managed.</span>
00849 <span class="comment">//</span>
00850 <span class="comment">// Revision 1.105.2.31  2002/06/21 00:12:51  jimg</span>
00851 <span class="comment">// Added a new request_dds() method that takes a reference to a DDS and dumps</span>
00852 <span class="comment">// the retrieved info into it instead of the DDS that's held locally by this</span>
00853 <span class="comment">// class. This is a much more flexible approach to reading responses. I also</span>
00854 <span class="comment">// reimplemented the older version of request_dds using the new method (easy</span>
00855 <span class="comment">// since the GUI stuff is disabled).</span>
00856 <span class="comment">//</span>
00857 <span class="comment">// Revision 1.105.2.30  2002/06/20 06:21:27  jimg</span>
00858 <span class="comment">// Fixed local access. For now access to OPENDAP objects stored in local files</span>
00859 <span class="comment">// uses a local FILE *. Methods test _local to determine whether to use the</span>
00860 <span class="comment">// HTTPConnect object or the local FILE *.</span>
00861 <span class="comment">//</span>
00862 <span class="comment">// Revision 1.105.2.29  2002/06/20 03:18:48  jimg</span>
00863 <span class="comment">// Fixes and modifications to the Connect and HTTPConnect classes. Neither</span>
00864 <span class="comment">// of these two classes is complete, but they should compile and their</span>
00865 <span class="comment">// basic functions should work.</span>
00866 <span class="comment">//</span>
00867 <span class="comment">// Revision 1.105.2.28  2002/06/18 23:03:43  jimg</span>
00868 <span class="comment">// Added extern declaration of ObjectType get_type(...).</span>
00869 <span class="comment">//</span>
00870 <span class="comment">// Revision 1.118  2002/06/18 15:36:24  tom</span>
00871 <span class="comment">// Moved comments and edited to accommodate doxygen documentation-generator.</span>
00872 <span class="comment">//</span>
00873 <span class="comment">// Revision 1.117  2002/06/03 22:21:15  jimg</span>
00874 <span class="comment">// Merged with release-3-2-9</span>
00875 <span class="comment">//</span>
00876 <span class="comment">// Revision 1.105.2.23  2002/04/29 04:31:51  rmorris</span>
00877 <span class="comment">// Considerable patching to make win32 client-side caching work.  We need</span>
00878 <span class="comment">// to document that .dodsrc cannot use backslashes in filenames, must use</span>
00879 <span class="comment">// forward slash.  Also need to document that pointing env vars for caching</span>
00880 <span class="comment">// to places with spaces in the directory name is a no-no.</span>
00881 <span class="comment">//</span>
00882 <span class="comment">// Revision 1.105.2.22  2002/04/27 22:51:44  rmorris</span>
00883 <span class="comment">// Change to turn client-side caching on under win32.  This is still a</span>
00884 <span class="comment">// hack around the "spaces in directory names" problem.  For now we are</span>
00885 <span class="comment">// going to hardcode the cache to be in C:\TEMP\DODS, as the user-specific</span>
00886 <span class="comment">// directories are going to have spaces in them.  There is a porential</span>
00887 <span class="comment">// small, subtle problem if more than one dods user was active at the</span>
00888 <span class="comment">// same time on a win32 box (unlikely).</span>
00889 <span class="comment">//</span>
00890 <span class="comment">// Revision 1.105.2.21  2002/04/02 18:36:17  jimg</span>
00891 <span class="comment">// Fixed a bug (#416) in server_handler(). If a server sent a response that</span>
00892 <span class="comment">// included the Server header *after* it included the XDODS-Server header, the</span>
00893 <span class="comment">// value of Server was used in preference to XDODS-Server. This broke reading</span>
00894 <span class="comment">// Sequences since clients thought they were talking to an old server.</span>
00895 <span class="comment">//</span>
00896 <span class="comment">// Revision 1.105.2.20  2002/02/04 00:19:36  rmorris</span>
00897 <span class="comment">// Ported an occurance of "mkstemp" in fetch_url to use something compatible]</span>
00898 <span class="comment">// with VC++.  There is no mkstemp in win32.</span>
00899 <span class="comment">//</span>
00900 <span class="comment">// Revision 1.105.2.19  2002/01/30 18:59:55  jimg</span>
00901 <span class="comment">// I changed request_das, _dds and _data so that they take into account various</span>
00902 <span class="comment">// exceptions that may be thrown by the DAS and DDS parsers as well as</span>
00903 <span class="comment">// fetch_url. Now each of these methods catch *any* exception, close up the</span>
00904 <span class="comment">// output stream if its open and popdown the progress indicator if its up. Then</span>
00905 <span class="comment">// the exception is thrown further up the call chain.</span>
00906 <span class="comment">// I also removed an explicit catch of InternalErr in request_data which was</span>
00907 <span class="comment">// adding some more text (useless and goofy looking) to the exception and re</span>
00908 <span class="comment">// throwing it. Now the text is not added.</span>
00909 <span class="comment">// I also made read_data() (the somewhat broken method for reading from files)</span>
00910 <span class="comment">// catch (...) and close the output stream and progress indicator.</span>
00911 <span class="comment">//</span>
00912 <span class="comment">// Revision 1.105.2.18  2002/01/28 20:34:25  jimg</span>
00913 <span class="comment">// *** empty log message ***</span>
00914 <span class="comment">//</span>
00915 <span class="comment">// Revision 1.105.2.17  2002/01/17 00:42:02  jimg</span>
00916 <span class="comment">// I added a new method to disable use of the cache. This provides a way</span>
00917 <span class="comment">// for a client to suppress use of the cache even if the user wants it</span>
00918 <span class="comment">// (or doesn't say they don't want it).</span>
00919 <span class="comment">//</span>
00920 <span class="comment">// Revision 1.105.2.16  2001/10/30 06:55:45  rmorris</span>
00921 <span class="comment">// Win32 porting changes.  Brings core win32 port up-to-date.</span>
00922 <span class="comment">//</span>
00923 <span class="comment">// Revision 1.116  2001/10/29 21:24:39  jimg</span>
00924 <span class="comment">// Removed catch and display of Error objects thrown/returned when accessing</span>
00925 <span class="comment">// data. These Error objects must now be caught by the code that uses</span>
00926 <span class="comment">// libdap++.a.</span>
00927 <span class="comment">//</span>
00928 <span class="comment">// Revision 1.115  2001/10/25 21:23:23  jgarcia</span>
00929 <span class="comment">// Modified the www_lib_init method so now it uses the class RCReader. This simplifies a lot the implementation of this class.</span>
00930 <span class="comment">//</span>
00931 <span class="comment">// Revision 1.114  2001/10/14 01:28:38  jimg</span>
00932 <span class="comment">// Merged with release-3-2-8.</span>
00933 <span class="comment">//</span>
00934 <span class="comment">// Revision 1.105.2.15  2001/10/08 17:19:31  jimg</span>
00935 <span class="comment">// Changed error handling scheme; this class never catches an Error object to</span>
00936 <span class="comment">// display it. It catches some to add information. It always relies on the</span>
00937 <span class="comment">// caller to handle the display of information about the error. This changes the</span>
00938 <span class="comment">// way the read methods work slightly. Their return code are now bogus; they use</span>
00939 <span class="comment">// exceptions to return error information to the caller.</span>
00940 <span class="comment">//</span>
00941 <span class="comment">// Revision 1.113  2001/09/28 17:50:07  jimg</span>
00942 <span class="comment">// Merged with 3.2.7.</span>
00943 <span class="comment">//</span>
00944 <span class="comment">// Revision 1.105.2.14  2001/09/26 00:45:46  jimg</span>
00945 <span class="comment">// Minor change to www_lib_init while trying to fix the seg fault on cancel bug.</span>
00946 <span class="comment">// The actual fix is in libwww (HTReader.c). However, I removed a line of</span>
00947 <span class="comment">// unnecessary code in the process of tracking down the bug.</span>
00948 <span class="comment">//</span>
00949 <span class="comment">// Revision 1.105.2.13  2001/09/25 21:45:35  jimg</span>
00950 <span class="comment">// Fixed a bug in the cache directory pathname code. Using the id2www function</span>
00951 <span class="comment">// on the pathname breaks libwww; it correctly escapes the %xx sequences but</span>
00952 <span class="comment">// does not then correctly simplify the pathname (which means, in this case,</span>
00953 <span class="comment">// removing the `file:' or `cache:' prefix). Apparently the WIN32 code needs</span>
00954 <span class="comment">// this so I moved the call to id2www into the WIN32 section of the www_lib_init</span>
00955 <span class="comment">// method.</span>
00956 <span class="comment">//</span>
00957 <span class="comment">// Revision 1.105.2.12  2001/09/25 20:36:42  jimg</span>
00958 <span class="comment">// Added debugging code for cancel button seg fault.</span>
00959 <span class="comment">//</span>
00960 <span class="comment">// Revision 1.105.2.11  2001/09/07 00:38:34  jimg</span>
00961 <span class="comment">// Sequence::deserialize(...) now reads all the sequence values at once.</span>
00962 <span class="comment">// Its call semantics are the same as the other classes' versions. Values</span>
00963 <span class="comment">// are stored in the Sequence object using a vector&lt;BaseType *&gt; for each</span>
00964 <span class="comment">// row (those are themselves held in a vector). Three new accessor methods</span>
00965 <span class="comment">// have been added to Sequence (row_value() and two versions of var_value()).</span>
00966 <span class="comment">// BaseType::deserialize(...) now always returns true. This matches with the</span>
00967 <span class="comment">// expectations of most client code (the seqeunce version returned false</span>
00968 <span class="comment">// when it was done reading, but all the calls for sequences must be changed</span>
00969 <span class="comment">// anyway). If an XDR error is found, deserialize throws InternalErr.</span>
00970 <span class="comment">//</span>
00971 <span class="comment">// Revision 1.112  2001/08/24 17:46:22  jimg</span>
00972 <span class="comment">// Resolved conflicts from the merge of release 3.2.6</span>
00973 <span class="comment">//</span>
00974 <span class="comment">// Revision 1.105.2.10  2001/08/22 06:13:56  jimg</span>
00975 <span class="comment">// CEs are not sent to id2www_ce() which is more relaxed about the characters</span>
00976 <span class="comment">// it allows. This was done so that new clients would not break old servers.</span>
00977 <span class="comment">//</span>
00978 <span class="comment">// Revision 1.105.2.9  2001/07/28 01:10:41  jimg</span>
00979 <span class="comment">// Some of the numeric type classes did not have copy ctors or operator=.</span>
00980 <span class="comment">// I added those where they were needed.</span>
00981 <span class="comment">// In every place where delete (or delete []) was called, I set the pointer</span>
00982 <span class="comment">// just deleted to zero. Thus if for some reason delete is called again</span>
00983 <span class="comment">// before new memory is allocated there won't be a mysterious crash. This is</span>
00984 <span class="comment">// just good form when using delete.</span>
00985 <span class="comment">// I added calls to www2id and id2www where appropriate. The DAP now handles</span>
00986 <span class="comment">// making sure that names are escaped and unescaped as needed. Connect is</span>
00987 <span class="comment">// set to handle CEs that contain names as they are in the dataset (see the</span>
00988 <span class="comment">// comments/Log there). Servers should not handle escaping or unescaping</span>
00989 <span class="comment">// characters on their own.</span>
00990 <span class="comment">//</span>
00991 <span class="comment">// Revision 1.105.2.8  2001/07/11 05:29:11  jimg</span>
00992 <span class="comment">// Connect::read_data() throws an InternalErr if it is passed a null data_source</span>
00993 <span class="comment">// pointer (FILE *). This is a fix for clients that used the `read from a file</span>
00994 <span class="comment">// or stdin' feature of Connect and don't check this themselves.</span>
00995 <span class="comment">//</span>
00996 <span class="comment">// Revision 1.111  2001/06/15 23:49:01  jimg</span>
00997 <span class="comment">// Merged with release-3-2-4.</span>
00998 <span class="comment">//</span>
00999 <span class="comment">// Revision 1.105.2.7  2001/05/23 16:47:56  jimg</span>
01000 <span class="comment">// Changed the initialization of _gui (an instance of Gui) so that it takes</span>
01001 <span class="comment">// place for Connect instances that access both local and remote data</span>
01002 <span class="comment">// sources. It was being set up for remote accesses only. This meant that a</span>
01003 <span class="comment">// libdap++ compiled with GUI defined that was used to access a local data</span>
01004 <span class="comment">// source (e.g., piped output from a server filter program) would crash when</span>
01005 <span class="comment">// it tried to use the Gui instance to display something. I changed the</span>
01006 <span class="comment">// function definitions so that the return types are on one line and the name</span>
01007 <span class="comment">// and arguments are on the following line. Tags are easier to use with this</span>
01008 <span class="comment">// style.</span>
01009 <span class="comment">//</span>
01010 <span class="comment">// Revision 1.110  2001/05/04 00:08:43  jimg</span>
01011 <span class="comment">// Fixed a bug where an Error object was created with an error code of</span>
01012 <span class="comment">// undefined_error (which make OK() throw and exception).</span>
01013 <span class="comment">//</span>
01014 <span class="comment">// Revision 1.105.2.6  2001/05/03 19:04:16  jimg</span>
01015 <span class="comment">// Added use of the _always_validate field. This configuration file is read</span>
01016 <span class="comment">// and this filed is set if a value is given for ALWAYS_VALIDATE. The default</span>
01017 <span class="comment">// value for the filed is zero (don't force validation). The _always_validate</span>
01018 <span class="comment">// field value is used to tell libwww to always validate cache entries (value</span>
01019 <span class="comment">// of 1) or to use either the expires header value or a heuristic value</span>
01020 <span class="comment">// derived from the current time and the last modified time sent from the</span>
01021 <span class="comment">// origin server. If no LM time was sent from the origin server, then the</span>
01022 <span class="comment">// value of DEFAULT_EXPIRES (from the configuration file) is used.</span>
01023 <span class="comment">//</span>
01024 <span class="comment">// Revision 1.105.2.5  2001/04/16 17:06:21  jimg</span>
01025 <span class="comment">// Changed the call to Error's ctor on 390 so that it uses unknown_error as</span>
01026 <span class="comment">// the error constant. It was using undefined_error and this caused Error's</span>
01027 <span class="comment">// invariant to barf.</span>
01028 <span class="comment">//</span>
01029 <span class="comment">// Revision 1.105.2.4  2001/02/16 21:18:42  jimg</span>
01030 <span class="comment">// Removed some excess variables in fetch_url().</span>
01031 <span class="comment">//</span>
01032 <span class="comment">// Revision 1.105.2.3  2001/02/14 00:10:04  jimg</span>
01033 <span class="comment">// Merged code from the trunk's HEAD revision for this/these files onto</span>
01034 <span class="comment">// the release-3-2 branch. This moves the authentication software onto the</span>
01035 <span class="comment">// release-3-2 branch so that it will be easier to get it in the 3.2 release.</span>
01036 <span class="comment">//</span>
01037 <span class="comment">// Other changes:</span>
01038 <span class="comment">// SetSignal() removed; libwww handles this now.</span>
01039 <span class="comment">// I removed redundant initialization of libwww Before and After filters.</span>
01040 <span class="comment">// I added calls to HTLibInit and HTLibTerminate in www_lib_init() and</span>
01041 <span class="comment">// ~Connect(). The LibInit call sets the client name and version number. That</span>
01042 <span class="comment">// information will appear in httpd access logs.</span>
01043 <span class="comment">// I've added comments about how Connect works in places where it seemed</span>
01044 <span class="comment">// pretty obscure.</span>
01045 <span class="comment">//</span>
01046 <span class="comment">// Revision 1.108  2001/02/05 18:57:44  jgarcia</span>
01047 <span class="comment">// Added support so a Connect object can be created with credentials to be</span>
01048 <span class="comment">// able to resolve challenges issued by web servers (Basic Authentication).</span>
01049 <span class="comment">// Added exception to notify "No Authorization".</span>
01050 <span class="comment">//</span>
01051 <span class="comment">// Revision 1.107  2001/01/26 19:48:09  jimg</span>
01052 <span class="comment">// Merged with release-3-2-3.</span>
01053 <span class="comment">//</span>
01054 <span class="comment">// Revision 1.105.2.2  2000/12/06 18:47:35  jimg</span>
01055 <span class="comment">// Fixed processing of the .dodsrc file. Comments were not ignored, instead</span>
01056 <span class="comment">// they caused the file reader to stop. This meant that comments at the top</span>
01057 <span class="comment">// of the file prevented any of the parameters from being read.</span>
01058 <span class="comment">//</span>
01059 <span class="comment">// Revision 1.106  2000/11/25 00:44:47  jgarcia</span>
01060 <span class="comment">// In Connect::read_url added an exception in case there is a fatal error</span>
01061 <span class="comment">// loading an URL. It is required for supporting Connect objects that support</span>
01062 <span class="comment">// HTTP Authorization.</span>
01063 <span class="comment">//</span>
01064 <span class="comment">// Revision 1.105.2.1  2000/11/22 05:35:09  brent</span>
01065 <span class="comment">// allow username/password in URL for secure data sets</span>
01066 <span class="comment">//</span>
01067 <span class="comment">// Revision 1.105  2000/10/30 17:21:27  jimg</span>
01068 <span class="comment">// Added support for proxy servers (from cjm).</span>
01069 <span class="comment">//</span>
01070 <span class="comment">// Revision 1.104  2000/09/22 02:17:19  jimg</span>
01071 <span class="comment">// Rearranged source files so that the CVS logs appear at the end rather than</span>
01072 <span class="comment">// the start. Also made the ifdef guard symbols use the same naming scheme and</span>
01073 <span class="comment">// wrapped headers included in other headers in those guard symbols (to cut</span>
01074 <span class="comment">// down on extraneous file processing - See Lakos).</span>
01075 <span class="comment">//</span>
01076 <span class="comment">// Revision 1.103  2000/09/21 16:22:07  jimg</span>
01077 <span class="comment">// Merged changes from Jose Garcia that add exceptions to the software.</span>
01078 <span class="comment">// Many methods that returned error codes now throw exectptions. There are</span>
01079 <span class="comment">// two classes which are thrown by the software, Error and InternalErr.</span>
01080 <span class="comment">// InternalErr is used to report errors within the library or errors using</span>
01081 <span class="comment">// the library. Error is used to reprot all other errors. Since InternalErr</span>
01082 <span class="comment">// is a subclass of Error, programs need only to catch Error.</span>
01083 <span class="comment">//</span>
01084 <span class="comment">// Revision 1.102  2000/08/29 21:22:54  jimg</span>
01085 <span class="comment">// Merged with 3.1.9</span>
01086 <span class="comment">//</span>
01087 <span class="comment">// Revision 1.80.2.4  2000/08/02 23:18:38  jimg</span>
01088 <span class="comment">// Fixed a bug that shows up on Linux (2.2, maybe others) where URLs with 61</span>
01089 <span class="comment">// 65 characters hang. See fetch_url() for the gory details.</span>
01090 <span class="comment">//</span>
01091 <span class="comment">// Revision 1.101  2000/07/26 12:24:01  rmorris</span>
01092 <span class="comment">// Modified intermediate (dod*) file removal under win32 to take into account</span>
01093 <span class="comment">// a 1-to-n correspondence between connect objects and intermediate files.</span>
01094 <span class="comment">// Implemented solution through vector of strings containing the intermediate</span>
01095 <span class="comment">// filenames that are removed when the connect obj's destructor is invoked.</span>
01096 <span class="comment">// Might consider using the same code for unix in the future.  Previous</span>
01097 <span class="comment">// win32 solution incorrectly assumed the correspondence was 1-to-1.</span>
01098 <span class="comment">//</span>
01099 <span class="comment">// Revision 1.100  2000/07/24 18:49:50  rmorris</span>
01100 <span class="comment">// Just added a notation that indicates what was tried to get around</span>
01101 <span class="comment">// libwww bugs in regards to spaces in pathnames.  Client-side caching</span>
01102 <span class="comment">// disabled until further notice - next version of libwww may help.</span>
01103 <span class="comment">//</span>
01104 <span class="comment">// Revision 1.99  2000/07/21 14:26:24  rmorris</span>
01105 <span class="comment">// Remove client-side caching entired under win32 in lieu of a permanent</span>
01106 <span class="comment">// fix (soon).  Fixed what I broke for client-side caching under unix.</span>
01107 <span class="comment">//</span>
01108 <span class="comment">// Revision 1.98  2000/07/18 12:49:04  rmorris</span>
01109 <span class="comment">// Fixed failure to initialize a structure element appropriately when</span>
01110 <span class="comment">// retrieving the Win32 OS version information for the WIN95_CACHE_HACK.</span>
01111 <span class="comment">//</span>
01112 <span class="comment">// Revision 1.96  2000/07/18 03:56:09  rmorris</span>
01113 <span class="comment">// Changes made in an attempt to debug client-side caching under win95-based</span>
01114 <span class="comment">// systems.  Is currently unsuccessful, but these changes made the code somewhat</span>
01115 <span class="comment">// more generic.</span>
01116 <span class="comment">//</span>
01117 <span class="comment">// Revision 1.95  2000/07/13 07:09:05  rmorris</span>
01118 <span class="comment">// Changed the approach to delete the intermediate file in the case</span>
01119 <span class="comment">// of win32 (unlink() not the same under win32, needed another approach).</span>
01120 <span class="comment">//</span>
01121 <span class="comment">// Revision 1.94  2000/07/09 22:05:35  rmorris</span>
01122 <span class="comment">// Changes to increase portability, minimize ifdef's for win32 and account</span>
01123 <span class="comment">// for differences in the iostreams implementations.</span>
01124 <span class="comment">//</span>
01125 <span class="comment">// Revision 1.93  2000/06/07 18:06:58  jimg</span>
01126 <span class="comment">// Merged the pc port branch</span>
01127 <span class="comment">//</span>
01128 <span class="comment">// Revision 1.92.4.2  2000/06/02 22:29:21  rmorris</span>
01129 <span class="comment">// Fixed bug in bug fix that allowed spaces in paths via escape sequences.</span>
01130 <span class="comment">// The bug within a bug was that we were translating a file path into a</span>
01131 <span class="comment">// url by prepending it with "file:/".  This allows libwww to recognize</span>
01132 <span class="comment">// escape sequence.  Under UNIX, "file:" is correct, not "file:/"</span>
01133 <span class="comment">//</span>
01134 <span class="comment">// Revision 1.92.4.1  2000/06/02 18:14:43  rmorris</span>
01135 <span class="comment">// Mod for port to win32.</span>
01136 <span class="comment">//</span>
01137 <span class="comment">// Revision 1.92  2000/04/17 22:13:37  jimg</span>
01138 <span class="comment">// Fixed problems with the _gui member and local connections. The _gui object</span>
01139 <span class="comment">// was not initialized (correct) for local connections but *was* destroyed for</span>
01140 <span class="comment">// them (because the code never checked for local connections in the dtor).</span>
01141 <span class="comment">//</span>
01142 <span class="comment">// Revision 1.91  2000/04/17 21:25:00  jimg</span>
01143 <span class="comment">// Fixed an error where local connections affected the status of the</span>
01144 <span class="comment">// __num_remote_conns field. This caused remote connections, made after one or</span>
01145 <span class="comment">// more local connections were closed, to fail because libwww was not</span>
01146 <span class="comment">// initialized correctly.</span>
01147 <span class="comment">//</span>
01148 <span class="comment">// Revision 1.90  2000/04/07 00:19:04  jimg</span>
01149 <span class="comment">// Merged Brent's changes for the progress gui - he added a cancel button.</span>
01150 <span class="comment">// Also repaired the last of the #ifdef Gui bugs so that we can build Gui</span>
01151 <span class="comment">// and non-gui versions of the library that use one set of header files.</span>
01152 <span class="comment">//</span>
01153 <span class="comment">// Revision 1.89.2.1  2000/04/04 05:00:24  brent</span>
01154 <span class="comment">// put a Cancel button the Tcl/Tk GUI</span>
01155 <span class="comment">//</span>
01156 <span class="comment">// Revision 1.89  2000/03/28 16:18:17  jimg</span>
01157 <span class="comment">// Added a DEFAULT_EXPIRES parameter to the .dodsrc file. The default</span>
01158 <span class="comment">// expiration time is now set by connect, using the value read from .dodsrc,</span>
01159 <span class="comment">// rather than use the value compiled into libwww. To do this I added a new</span>
01160 <span class="comment">// function to HTCache.c,h in libwww.</span>
01161 <span class="comment">//</span>
01162 <span class="comment">// Revision 1.88  2000/03/17 00:11:39  jimg</span>
01163 <span class="comment">// I fixed the bug in libwww which made caching of compressed documents fail.</span>
01164 <span class="comment">// I removed the hacks in this file that prevented data documents from being</span>
01165 <span class="comment">// cached. I also have removed the code that wrote NEVER_DEFLATE to the rc</span>
01166 <span class="comment">// file. The NEVER_DEFLATE option still works; I'm just not including it in</span>
01167 <span class="comment">// the rc file by default.</span>
01168 <span class="comment">//</span>
01169 <span class="comment">// Revision 1.86.2.1  2000/02/17 05:03:12  jimg</span>
01170 <span class="comment">// Added file and line number information to calls to InternalErr.</span>
01171 <span class="comment">// Resolved compile-time problems with read due to a change in its</span>
01172 <span class="comment">// parameter list given that errors are now reported using exceptions.</span>
01173 <span class="comment">//</span>
01174 <span class="comment">// Revision 1.87  2000/01/27 06:29:55  jimg</span>
01175 <span class="comment">// Resolved conflicts from merge with release-3-1-4</span>
01176 <span class="comment">//</span>
01177 <span class="comment">// Revision 1.80.2.3  2000/01/26 23:55:50  jimg</span>
01178 <span class="comment">// Fixed the return type of string::find.</span>
01179 <span class="comment">//</span>
01180 <span class="comment">// Revision 1.86  1999/12/31 00:55:10  jimg</span>
01181 <span class="comment">// Fixed up the progress indicator</span>
01182 <span class="comment">//</span>
01183 <span class="comment">// Revision 1.85  1999/12/15 01:14:10  jimg</span>
01184 <span class="comment">// More fixes for caching. Caching now works correctly for programs that use</span>
01185 <span class="comment">// multiple Connect objects. The Cache index is now updated more frequently.</span>
01186 <span class="comment">//</span>
01187 <span class="comment">// Revision 1.84  1999/12/01 21:27:05  jimg</span>
01188 <span class="comment">// Substantial changes for the caching software. Added a call to `terminate'</span>
01189 <span class="comment">// the cache once we're done with the libwww code. This writes the .index</span>
01190 <span class="comment">// file required by the cache. Additionally, changed the cache mode from</span>
01191 <span class="comment">// validate to OK. The later forces the cache to not validate every request.</span>
01192 <span class="comment">// Instead expiration is used and the libwww code implements a fall back in</span>
01193 <span class="comment">// those cases where servers don't supply a Date header. Finally, compressed</span>
01194 <span class="comment">// responses break the cache (I think this is libwww's bug) and I've disabled</span>
01195 <span class="comment">// caching compressed data responses. So that users can cache data responses,</span>
01196 <span class="comment">// I've added a new flag in the dodsrc file called NEVER_DEFLATE which allows</span>
01197 <span class="comment">// users to override the clients wishes regarding compression (i.e., users</span>
01198 <span class="comment">// can turn it off). Data responses can thus be cached.</span>
01199 <span class="comment">//</span>
01200 <span class="comment">// Revision 1.83  1999/10/22 04:17:25  cjm</span>
01201 <span class="comment">// Added support for caching.  Most of the code is in www_lib_init(), there</span>
01202 <span class="comment">// is also a modification to read_url() to make use of the cache if it is</span>
01203 <span class="comment">// enabled. </span>
01204 <span class="comment">//</span>
01205 <span class="comment">// Revision 1.82  1999/09/03 22:07:44  jimg</span>
01206 <span class="comment">// Merged changes from release-3-1-1</span>
01207 <span class="comment">//</span>
01208 <span class="comment">// Revision 1.80.2.2  1999/08/28 06:43:03  jimg</span>
01209 <span class="comment">// Fixed the implementation/interface pragmas and misc comments</span>
01210 <span class="comment">//</span>
01211 <span class="comment">// Revision 1.81  1999/08/23 18:57:44  jimg</span>
01212 <span class="comment">// Merged changes from release 3.1.0</span>
01213 <span class="comment">//</span>
01214 <span class="comment">// Revision 1.80.2.1  1999/08/09 22:57:49  jimg</span>
01215 <span class="comment">// Removed GUI code; reactivate by defining GUI</span>
01216 <span class="comment">//</span>
01217 <span class="comment">// Revision 1.80  1999/08/09 18:27:33  jimg</span>
01218 <span class="comment">// Merged changes from Brent for the Gui code (progress indicator)</span>
01219 <span class="comment">//</span>
01220 <span class="comment">// Revision 1.78.4.2  1999/07/29 05:46:17  brent</span>
01221 <span class="comment">// call Tcl / GUI directly from Gui.cc, abandon expect, and consolidate Tcl</span>
01222 <span class="comment">// files.</span>
01223 <span class="comment">//</span>
01224 <span class="comment">// Revision 1.79  1999/07/22 17:11:50  jimg</span>
01225 <span class="comment">// Merged changes from the release-3-0-2 branch</span>
01226 <span class="comment">//</span>
01227 <span class="comment">// Revision 1.78.4.1  1999/06/01 15:40:54  jimg</span>
01228 <span class="comment">// Ripped out dead wood in parse_mime(...).</span>
01229 <span class="comment">//</span>
01230 <span class="comment">// Revision 1.78  1999/05/26 17:30:24  jimg</span>
01231 <span class="comment">// Added the calls to Error::correct_error(...). These were removed because</span>
01232 <span class="comment">// they use the Gui object. However, they access it through the Connect::Gui()</span>
01233 <span class="comment">// member function which will return NULL until we fix the Gui. Calling the</span>
01234 <span class="comment">// correct_error with a NULL Gui object works in that the error message is</span>
01235 <span class="comment">// displayed on stderr and the Gui stuff is ignored.</span>
01236 <span class="comment">//</span>
01237 <span class="comment">// Revision 1.77  1999/05/21 20:39:23  dan</span>
01238 <span class="comment">// Disabled the Gui interface in the Connect objects.  Primarily</span>
01239 <span class="comment">// this was done in www_libc_init, constructor, destructor, and request_</span>
01240 <span class="comment">// calls using 'ifdef GUI' directives.  To regain use of this code</span>
01241 <span class="comment">// use the '-DGUI' compiler flag.</span>
01242 <span class="comment">//</span>
01243 <span class="comment">// Revision 1.76  1999/05/21 17:22:04  jimg</span>
01244 <span class="comment">// Removed debugging instrumentation left in by accident.</span>
01245 <span class="comment">//</span>
01246 <span class="comment">// Revision 1.75  1999/05/21 00:46:42  jimg</span>
01247 <span class="comment">// Using ifstream in parse_mime(...) confuses the downstream parser since the</span>
01248 <span class="comment">// FILE * is not advanced. I switched back to the fgets(...) code and the some</span>
01249 <span class="comment">// problems with the asciival client went away.</span>
01250 <span class="comment">//</span>
01251 <span class="comment">// Revision 1.74  1999/04/29 03:04:51  jimg</span>
01252 <span class="comment">// Merged ferret changes</span>
01253 <span class="comment">//</span>
01254 <span class="comment">// Revision 1.73  1999/04/29 02:29:27  jimg</span>
01255 <span class="comment">// Merge of no-gnu branch</span>
01256 <span class="comment">//</span>
01257 <span class="comment">// Revision 1.72.8.1  1999/04/14 22:31:36  jimg</span>
01258 <span class="comment">// Removed old code.</span>
01259 <span class="comment">// Fixed the delete of member _tv. timeval _tv was used by libwww 5.0 but is no</span>
01260 <span class="comment">// longer needed. I wrapped all code that touched this in #ifdef LIBWWW_5_0 and</span>
01261 <span class="comment">// removed the member from Connect using the same conditional. This fixes a</span>
01262 <span class="comment">// problem where _tv is deleted without being allocated when local files are</span>
01263 <span class="comment">// accessed.</span>
01264 <span class="comment">//</span>
01265 <span class="comment">// Revision 1.72  1999/02/23 01:32:59  jimg</span>
01266 <span class="comment">// Removed more of the code in process_data. Because of fixes in the scanner,</span>
01267 <span class="comment">// this code no longer needs to rewind after parsing the DDS of a data</span>
01268 <span class="comment">// document. The scanner no longer reads into the binary doc. Note that real</span>
01269 <span class="comment">// MP/MIME code would solve this by giving us two streams to work with. Some</span>
01270 <span class="comment">// day...</span>
01271 <span class="comment">//</span>
01272 <span class="comment">// Revision 1.71  1999/02/18 19:21:40  jimg</span>
01273 <span class="comment">// Added support for the DODS experimental MIME header XDODS-Accept-Types.</span>
01274 <span class="comment">// This will be used to send a lists of `accepted types' from the client to a</span>
01275 <span class="comment">// server. The list tells a server which datatypes the requesting client can</span>
01276 <span class="comment">// understand. This information may be used by both the DDS and DataDDS</span>
01277 <span class="comment">// objects to trigger translations from one type to another.</span>
01278 <span class="comment">//</span>
01279 <span class="comment">// Revision 1.66.4.2  1999/02/05 09:32:33  jimg</span>
01280 <span class="comment">// Fixed __unused__ so that it not longer clashes with Red Hat 5.2 inlined</span>
01281 <span class="comment">// math code.</span>
01282 <span class="comment">//</span>
01283 <span class="comment">// Revision 1.66.4.1  1999/02/02 21:56:56  jimg</span>
01284 <span class="comment">// String to string version</span>
01285 <span class="comment">//</span>
01286 <span class="comment">// Revision 1.70  1999/01/15 17:07:01  jimg</span>
01287 <span class="comment">// Removed use of the move_dds() member function. The DDS parser now</span>
01288 <span class="comment">// recognizes the `Data:' separator string as marking the end of the DDS part</span>
01289 <span class="comment">// of a data document. This means that Connect no longer needs to copy the</span>
01290 <span class="comment">// DDS part of the data document to a separate (temporary) text file before</span>
01291 <span class="comment">// parsing it.</span>
01292 <span class="comment">//</span>
01293 <span class="comment">// Revision 1.69  1998/12/16 19:10:53  jimg</span>
01294 <span class="comment">// Added support for XDODS-Server MIME header. This fixes a problem where our</span>
01295 <span class="comment">// use of Server clashed with Java</span>
01296 <span class="comment">//</span>
01297 <span class="comment">// Revision 1.68  1998/11/10 01:08:34  jimg</span>
01298 <span class="comment">// Patched memory leaks found with Purify.</span>
01299 <span class="comment">//</span>
01300 <span class="comment">// Revision 1.67  1998/09/08 22:27:11  jimg</span>
01301 <span class="comment">// Removed PERF macro.</span>
01302 <span class="comment">//</span>
01303 <span class="comment">// Revision 1.66  1998/06/04 06:29:11  jimg</span>
01304 <span class="comment">// Added two new member functions to set/get the new www_errors_to_stderr</span>
01305 <span class="comment">// property. This controls whether www errors (like host not found) are</span>
01306 <span class="comment">// reported on stderr in addition to the Error object. The default is to NOT</span>
01307 <span class="comment">// report them to stderr. WWW errors are now recorded in the Error object.</span>
01308 <span class="comment">//</span>
01309 <span class="comment">// Revision 1.65  1998/04/07 22:14:31  jimg</span>
01310 <span class="comment">// Added a call to prune_spaces to the default ctor. Removing spaces prevents</span>
01311 <span class="comment">// various crashes. Note that CEs can themselves contain spaces but *leading*</span>
01312 <span class="comment">// spaces caused problems.</span>
01313 <span class="comment">//</span>
01314 <span class="comment">// Revision 1.64  1998/04/03 17:39:07  jimg</span>
01315 <span class="comment">// Fixed a bug in process_data where sequences were not handled properly. Patch</span>
01316 <span class="comment">// from Jake Hamby.</span>
01317 <span class="comment">//</span>
01318 <span class="comment">// Revision 1.63  1998/03/26 00:19:24  jimg</span>
01319 <span class="comment">// Changed from converters to the _conv member in www_lib_init.</span>
01320 <span class="comment">//</span>
01321 <span class="comment">// Revision 1.62  1998/03/19 23:48:24  jimg</span>
01322 <span class="comment">// Removed old code associated with the (bogus) caching scheme.</span>
01323 <span class="comment">// Removed the _connects field.</span>
01324 <span class="comment">// Used _conv as a flag to ensure the www library is intialized only once.</span>
01325 <span class="comment">//</span>
01326 <span class="comment">// Revision 1.61  1998/02/11 21:56:20  jimg</span>
01327 <span class="comment">// Mayor modifications for libwww 5.1 compression support. I removed lots of</span>
01328 <span class="comment">// old code that was superfluous and changed the way the library is initialized</span>
01329 <span class="comment">// to make that more efficient.</span>
01330 <span class="comment">// Removed the old Semaphore hacks.</span>
01331 <span class="comment">// Removed the content-encoding handler (that is now done by libwww).</span>
01332 <span class="comment">// The Ctor and www_lib_init now take a flag that controls whether the server</span>
01333 <span class="comment">// is told that the client can decompress data. Note that this does not mean</span>
01334 <span class="comment">// data *will* be compressed, just that the client can process it if it is.</span>
01335 <span class="comment">//</span>
01336 <span class="comment">// Revision 1.60  1998/02/05 20:13:50  jimg</span>
01337 <span class="comment">// DODS now compiles with gcc 2.8.x</span>
01338 <span class="comment">//</span>
01339 <span class="comment">// Revision 1.59  1997/12/16 00:40:07  jimg</span>
01340 <span class="comment">// Fixed what may have been a lingering problem with version number strings</span>
01341 <span class="comment">// in the server_handler() function.</span>
01342 <span class="comment">// Added initialization of _server to `dods/0.0' in ctor. Thus _server will</span>
01343 <span class="comment">// have a value even for older servers that don't support server version</span>
01344 <span class="comment">// numbers.</span>
01345 <span class="comment">//</span>
01346 <span class="comment">// Revision 1.58  1997/09/22 23:06:52  jimg</span>
01347 <span class="comment">// Changed code so that the new DataDDS objects are used/created when</span>
01348 <span class="comment">// accessing data.</span>
01349 <span class="comment">//</span>
01350 <span class="comment">// Revision 1.57  1997/06/06 17:52:08  jimg</span>
01351 <span class="comment">// Last minute changes for version 2.14</span>
01352 <span class="comment">//</span>
01353 <span class="comment">// Revision 1.56  1997/06/06 03:09:15  jimg</span>
01354 <span class="comment">// Added parse_mime(); a tiny parser for the fields DODS uses. Not a real MIME</span>
01355 <span class="comment">// parser.</span>
01356 <span class="comment">// Added process_data to facilitate processing data from stdin.</span>
01357 <span class="comment">// Modified request_data() member function so that it works when reading from</span>
01358 <span class="comment">// stdin.</span>
01359 <span class="comment">// Fixed a bug in the destructor where _output and _source were not set to</span>
01360 <span class="comment">// null.</span>
01361 <span class="comment">//</span>
01362 <span class="comment">// Revision 1.55  1997/05/13 23:36:38  jimg</span>
01363 <span class="comment">// Added calls to close_output() in the dtor. This ensures that all files</span>
01364 <span class="comment">// will be closed when an Connect is destroyed.</span>
01365 <span class="comment">//</span>
01366 <span class="comment">// Revision 1.54  1997/05/07 22:10:37  jimg</span>
01367 <span class="comment">// Fixed a bug where the last decompressor process exit was not handled</span>
01368 <span class="comment">// properly. The fix was to make sure that calls for data interleaved</span>
01369 <span class="comment">// with calls for the DAS and/or DDS objects properly wait for the exit</span>
01370 <span class="comment">// status of the last decompression process. In addition, ensure that</span>
01371 <span class="comment">// Connect's dtor waits for the exit status of the very last</span>
01372 <span class="comment">// decompression process.</span>
01373 <span class="comment">//</span>
01374 <span class="comment">// Revision 1.53  1997/03/23 19:39:21  jimg</span>
01375 <span class="comment">// Added temporary fix for decompression bug. When decompressing `zombie'</span>
01376 <span class="comment">// processes were created which would fill the system's process table. The fix</span>
01377 <span class="comment">// explicitly catches the exit of child processes. This code can be removed</span>
01378 <span class="comment">// when/if we switch to version 5.1 of the WWW library.</span>
01379 <span class="comment">//</span>
01380 <span class="comment">// Revision 1.52  1997/03/05 08:24:33  jimg</span>
01381 <span class="comment">// Fixed the logfile bug; when linking with ld or cc static objects are not</span>
01382 <span class="comment">// initialized. The _logfile member was a static global object and caused core</span>
01383 <span class="comment">// dumps when it was not initialized.</span>
01384 <span class="comment">//</span>
01385 <span class="comment">// Revision 1.51  1997/02/19 02:11:34  jimg</span>
01386 <span class="comment">// Fixed ctors (removed lame error object initializers).</span>
01387 <span class="comment">//</span>
01388 <span class="comment">// Revision 1.50  1997/02/17 20:21:44  jimg</span>
01389 <span class="comment">// Fixed a bug in the ctors introduced by making Error's ctor private.</span>
01390 <span class="comment">//</span>
01391 <span class="comment">// Revision 1.49  1997/02/13 17:33:11  jimg</span>
01392 <span class="comment">// Added MIME header `handler' for the server header.</span>
01393 <span class="comment">// Added mfuncs to access the server information (which in DODS is the version</span>
01394 <span class="comment">// number of the core software).</span>
01395 <span class="comment">//</span>
01396 <span class="comment">// Revision 1.48  1997/02/13 05:49:53  reza</span>
01397 <span class="comment">// Fixed concatenation of _proj and _sel members into request_das and</span>
01398 <span class="comment">// request_dds URLs.</span>
01399 <span class="comment">//</span>
01400 <span class="comment">// Revision 1.47  1997/02/12 21:42:29  jimg</span>
01401 <span class="comment">// Fixed handling of non fatal errors reported by the www library. Now an</span>
01402 <span class="comment">// optional parameter to the class ctor enables display of these informational</span>
01403 <span class="comment">// messages. However, they are not registered as `web_errors' in the</span>
01404 <span class="comment">// type field of the Connect object.</span>
01405 <span class="comment">// Fixed a bug which introduced extraneous '?'s into URLs.</span>
01406 <span class="comment">//</span>
01407 <span class="comment">// Revision 1.46  1997/02/10 02:27:10  jimg</span>
01408 <span class="comment">// Fixed processing of error returns.</span>
01409 <span class="comment">// Changed return type of request_data() (and related functions) from DDS &amp; to</span>
01410 <span class="comment">// DDS *. The member function now return NULL if an error is detected.</span>
01411 <span class="comment">//</span>
01412 <span class="comment">// Revision 1.45  1997/02/04 22:44:31  jimg</span>
01413 <span class="comment">// Fixed bugs in URL() and CE() where the _URL, _proj and _sel members were</span>
01414 <span class="comment">// misused.</span>
01415 <span class="comment">//</span>
01416 <span class="comment">// Revision 1.44  1997/01/28 17:15:19  jimg</span>
01417 <span class="comment">// Wrapped the generic header_handler() in DBG() so that it is only used</span>
01418 <span class="comment">// while debugging.</span>
01419 <span class="comment">//</span>
01420 <span class="comment">// Revision 1.43  1996/12/18 19:17:20  jimg</span>
01421 <span class="comment">// Removed the DODS_PERF define.</span>
01422 <span class="comment">//</span>
01423 <span class="comment">// Revision 1.42  1996/12/02 23:10:10  jimg</span>
01424 <span class="comment">// Added dataset as a parameter to the ops member function.</span>
01425 <span class="comment">//</span>
01426 <span class="comment">// Revision 1.41  1996/11/25 03:37:34  jimg</span>
01427 <span class="comment">// Added USE_SEM control macro - since asynchronous connects are massively</span>
01428 <span class="comment">// broken the semaphores are not used.</span>
01429 <span class="comment">// The _connects field is not initialized to -1 and handled so that</span>
01430 <span class="comment">// HTLibTerminate() is never called but so that the web library is initialized</span>
01431 <span class="comment">// before the first use of connect. Apparently calling HTLibInit() more than</span>
01432 <span class="comment">// once (even with an interleaving call to HTLibTerminate()) breaks the 5.0a</span>
01433 <span class="comment">// version of the library.</span>
01434 <span class="comment">// Added the constant web_error the the set of content-descriptions.</span>
01435 <span class="comment">// Removed use of the disk cache. Added it in later; read_url() must be</span>
01436 <span class="comment">// modified.</span>
01437 <span class="comment">// Never use the broken asynchronous code.</span>
01438 <span class="comment">// Fixed processing of content-description so that web-error and dods-error</span>
01439 <span class="comment">// messages are handled correctly.</span>
01440 <span class="comment">//</span>
01441 <span class="comment">// Revision 1.40  1996/11/22 00:14:38  jimg</span>
01442 <span class="comment">// Removed decompress() function.</span>
01443 <span class="comment">// Switched to decompressor function in util.cc</span>
01444 <span class="comment">// Wrapped semaphore code in USE_SEM preprocessor define - the semaphore code</span>
01445 <span class="comment">// may not be necessary...</span>
01446 <span class="comment">//</span>
01447 <span class="comment">// Revision 1.39  1996/11/20 22:29:29  jimg</span>
01448 <span class="comment">// Fixed header parsing. Now I use my own header parsers for the</span>
01449 <span class="comment">// content-description and -encoding headers. Once the values of these headers</span>
01450 <span class="comment">// have been stored in the Connect object it is easy to operate on the data</span>
01451 <span class="comment">// stream. This is simpler than using libwww's stream stack (at least for</span>
01452 <span class="comment">// decompression and error document routing).</span>
01453 <span class="comment">//</span>
01454 <span class="comment">// Revision 1.38  1996/11/20 00:55:29  jimg</span>
01455 <span class="comment">// Fixed a bug with HTLibTerminate() where multiple URLs caused a core dump.</span>
01456 <span class="comment">// Fixed the progress indicator.</span>
01457 <span class="comment">// Ripped out the semaphore stuff used with the asynchronous connects - those</span>
01458 <span class="comment">// connects now work, at least on the Sun.</span>
01459 <span class="comment">//</span>
01460 <span class="comment">// Revision 1.37  1996/11/13 18:53:00  jimg</span>
01461 <span class="comment">// Updated so that this now works with version 5.0a of the WWW library from</span>
01462 <span class="comment">// the W3c.</span>
01463 <span class="comment">// Fixed handling of certain types of http/www errors.</span>
01464 <span class="comment">//</span>
01465 <span class="comment">// Revision 1.36  1996/10/18 16:40:09  jimg</span>
01466 <span class="comment">// Changed request_das() and request_dds() so that they now pass any initial</span>
01467 <span class="comment">// constraint to the DAS and DDS servers.</span>
01468 <span class="comment">//</span>
01469 <span class="comment">// Revision 1.35  1996/10/08 16:27:47  jimg</span>
01470 <span class="comment">// Added code so that a constraint expression appended to a URL is properly</span>
01471 <span class="comment">// handled. The CE is stored in in the Connect object. When a CE is passed to</span>
01472 <span class="comment">// the request_data member function, Connect correctly combines the projection</span>
01473 <span class="comment">// and selection parts of that CE with the matching parts of any initial CE.</span>
01474 <span class="comment">//</span>
01475 <span class="comment">// Revision 1.34  1996/09/18 23:06:28  jimg</span>
01476 <span class="comment">// Fixed a bug in the dtor which caused the _anchor WWW lib object to be</span>
01477 <span class="comment">// deleted twice under some (likely) conditions. The efence library found the</span>
01478 <span class="comment">// error. </span>
01479 <span class="comment">//</span>
01480 <span class="comment">// Revision 1.33  1996/08/26 21:12:52  jimg</span>
01481 <span class="comment">// Changes for version 2.07</span>
01482 <span class="comment">//</span>
01483 <span class="comment">// Revision 1.32  1996/08/13 17:53:34  jimg</span>
01484 <span class="comment">// Corrected misuse of the istrstream class; added calls to the freeze member</span>
01485 <span class="comment">// function where needed.</span>
01486 <span class="comment">// Fixed test for URL -vs- filename in the object ctor.</span>
01487 <span class="comment">//</span>
01488 <span class="comment">// Revision 1.31  1996/07/17 22:27:20  jimg</span>
01489 <span class="comment">// Removed copy of the _output FILE * and bad logic on output() member</span>
01490 <span class="comment">// function. Added reset of _source to 0 in close_output().</span>
01491 <span class="comment">//</span>
01492 <span class="comment">// Revision 1.30  1996/07/10 21:25:32  jimg</span>
01493 <span class="comment">// *** empty log message ***</span>
01494 <span class="comment">//</span>
01495 <span class="comment">// Revision 1.29  1996/06/22 00:00:23  jimg</span>
01496 <span class="comment">// Added Gui pointer to the Error oject's correct_error mfunc call.</span>
01497 <span class="comment">//</span>
01498 <span class="comment">// Revision 1.28  1996/06/21 23:15:03  jimg</span>
01499 <span class="comment">// Removed GUI code to a new class - Gui.</span>
01500 <span class="comment">//</span>
01501 <span class="comment">// Revision 1.27  1996/06/20 15:59:24  jimg</span>
01502 <span class="comment">// Added conditional definition of union semun {};</span>
01503 <span class="comment">//</span>
01504 <span class="comment">// Revision 1.26  1996/06/18 23:43:42  jimg</span>
01505 <span class="comment">// Added support for a GUI. The GUI is actually contained in a separate program</span>
01506 <span class="comment">// that is run in a subprocess. The core `talks' to the GUI using a pty and a</span>
01507 <span class="comment">// simple command language.</span>
01508 <span class="comment">// Removed GZIP preprocessor define and added DODS_ROOT define. Added checks in</span>
01509 <span class="comment">// the code to use the environment variable DODS_ROOT in preference to the</span>
01510 <span class="comment">// compile-time value (if non-null).</span>
01511 <span class="comment">//</span>
01512 <span class="comment">// Revision 1.25  1996/06/08 00:08:47  jimg</span>
01513 <span class="comment">// Fixed comments.</span>
01514 <span class="comment">//</span>
01515 <span class="comment">// Revision 1.24  1996/06/08 00:07:19  jimg</span>
01516 <span class="comment">// Added support for compression. The Content-Encoding header is used to</span>
01517 <span class="comment">// determine if the incoming document is compressed (values: x-plain; no</span>
01518 <span class="comment">// compression, x-gzip; gzip compression). The gzip program is used to</span>
01519 <span class="comment">// decompress the document. The new software uses UNIX IPC and a separate</span>
01520 <span class="comment">// subprocess to perform the decompression.</span>
01521 <span class="comment">//</span>
01522 <span class="comment">// revision 1.23  1996/06/06 17:07:57  jimg</span>
01523 <span class="comment">// Added support for wwwlib 4.0.</span>
01524 <span class="comment">// Added support for object types.</span>
01525 <span class="comment">//</span>
01526 <span class="comment">// revision 1.22  1996/06/04 21:33:15  jimg</span>
01527 <span class="comment">// Multiple connections are now possible. It is now possible to open several</span>
01528 <span class="comment">// URLs at the same time and read from them in a round-robin fashion. To do</span>
01529 <span class="comment">// this I added data source and sink parameters to the serialize and</span>
01530 <span class="comment">// deserialize mfuncs. Connect was also modified so that it manages the data</span>
01531 <span class="comment">// source `object' (which is just an XDR pointer).</span>
01532 <span class="comment">//</span>
01533 <span class="comment">// revision 1.21  1996/05/31 23:29:30  jimg</span>
01534 <span class="comment">// Updated copyright notice.</span>
01535 <span class="comment">//</span>
01536 <span class="comment">// Revision 1.20  1996/05/29 21:47:51  jimg</span>
01537 <span class="comment">// Added Content-Description header parsing.</span>
01538 <span class="comment">// Removed Event loop code (HTEvent_loop()).</span>
01539 <span class="comment">// Fixed bug where a copy of _OUTPUT was created using _OUTPUT's file</span>
01540 <span class="comment">// descriptor. When _OUTPUT was closed the copy no longer referenced a valid</span>
01541 <span class="comment">// data source.</span>
01542 <span class="comment">// Fixed problems with asserts and error messaging.</span>
01543 <span class="comment">//</span>
01544 <span class="comment">// Revision 1.19  1996/05/22 18:05:04  jimg</span>
01545 <span class="comment">// Merged files from the old netio directory into the dap directory.</span>
01546 <span class="comment">// Removed the errmsg library from the software.</span>
01547 <span class="comment">//</span>
01548 <span class="comment">// Revision 1.18  1996/05/21 23:46:32  jimg</span>
01549 <span class="comment">// Added support for URLs directly to the class. This uses version 4.0D of</span>
01550 <span class="comment">// the WWW library from W3C.</span>
01551 <span class="comment">//</span>
01552 <span class="comment">// Revision 1.17  1996/04/05 01:25:39  jimg</span>
01553 <span class="comment">// Merged changes from version 1.1.1.</span>
01554 <span class="comment">//</span>
01555 <span class="comment">// Revision 1.16  1996/03/05 23:21:27  jimg</span>
01556 <span class="comment">// Added const to char * parameters and function prototypes.</span>
01557 <span class="comment">//</span>
01558 <span class="comment">// Revision 1.14.2.3  1996/03/01 00:07:57  jimg</span>
01559 <span class="comment">// Removed bad attempt at multiple connect implementation.</span>
01560 <span class="comment">//</span>
01561 <span class="comment">// Revision 1.14.2.2  1996/02/23 22:51:00  jimg</span>
01562 <span class="comment">// Added const in prototype of netio files.</span>
01563 <span class="comment">// Added libraries for solaris 2.x</span>
01564 <span class="comment">//</span>
01565 <span class="comment">// Revision 1.2  1994/10/05  20:23:26  jimg</span>
01566 <span class="comment">// Fixed errors in *.h files comments - CVS bites again.</span>
01567 <span class="comment">// Changed request_{das,dds} so that they use the field `_api_name'</span>
01568 <span class="comment">// instead of requiring callers to pass the api name.</span>
01569 <span class="comment">//</span>
01570 <span class="comment">// Revision 1.15  1996/02/01 21:43:51  jimg</span>
01571 <span class="comment">// Added mfuncs to maintain a list of DDSs and the constraint expressions</span>
01572 <span class="comment">// that produced them.</span>
01573 <span class="comment">// Added code in request_data to strip the incoming DDS from a data</span>
01574 <span class="comment">// document.</span>
01575 <span class="comment">// Fixed up bogus comments.</span>
01576 <span class="comment">//</span>
01577 <span class="comment">//</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 4 23:42:58 2004 for libdap++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
