<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libdap++: server_handler.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>server_handler.cc</h1><a href="server__handler_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <span class="comment">// -*- mode: c++; c-basic-offset:4 -*-</span>
00003 
00004 <span class="comment">// This file is part of libdap, A C++ implementation of the OPeNDAP Data</span>
00005 <span class="comment">// Access Protocol.</span>
00006 
00007 <span class="comment">// Copyright (c) 2002,2003 OPeNDAP, Inc.</span>
00008 <span class="comment">// Author: James Gallagher &lt;jgallagher@opendap.org&gt;</span>
00009 <span class="comment">//</span>
00010 <span class="comment">// This library is free software; you can redistribute it and/or</span>
00011 <span class="comment">// modify it under the terms of the GNU Lesser General Public</span>
00012 <span class="comment">// License as published by the Free Software Foundation; either</span>
00013 <span class="comment">// version 2.1 of the License, or (at your option) any later version.</span>
00014 <span class="comment">// </span>
00015 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
00016 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00017 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
00018 <span class="comment">// Lesser General Public License for more details.</span>
00019 <span class="comment">// </span>
00020 <span class="comment">// You should have received a copy of the GNU Lesser General Public</span>
00021 <span class="comment">// License along with this library; if not, write to the Free Software</span>
00022 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
00023 <span class="comment">//</span>
00024 <span class="comment">// You can contact OPeNDAP, Inc. at PO Box 112, Saunderstown, RI. 02874-0112.</span>
00025  
00026 <span class="comment">// The server_handler is a dummy server which currently assumes a data</span>
00027 <span class="comment">// request. An executable is built using the Test* classes so this will</span>
00028 <span class="comment">// return data values. All output is dumped to stdout except for</span>
00029 <span class="comment">// instrumentation, which is sent to stderr. This is new in 3.4. When we move</span>
00030 <span class="comment">// on to 3.5, this should be edited so that it is a 'real' handler, using the</span>
00031 <span class="comment">// response information in DODSFilter. 07/21/03 jhrg</span>
00032 
00033 <span class="preprocessor">#include "<a class="code" href="config__dap_8h.html">config_dap.h</a>"</span>
00034 
00035 <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="config__dap_8h.html#a49">not_used</a> rcsid[]={<span class="stringliteral">"$Id$"</span>};
00036 
00037 <span class="preprocessor">#include &lt;iostream&gt;</span>
00038 <span class="preprocessor">#include &lt;string&gt;</span>
00039 
00040 <span class="preprocessor">#include "<a class="code" href="DODSFilter_8h.html">DODSFilter.h</a>"</span>
00041 <span class="preprocessor">#include "<a class="code" href="DDS_8h.html">DDS.h</a>"</span>
00042 <span class="preprocessor">#include "<a class="code" href="DAS_8h.html">DAS.h</a>"</span>
00043 <span class="preprocessor">#if 0</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="DataDDS_8h.html">DataDDS.h</a>"</span>
00045 <span class="preprocessor">#endif</span>
00046 <span class="preprocessor"></span>
00047 <span class="preprocessor">#include "<a class="code" href="ObjectType_8h.html">ObjectType.h</a>"</span>
00048 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">debug.h</a>"</span>
00049 <span class="preprocessor">#include "<a class="code" href="cgi__util_8h.html">cgi_util.h</a>"</span>
00050 
00051 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00052 
<a name="l00053"></a><a class="code" href="server__handler_8cc.html#a1">00053</a> <span class="keywordtype">int</span> <a class="code" href="expr-test_8cc.html#a3">test_variable_sleep_interval</a> = 0;
<a name="l00054"></a><a class="code" href="server__handler_8cc.html#a2">00054</a> <span class="keyword">const</span> string <a class="code" href="server__handler_8cc.html#a2">cgi_version</a> = <span class="stringliteral">"DODS/3.4, server_handler"</span>; <span class="comment">//DODS_SERVER_VERSION;</span>
00055 
00056 <span class="keyword">static</span> <span class="keywordtype">void</span>
00057 <a class="code" href="expr-test_8cc.html#a13">read_table</a>(<a class="code" href="classDDS.html">DDS</a> &amp;table, <span class="keyword">const</span> string &amp;name) <span class="keywordflow">throw</span>(<a class="code" href="classError.html">Error</a>)
00058 {
00059     table.parse(name);
00060     
00061     <span class="keywordflow">if</span> (!table.check_semantics(<span class="keyword">true</span>))
00062     <span class="keywordflow">throw</span> <a class="code" href="classError.html">Error</a>(<span class="stringliteral">"DDS Failed semantic check."</span>);
00063 }
00064 
00065 <span class="keywordtype">int</span> 
<a name="l00066"></a><a class="code" href="server__handler_8cc.html#a4">00066</a> <a class="code" href="usage_8cc.html#a17">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
00067 {
00068     <span class="keywordflow">try</span> { 
00069     <a class="code" href="classDODSFilter.html">DODSFilter</a> df(argc, argv);
00070     <span class="keywordflow">if</span> (df.<a class="code" href="classDODSFilter.html#DODSFiltera5">get_cgi_version</a>() == <span class="stringliteral">""</span>)
00071         df.<a class="code" href="classDODSFilter.html#DODSFiltera6">set_cgi_version</a>(<a class="code" href="server__handler_8cc.html#a2">cgi_version</a>);
00072 
00073     <a class="code" href="classDDS.html">DDS</a> dds;
00074     <a class="code" href="classDAS.html">DAS</a> das;
00075 
00076     dds.<a class="code" href="classDDS.html#DDSz23_0">filename</a>(df.<a class="code" href="classDODSFilter.html#DODSFiltera9">get_dataset_name</a>());
00077     <a class="code" href="expr-test_8cc.html#a13">read_table</a>(dds, df.<a class="code" href="classDODSFilter.html#DODSFiltera9">get_dataset_name</a>());
00078     
00079     <span class="comment">// Don't name test dataset DDS file XXX.dds...</span>
00080     df.<a class="code" href="classDODSFilter.html#DODSFiltera22">read_ancillary_dds</a>(dds);
00081     df.<a class="code" href="classDODSFilter.html#DODSFiltera21">read_ancillary_das</a>(das);
00082 
00083     <a class="code" href="debug_8h.html#a1">DBG</a>(dds.<a class="code" href="classDDS.html#DDSa43">print</a>(stderr));
00084     <span class="comment">// DBG(das.print(stderr));</span>
00085 
00086     <span class="comment">// Extract params. This provides a way to configure 'datasets' for</span>
00087     <span class="comment">// special tests. It's pretty crude. Maybe it would be better to use</span>
00088     <span class="comment">// command line options?...</span>
00089     <a class="code" href="classAttrTable.html">AttrTable</a> *sh_attr = das.<a class="code" href="classDAS.html#DASz16_0">get_table</a>(<span class="stringliteral">"server_handler"</span>);
00090     <span class="keywordflow">if</span> (sh_attr) {
00091         <span class="keywordtype">int</span> timeout = atoi(sh_attr-&gt;<a class="code" href="classAttrTable.html#DASz7_5">get_attr</a>(<span class="stringliteral">"timeout"</span>).c_str());
00092         <span class="keywordtype">int</span> sleep_interval = atoi(sh_attr-&gt;<a class="code" href="classAttrTable.html#DASz7_5">get_attr</a>(<span class="stringliteral">"sleep"</span>).c_str());
00093 
00094         df.<a class="code" href="classDODSFilter.html#DODSFiltera18">set_timeout</a>(timeout);
00095         <span class="comment">// This global causes the read() methods of the Test* classes to</span>
00096         <span class="comment">// sleep for sleep_interval seconds, simulating a long, complex</span>
00097         <span class="comment">// variable access operation.</span>
00098         <a class="code" href="expr-test_8cc.html#a3">test_variable_sleep_interval</a> = sleep_interval;
00099     }
00100 
00101     df.<a class="code" href="classDODSFilter.html#DODSFiltera33">send_data</a>(dds, stdout);
00102     }
00103     <span class="keywordflow">catch</span> (<a class="code" href="classError.html">Error</a> &amp;e) {
00104     <a class="code" href="cgi__util_8cc.html#a16">set_mime_text</a>(cout, <a class="code" href="ObjectType_8h.html#a6a4">dods_error</a>, <a class="code" href="server__handler_8cc.html#a2">cgi_version</a>);
00105     e.print(cout);
00106     <span class="keywordflow">return</span> 1;
00107     }
00108 
00109     <span class="keywordflow">return</span> 0;
00110 }
00111 
00112 <span class="comment">// $Log: server__handler_8cc-source.html,v $
00112 <span class="comment">// Revision 1.4  2004/02/05 06:51:21  jimg
00112 <span class="comment">// Added/update.
00112 <span class="comment">//</span>
00113 <span class="comment">// Revision 1.1.2.2  2003/07/25 06:04:28  jimg</span>
00114 <span class="comment">// Refactored the code so that DDS:send() is now incorporated into</span>
00115 <span class="comment">// DODSFilter::send_data(). The old DDS::send() is still there but is</span>
00116 <span class="comment">// depracated.</span>
00117 <span class="comment">// Added 'smart timeouts' to all the variable classes. This means that</span>
00118 <span class="comment">// the new server timeouts are active only for the data read and CE</span>
00119 <span class="comment">// evaluation. This went inthe BaseType::serialize() methods because it</span>
00120 <span class="comment">// needed to time both the read() calls and the dds::eval() calls.</span>
00121 <span class="comment">//</span>
00122 <span class="comment">// Revision 1.1.2.1  2003/07/24 00:42:34  jimg</span>
00123 <span class="comment">// Added</span>
00124 <span class="comment">//</span>
00125 <span class="comment">// Revision 1.1  2003/05/13 22:03:34  jimg</span>
00126 <span class="comment">// Created. This works with newly modified DODS_Dispatch.pm script and</span>
00127 <span class="comment">// DODSFilter class.</span>
00128 <span class="comment">//</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Feb 4 23:43:04 2004 for libdap++ by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
